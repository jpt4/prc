<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>MessagePack</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Message<span class="mywbr"> &nbsp;</span>Pack</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Message.Pack_guide%29" class="tocviewlink" data-pltdoc="x">Message<span class="mywbr"> &nbsp;</span>Pack guide</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Message.Pack_.A.P.I%29" class="tocviewlink" data-pltdoc="x">Message<span class="mywbr"> &nbsp;</span>Pack API</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">Message<span class="mywbr"> &nbsp;</span>Pack</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Message.Pack_guide%29" class="tocsubseclink" data-pltdoc="x">Message<span class="mywbr"> &nbsp;</span>Pack guide</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.Motivation%29" class="tocsubseclink" data-pltdoc="x">Motivation</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._.A_guided_tour%29" class="tocsubseclink" data-pltdoc="x">A guided tour</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._.Type_system%29" class="tocsubseclink" data-pltdoc="x">Type system</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Message.Pack_.A.P.I%29" class="tocsubseclink" data-pltdoc="x">Message<span class="mywbr"> &nbsp;</span>Pack API</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Message.Pack_types%29" class="tocsubseclink" data-pltdoc="x">Message<span class="mywbr"> &nbsp;</span>Pack types</a></td></tr><tr><td><span class="tocsublinknumber">2.1.1<tt>&nbsp;</tt></span><a href="#%28part._.Packable_types%29" class="tocsubseclink" data-pltdoc="x">Packable types</a></td></tr><tr><td><a href="#%28form._%28%28lib._msgpack%2Fmain..rkt%29._.Packable%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">Packable</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._packable~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">packable?</span></span></a></td></tr><tr><td><span class="tocsublinknumber">2.1.2<tt>&nbsp;</tt></span><a href="#%28part._.Message.Pack_extension_type%29" class="tocsubseclink" data-pltdoc="x">Message<span class="mywbr"> &nbsp;</span>Pack extension type</a></td></tr><tr><td><a href="#%28form._%28%28lib._msgpack%2Fmain..rkt%29._.Ext%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">Ext</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._ext%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">ext</span></span></a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Packing%29" class="tocsubseclink" data-pltdoc="x">Packing</a></td></tr><tr><td><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack-to%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">pack-<wbr></wbr>to</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">pack</span></span></a></td></tr><tr><td><span class="tocsublinknumber">2.3<tt>&nbsp;</tt></span><a href="#%28part._.Unpacking%29" class="tocsubseclink" data-pltdoc="x">Unpacking</a></td></tr><tr><td><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack-from%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unpack-<wbr></wbr>from</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unpack</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%2Frest%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">unpack/<span class="mywbr"> &nbsp;</span>rest</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.4</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._.Message.Pack)"></a><a name="(mod-path._msgpack)"></a>MessagePack</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Alejandro Sanchez &lt;<a href="mailto:hiphish@openmailbox.org">hiphish@openmailbox.org</a>&gt;</p></span></div><p><div class="SIntrapara"></div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">msgpack</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/msgpack" title="Install this package using `raco pkg install msgpack`"><span class="stt">msgpack</span></a></span></td></tr></table></div></p><p><a href="http://msgpack.org/">MessagePack</a> is a binary data serialization
format. This means that in-memory objects like numbers, string, dictionaries or
ordered sequences can be serialized (<span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span>ed) to raw bytes, and
deserialized (<span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span>ed) to in-memory Racket objects.</p><p>Source code: <a href="https://gitlab.com/HiPhish/MsgPack.rkt"><span class="url">https://gitlab.com/HiPhish/MsgPack.rkt</span></a></p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Message.Pack_guide%29" class="toptoclink" data-pltdoc="x">1<span class="hspace">&nbsp;</span>MessagePack guide</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Motivation%29" class="toclink" data-pltdoc="x">1.1<span class="hspace">&nbsp;</span>Motivation</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.A_guided_tour%29" class="toclink" data-pltdoc="x">1.2<span class="hspace">&nbsp;</span>A guided tour</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Type_system%29" class="toclink" data-pltdoc="x">1.3<span class="hspace">&nbsp;</span>Type system</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Message.Pack_.A.P.I%29" class="toptoclink" data-pltdoc="x">2<span class="hspace">&nbsp;</span>MessagePack API</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Message.Pack_types%29" class="toclink" data-pltdoc="x">2.1<span class="hspace">&nbsp;</span>MessagePack types</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Packable_types%29" class="toclink" data-pltdoc="x">2.1.1<span class="hspace">&nbsp;</span>Packable types</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Message.Pack_extension_type%29" class="toclink" data-pltdoc="x">2.1.2<span class="hspace">&nbsp;</span>MessagePack extension type</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Packing%29" class="toclink" data-pltdoc="x">2.2<span class="hspace">&nbsp;</span>Packing</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Unpacking%29" class="toclink" data-pltdoc="x">2.3<span class="hspace">&nbsp;</span>Unpacking</a></p></td></tr></table><h3 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;MessagePack_guide&quot;">1<tt>&nbsp;</tt><a name="(part._.Message.Pack_guide)"></a>MessagePack guide</h3><p>From the <a href="https://msgpack.org/">MessagePack website</a>:</p><blockquote class="SCentered"><p>MessagePack is an efficient binary serialization format. It lets you
exchange data among multiple languages like JSON. But it&rsquo;s faster and
smaller. Small integers are encoded into a single byte, and typical short
strings require only one extra byte in addition to the strings themselves.</p></blockquote><p>What this means is that we can turn in-memory objects of a process (such as a
Racket REPL instance) into raw bytes, and turn raw bytes into in-memory objects
again. These actions are referred to as "packing" and "unpacking" respectively,
although the technical terms are "serialization" and "deserialization". Since
the format is standardised we can use it to exchange data between processes
written in different programming languages running on different architectures
without issue.</p><p>MessagePack is focused on optimising speed and size, hence why it uses a binary
format instead of a text-based one. Serialization formats like JSON and YAML
are easy to read and manually edit by humans, but parsing them is a non-trivial
task. Human-readability is not always a priority: for instance, if we want to
exchange data between two processes for remote procedure calls, that data will
never be read by a human.</p><h4 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;Motivation&quot;">1.1<tt>&nbsp;</tt><a name="(part._.Motivation)"></a>Motivation</h4><p>Suppose we have two processes and we wish to exchange data between them.
Consider the following crude illustration:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">+-------------+</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Outgoing</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">+-------------+</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">|             |</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">-------------------------&gt;</span></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">|             |</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">|  Process 1  |</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">|  Process 2  |</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">|             |</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">&lt;-------------------------</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">|             |</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">+-------------+</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Incoming</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">+-------------+</span><span class="RktMeta"></span></td></tr></table></blockquote><p>The first process wants to send some "object" to the second process. The object
can be anything: a number, a string, a boolean value, a list of objects, a hash
table, a time stamp, or any additional type you want. The two processes do not
necessarily have to be the same program, or run on the same machine or even run
at the same time.</p><p>The easiest thing to do would be to just dump the in-memory representation of
the object from inside the first process, and feed those raw bytes into the
second process. However, there is no guarantee that the two processes can
understand each other&rsquo;s "dumped format", which is why we need some format to
agree on.</p><p>The act of turning an in-memory object into raw bytes is generally called
<span style="font-style: italic">serialization</span>, and the act of turning raw bytes into an in-memory object
is called <span style="font-style: italic">deserialization</span>. In MessagePack terminology it is customary to
refer to them as <span style="font-style: italic">packing</span> and <span style="font-style: italic">unpacking</span> respectively, and that is
what we will call them from now on.</p><p>MessagePack defines a data serialization format which prefers speed and small
memory sizes, this makes it particularly well suited for inter-process
communication. We could in theory also write the packed object to a file and
pass the file around to other people to look at, but the binary format makes it
hard to read for humans.</p><h4 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;A_guided_tour&quot;">1.2<tt>&nbsp;</tt><a name="(part._.A_guided_tour)"></a>A guided tour</h4><p>The easiest way to get acquainted with MessagePack is to try it out. Install
this library, fire up your Racket REPL of choice, then follow along with the
code.  If you are reading this manual in an interactive format (like HTML) you
can always click the name of a procedure to read its documentation. Let&rsquo;s first
import the MessagePack module.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">msgpack</span><span class="RktPn">)</span></td></tr></table></blockquote><p>MessagePack is often abbreviated as "msgpack", and this name is used throughout
the library. There a several modules provided, with the topmost module
<span class="RktSym">msgpack</span><span class="RktMeta"></span> being an "umbrella module" which exports everything the
submodules export.</p><p><div class="SIntrapara">Let us now pack some objects.
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">msgpack</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">13</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"\r"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"\302"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"\254Hello world!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">13</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#"\r\302\254Hello world!"</span></p></td></tr></table></blockquote></div></p><p>The <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span> procedure takes one or more objects and turns them into
bytes, returning a byte string. We could now write those bytes to an output
port to send them off. As a shorthand the <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack-to%29%29" class="RktValLink" data-pltdoc="x">pack-to</a></span> procedure takes in a
binary output port, followed by one or more objects to pack, and sends then off
through the port without allocating a bytevector.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">msgpack</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack-to%29%29" class="RktValLink" data-pltdoc="x">pack-to</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-output-port%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">current-output-port</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello world!"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">?Hello world!</span></p></td></tr></table></blockquote><p>The complements to <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack-to%29%29" class="RktValLink" data-pltdoc="x">pack-to</a></span> are <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span> and
<span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack-from%29%29" class="RktValLink" data-pltdoc="x">unpack-from</a></span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">msgpack</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#"\r"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">13</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#"\302"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#"\254Hello world!"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Hello world!"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#"\r\302\254Hello world!"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">13</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%2Frest%29%29" class="RktValLink" data-pltdoc="x">unpack/rest</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#"\r\302\254Hello world!"</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">13</span></p></td></tr><tr><td><p><span class="RktRes">#"\302\254Hello world!"</span></p></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack-from%29%29" class="RktValLink" data-pltdoc="x">unpack-from</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-input-port%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">current-input-port</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">13</span></p></td></tr></table></blockquote><p>As we can see, while it was possible to pack multiple values at the same time,
it is not possible to unpack multiple values at the same time. Instead we can
use the <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%2Frest%29%29" class="RktValLink" data-pltdoc="x">unpack/rest</a></span> procedure, which returns the unpacked object and
the remaining bytes in the byte string. This is due to the fact that typed
Racket requires procedures to return a fixed number of values.</p><p>These four procedures are what you will be using most of the time, they are
documented in detail below, see the Packing and Unpacking sections.</p><h4 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;Type_system&quot;">1.3<tt>&nbsp;</tt><a name="(part._.Type_system)"></a>Type system</h4><p>For the most part packable types have a clear 1:1 mapping to Racket types;
arrays unpack to vectors, dictionaries to hash tables, symbols pack to strings,
vectors and lists to arrays. See the relevant sections for the exact details.</p><p>While the MessagePack type system does define the most common types, there is
always room for extension. This is what the <span class="RktSym"><a href="#%28form._%28%28lib._msgpack%2Fmain..rkt%29._.Ext%29%29" class="RktStxLink" data-pltdoc="x">Ext</a></span> type is for: every
instance is a pair of an integer number and a byte string The number is a tag
which specifies the type of the extension and the byte string carries the
actual data.</p><p>MessagePack reserves negative type values for its own extensions, while
non-negative type values are for your custom extensions. Let us assume you want
to pack exact rational numbers without losing the exactness. None of the
default types are suitable, so we will pick extension type zero.</p><p><div class="SIntrapara">Encoding exact rationals as an extension</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">msgpack</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rational-&gt;ext</span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=when_unless.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._unless%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">unless</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._rational%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">rational?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">throw</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">type-error</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._ext%29%29" class="RktValLink" data-pltdoc="x">ext</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._numerator%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">numerator</a></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._denominator%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">denominator</a></span><span class="hspace">&nbsp;</span><span class="RktSym">q</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">rational-&gt;ext</span><span class="hspace">&nbsp;</span><span class="RktVal">2/3</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(ext 0 #"\2\3")</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext-&gt;rational</span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%252A-values%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">let*-values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._rest%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">rest</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%2Frest%29%29" class="RktValLink" data-pltdoc="x">unpack/rest</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._ext-data%29%29" class="RktValLink" data-pltdoc="x">ext-data</a></span><span class="hspace">&nbsp;</span><span class="RktSym">e</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">d</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._rest%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">rest</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252F%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">d</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">ext-&gt;rational</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._ext%29%29" class="RktValLink" data-pltdoc="x">ext</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">#"\2\3"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2/3</span></p></td></tr></table></blockquote></div></p><p>Of course our recipient must also be aware of our extension. In the above
example we pack the two components of our rational number as two integers and
unpack by unpacking the data twice. The first time around we use
<span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%2Frest%29%29" class="RktValLink" data-pltdoc="x">unpack/rest</a></span>, which returns two values: the unpacked object and the
remaining packed data. Then we call <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span>, which returns only the
unpacked object, because we only care about that object, not the remaining data
(not that there would be any remaining data in this case anyway).</p><h3 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;MessagePack_API&quot;">2<tt>&nbsp;</tt><a name="(part._.Message.Pack_.A.P.I)"></a>MessagePack API</h3><p>All of the API is exposed via the <span class="RktSym">msgpack</span> module, which only serves to
re-export the binding from the more specific sub-modules. We can divide the
library into three tasks: packing data, unpacking data, and the auxiliary data
types provided for dealing with MessagePack data. The following sections
discuss these tasks and the associated modules.</p><h4 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;MessagePack_types&quot;">2.1<tt>&nbsp;</tt><a name="(part._.Message.Pack_types)"></a>MessagePack types</h4><p>The
<a href="https://github.com/msgpack/msgpack/blob/master/spec.md">MessagePack
specification</a> specifies which types the format supports. Most of these neatly
map onto the types provided by Guile out of the box, only the extension type
<span class="RktSym"><a href="#%28form._%28%28lib._msgpack%2Fmain..rkt%29._.Ext%29%29" class="RktStxLink" data-pltdoc="x">Ext</a></span> needs to be explicityly defined.</p><h5 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;Packable_types&quot;">2.1.1<tt>&nbsp;</tt><a name="(part._.Packable_types)"></a><a name="(mod-path._msgpack/packable)"></a>Packable types</h5><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._msgpack%2Fpackable%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">msgpack/packable</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/msgpack" title="Install this package using `raco pkg install msgpack`"><span class="stt">msgpack</span></a></span></td></tr></table></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><a name="(form._((lib._msgpack/main..rkt)._.Packable))"></a><span title="Provided from: msgpack, msgpack/ext, msgpack/pack, msgpack/unpack | Package: msgpack"><span class="RktSym"><a href="#%28form._%28%28lib._msgpack%2Fmain..rkt%29._.Packable%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">Packable</a></span></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Union of all packable types for use with Typed Racket. Use this as the most
general type for objects you can send to <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack-to%29%29" class="RktValLink" data-pltdoc="x">pack-to</a></span>,
or receive from <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span>, <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%2Frest%29%29" class="RktValLink" data-pltdoc="x">unpack/rest</a></span> and
<span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack-from%29%29" class="RktValLink" data-pltdoc="x">unpack-from</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._msgpack/main..rkt)._packable~3f))"></a><span title="Provided from: msgpack, msgpack/ext, msgpack/pack, msgpack/unpack | Package: msgpack"><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._packable~3f%29%29" class="RktValDef RktValLink" data-pltdoc="x">packable?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">Any</span></td></tr></table></blockquote></div><div class="SIntrapara">True if <span class="RktVar">x</span> can be packed by MessagePack.</div></p><h5 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;MessagePack_extension_type&quot;">2.1.2<tt>&nbsp;</tt><a name="(part._.Message.Pack_extension_type)"></a><a name="(mod-path._msgpack/ext)"></a>MessagePack extension type</h5><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._msgpack%2Fext%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">msgpack/ext</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/msgpack" title="Install this package using `raco pkg install msgpack`"><span class="stt">msgpack</span></a></span></td></tr></table></p><p>MessagePack allows for custom types to be defined via the <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._ext%29%29" class="RktValLink" data-pltdoc="x">ext</a></span> type. An
extension is a tagged byte sequence: the tag is a signed 8-bit integer and the
data is an ordered sequence of bytes. Non-negative tag values are free to be
used for any purpose, but negative tag values are reserved for future extension
by MessagePack.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><a name="(form._((lib._msgpack/main..rkt)._.Ext))"></a><span title="Provided from: msgpack, msgpack/ext | Package: msgpack"><span class="RktSym"><a href="#%28form._%28%28lib._msgpack%2Fmain..rkt%29._.Ext%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">Ext</a></span></span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">The type of an <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._ext%29%29" class="RktValLink" data-pltdoc="x">ext</a></span> structure for use with Typed Racket. The
constructor for extension objects is <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._ext%29%29" class="RktValLink" data-pltdoc="x">ext</a></span>.
</div><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><p class="RForeground"><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="stt"> </span><a name="(def._((lib._msgpack/main..rkt)._ext-data))"></a><a name="(def._((lib._msgpack/main..rkt)._ext-type))"></a><a name="(def._((lib._msgpack/main..rkt)._ext~3f))"></a><a name="(def._((lib._msgpack/main..rkt)._struct~3aext))"></a><a name="(def._((lib._msgpack/main..rkt)._ext))"></a><span title="Provided from: msgpack, msgpack/ext | Package: msgpack"><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._ext%29%29" class="RktValDef RktValLink" data-pltdoc="x">ext</a></span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">type</span><span class="stt"> </span><span class="RktSym">data</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._and%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">and/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._integer%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">integer?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._integer-in%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">integer-in</a></span><span class="hspace">&nbsp;</span><span class="RktVal"><span class="nobreak">-1</span>28</span><span class="hspace">&nbsp;</span><span class="RktVal">127</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">data</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Represents a MessagePack extension type, a pair of a signed 8-bit
<span class="RktSym">type</span> integer and a <span class="RktSym">data</span> byte string of less than 4GiB in
length. The type name for Typed Racket is <span class="RktSym"><a href="#%28form._%28%28lib._msgpack%2Fmain..rkt%29._.Ext%29%29" class="RktStxLink" data-pltdoc="x">Ext</a></span>.</div></p><h4 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;Packing&quot;">2.2<tt>&nbsp;</tt><a name="(part._.Packing)"></a><a name="(mod-path._msgpack/pack)"></a>Packing</h4><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._msgpack%2Fpack%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">msgpack/pack</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/msgpack" title="Install this package using `raco pkg install msgpack`"><span class="stt">msgpack</span></a></span></td></tr></table></p><p>Packing is the act of serialising Racket objects to raw bytes. Racket objecs
are packed according to the following rules:</p><ul><li><p>The <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">void</a></span> object gets packed as <span class="RktSym">nil</span><span class="RktMeta"></span>.</p></li><li><p>Both booleans <span class="RktVal">#t</span> and <span class="RktVal">#f</span> get packed as boolean values.</p></li><li><p>Real exact integers get packed as integers. They must be in the range from
<span style="font-style: italic">-</span>2<span style="font-style: italic"></span><span style="vertical-align: super; font-size: 80%"><span style="font-style: italic"></span>6<span style="font-style: italic"></span>3<span style="font-style: italic"></span></span><span style="font-style: italic"></span> to <span style="font-style: italic"></span>2<span style="font-style: italic"></span><span style="vertical-align: super; font-size: 80%"><span style="font-style: italic"></span>6<span style="font-style: italic"></span>4<span style="font-style: italic"></span></span><span style="font-style: italic"> - </span>1<span style="font-style: italic"></span> (both inclusive).</p></li><li><p>Real numbers (including rationals) get packed as floating-point numbers.
The default precision is double, but if the number is a
<span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._single-flonum%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">single-flonum?</a></span> it is packed with single precision as well.</p></li><li><p>Strings get packed a text strings, byte strings get packed a binary strings</p></li><li><p>Vectors and lists get packed as arrays. This will get stuck in an infinite
loop if the vector or list contains cycles.</p></li><li><p>Hash tables get packed as maps.</p></li><li><p><span class="RktSym"><a href="#%28form._%28%28lib._msgpack%2Fmain..rkt%29._.Ext%29%29" class="RktStxLink" data-pltdoc="x">Ext</a></span> objects get packed as extension objects.</p></li></ul><p>If there is more than one possibility the first one applicable in the above
order is used. If there is more than one way of packing an object, the format
with the least bytes will be chosen.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._msgpack/main..rkt)._pack-to))"></a><span title="Provided from: msgpack, msgpack/pack | Package: msgpack"><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack-to%29%29" class="RktValDef RktValLink" data-pltdoc="x">pack-to</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">out</span><span class="hspace">&nbsp;</span><span class="RktVar">datum</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">any</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">out</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._and%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">and/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._output-port%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">output-port?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._not%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">not/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._port-closed%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">port-closed?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">datum</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._packable~3f%29%29" class="RktValLink" data-pltdoc="x">packable?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Pack each <span class="RktVar">datum</span> into the open binary output port <span class="RktVar">out</span>. If
there are multiple ways of packing a <span class="RktVar">datum</span> the smallest possible
format will be preferred. If the datum is a collection the packing procedure
is called recursively.</div></p><p>If a <span class="RktVar">datum</span> cannot be packed an exception will be raised. If the
<span class="RktVar">datum</span> can only be packed partially (for example if a vector contains an
unpackable object) an exception will be raised as well, but bytes might already
have been written to <span class="RktVar">out</span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._msgpack/main..rkt)._pack))"></a><span title="Provided from: msgpack, msgpack/pack | Package: msgpack"><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValDef RktValLink" data-pltdoc="x">pack</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">datum</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">datum</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._packable~3f%29%29" class="RktValLink" data-pltdoc="x">packable?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack-to%29%29" class="RktValLink" data-pltdoc="x">pack-to</a></span>, but instead of packing to a port return the
packed data as a byte string.</div></p><h4 x-source-module="(lib &quot;msgpack/scribblings/msgpack.scrbl&quot;)" x-source-pkg="msgpack" x-part-tag="&quot;Unpacking&quot;">2.3<tt>&nbsp;</tt><a name="(part._.Unpacking)"></a><a name="(mod-path._msgpack/unpack)"></a>Unpacking</h4><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._msgpack%2Funpack%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">msgpack/unpack</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/msgpack" title="Install this package using `raco pkg install msgpack`"><span class="stt">msgpack</span></a></span></td></tr></table></p><p>Unpacking is the act of deserialising raw bytes objects to Racket. Racket objecs
are unpacked according to the following rules:</p><ul><li><p>The <span class="RktSym">nil</span><span class="RktMeta"></span> object gets unpacked to an instance of <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">void</a></span>.</p></li><li><p>Boolean objects get unpacked to <span class="RktVal">#t</span> or <span class="RktVal">#f</span>.</p></li><li><p>Integers get unpacked to exact real integer numbers.</p></li><li><p>Floating point numbers get unpacked to inexact real numbers.</p></li><li><p>Strings get unpacked to strings, Binary strings get unpacked to
bytevectors.</p></li><li><p>Arrays get unpacked to vectors.</p></li><li><p>Maps get unpacked to hash tables using <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._equal%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">equal?</a></span> for key comparison.</p></li><li><p>Extension objects get unpacked to <span class="RktSym"><a href="#%28form._%28%28lib._msgpack%2Fmain..rkt%29._.Ext%29%29" class="RktStxLink" data-pltdoc="x">Ext</a></span> objects.</p></li></ul><p>I tried to chose mappings which preserve semantic meaning and use existing data
types, but of course no such mapping is perfect. If you disagree, I recommend
wrapping the <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack-from%29%29" class="RktValLink" data-pltdoc="x">unpack-from</a></span>, <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span> and <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%2Frest%29%29" class="RktValLink" data-pltdoc="x">unpack/rest</a></span>
procedures like this:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">msgpack</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">datum</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#"\300"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._cond%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">cond</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">void?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">datum</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">else</a></span><span class="hspace">&nbsp;</span><span class="RktSym">datum</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></blockquote><p>This wrapping can also be used to map <span class="RktVal">"Ext"</span> objects onto whatever they
are meant to actually represent in your application.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._msgpack/main..rkt)._unpack-from))"></a><span title="Provided from: msgpack, msgpack/unpack | Package: msgpack"><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack-from%29%29" class="RktValDef RktValLink" data-pltdoc="x">unpack-from</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">in</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._packable~3f%29%29" class="RktValLink" data-pltdoc="x">packable?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">in</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._and%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">and/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._input-port%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">input-port?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._not%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">not/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._port-closed%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">port-closed?</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Unpack a datum from <span class="RktVar">in</span>. At least one byte is consumed in the process
to read the tag, more bytes are consumed as needed by the type of data.</div></p><p>Unpacks a single object from the open binary input port <span class="RktVar">in</span> and
returns the unpacked object. If the object is a collection this  procedure is
called recursively.</p><p>If the port is empty, meaning that not a single byte could be read, of if not
enough bytes could be read to form a complete object, or if there are objects
missing from a collection (such as an array or a map) an unexpected EOF
exception will be raised.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._msgpack/main..rkt)._unpack))"></a><span title="Provided from: msgpack, msgpack/unpack | Package: msgpack"><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValDef RktValLink" data-pltdoc="x">unpack</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">bstr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._packable~3f%29%29" class="RktValLink" data-pltdoc="x">packable?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">bstr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack-from%29%29" class="RktValLink" data-pltdoc="x">unpack-from</a></span>, except it reads from the byte string
<span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes</a></span> and returns the unpacked object.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._msgpack/main..rkt)._unpack/rest))"></a><span title="Provided from: msgpack, msgpack/unpack | Package: msgpack"><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%2Frest%29%29" class="RktValDef RktValLink" data-pltdoc="x">unpack/rest</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">bstr</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0"><tr><td><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._packable~3f%29%29" class="RktValLink" data-pltdoc="x">packable?</a></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span></td></tr></table></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">bstr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%29%29" class="RktValLink" data-pltdoc="x">unpack</a></span>, except that it returns two values: the unpacked
object and the remaining packed bytes. Since <span class="RktVar">bstr</span> can contain
multiple objects we need a way of unpacking them all one by one. The
following example will recursively unpack all objects into a list:</div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">msgpack</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">packed</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._pack%29%29" class="RktValLink" data-pltdoc="x">pack</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"Hello"</span><span class="hspace">&nbsp;</span><span class="RktVal">23</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">objects</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">remaining</span><span class="hspace">&nbsp;</span><span class="RktSym">packed</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._let-values%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">let-values</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">obj</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._rest%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">rest</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._msgpack%2Fmain..rkt%29._unpack%2Frest%29%29" class="RktValLink" data-pltdoc="x">unpack/rest</a></span><span class="hspace">&nbsp;</span><span class="RktSym">remaining</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._zero%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes-length%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes-length</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._rest%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">rest</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Flist..rkt%2529._reverse%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">reverse</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">obj</span><span class="hspace">&nbsp;</span><span class="RktSym">objects</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._cons%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">cons</a></span><span class="hspace">&nbsp;</span><span class="RktSym">obj</span><span class="hspace">&nbsp;</span><span class="RktSym">objects</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528lib._racket%252Flist..rkt%2529._rest%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">rest</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'("Hello" 23 #f)</span></p></td></tr></table></blockquote><p>The condition for termination is whether there are any remaining bytes to
unpack.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>