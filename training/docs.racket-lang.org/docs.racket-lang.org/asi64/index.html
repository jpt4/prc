<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Asi64</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Asi64</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._overview%29" class="tocviewlink" data-pltdoc="x">Asi64 Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Getting_.Started%29" class="tocviewlink" data-pltdoc="x">Getting Started</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.Core_.Assembler_.Syntax%29" class="tocviewlink" data-pltdoc="x">Core Assembler Syntax</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._labels%29" class="tocviewlink" data-pltdoc="x">Labels</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._racket._integration%29" class="tocviewlink" data-pltdoc="x">Racket Integration</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="#%28part._.Pseudo-.Ops%29" class="tocviewlink" data-pltdoc="x">Pseudo-<wbr></wbr>Ops</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="#%28part._.Data%29" class="tocviewlink" data-pltdoc="x">Data</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="#%28part._.Code_.Diagnostics%29" class="tocviewlink" data-pltdoc="x">Code Diagnostics</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="#%28part._.Metaprogramming_.Helpers%29" class="tocviewlink" data-pltdoc="x">Metaprogramming Helpers</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="#%28part._emulator._configuration%29" class="tocviewlink" data-pltdoc="x">Emulator Configuration</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="#%28part._.Interesting_.Examples%29" class="tocviewlink" data-pltdoc="x">Interesting Examples</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="#%28part._.C64_.Helpers%29" class="tocviewlink" data-pltdoc="x">C64 Helpers</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">Asi64</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._overview%29" class="tocsubseclink" data-pltdoc="x">Asi64 Overview</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Getting_.Started%29" class="tocsubseclink" data-pltdoc="x">Getting Started</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Core_.Assembler_.Syntax%29" class="tocsubseclink" data-pltdoc="x">Core Assembler Syntax</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.General%29" class="tocsubseclink" data-pltdoc="x">General</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.Number_.Literals%29" class="tocsubseclink" data-pltdoc="x">Number Literals</a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Addressing_.Modes%29" class="tocsubseclink" data-pltdoc="x">Addressing Modes</a></td></tr><tr><td><span class="tocsublinknumber">3.4<tt>&nbsp;</tt></span><a href="#%28part._.Constants_and_.Variables%29" class="tocsubseclink" data-pltdoc="x">Constants and Variables</a></td></tr><tr><td><span class="tocsublinknumber">3.5<tt>&nbsp;</tt></span><a href="#%28part._.Memory_.Alignment%29" class="tocsubseclink" data-pltdoc="x">Memory Alignment</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._labels%29" class="tocsubseclink" data-pltdoc="x">Labels</a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.General%29" class="tocsubseclink" data-pltdoc="x">General</a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.Loading_.Label_.Locations%29" class="tocsubseclink" data-pltdoc="x">Loading Label Locations</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._racket._integration%29" class="tocsubseclink" data-pltdoc="x">Racket Integration</a></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._.Pseudo-.Ops%29" class="tocsubseclink" data-pltdoc="x">Pseudo-<wbr></wbr>Ops</a></td></tr><tr><td><span class="tocsublinknumber">7<tt>&nbsp;</tt></span><a href="#%28part._.Data%29" class="tocsubseclink" data-pltdoc="x">Data</a></td></tr><tr><td><span class="tocsublinknumber">8<tt>&nbsp;</tt></span><a href="#%28part._.Code_.Diagnostics%29" class="tocsubseclink" data-pltdoc="x">Code Diagnostics</a></td></tr><tr><td><span class="tocsublinknumber">9<tt>&nbsp;</tt></span><a href="#%28part._.Metaprogramming_.Helpers%29" class="tocsubseclink" data-pltdoc="x">Metaprogramming Helpers</a></td></tr><tr><td><span class="tocsublinknumber">10<tt>&nbsp;</tt></span><a href="#%28part._emulator._configuration%29" class="tocsubseclink" data-pltdoc="x">Emulator Configuration</a></td></tr><tr><td><span class="tocsublinknumber">11<tt>&nbsp;</tt></span><a href="#%28part._.Interesting_.Examples%29" class="tocsubseclink" data-pltdoc="x">Interesting Examples</a></td></tr><tr><td><span class="tocsublinknumber">12<tt>&nbsp;</tt></span><a href="#%28part._.C64_.Helpers%29" class="tocsubseclink" data-pltdoc="x">C64 Helpers</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.4</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._.Asi64)"></a>Asi64</h2><p><span style="font-style: italic">Written by <a href="http://www.pinksquirrellabs.com">Ross McKinlay</a></span></p><p>The Racket based cross-platform 6502  assembler.  Primarily aimed at programming the Commodore 64, with <a href="http://vice-emu.sourceforge.net/">VICE emulator</a> support.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._overview%29" class="toptoclink" data-pltdoc="x">1<span class="hspace">&nbsp;</span>Asi64 Overview</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Getting_.Started%29" class="toptoclink" data-pltdoc="x">2<span class="hspace">&nbsp;</span>Getting Started</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Core_.Assembler_.Syntax%29" class="toptoclink" data-pltdoc="x">3<span class="hspace">&nbsp;</span>Core Assembler Syntax</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.General%29" class="toclink" data-pltdoc="x">3.1<span class="hspace">&nbsp;</span>General</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Number_.Literals%29" class="toclink" data-pltdoc="x">3.2<span class="hspace">&nbsp;</span>Number Literals</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Addressing_.Modes%29" class="toclink" data-pltdoc="x">3.3<span class="hspace">&nbsp;</span>Addressing Modes</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Constants_and_.Variables%29" class="toclink" data-pltdoc="x">3.4<span class="hspace">&nbsp;</span>Constants and Variables</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Memory_.Alignment%29" class="toclink" data-pltdoc="x">3.5<span class="hspace">&nbsp;</span>Memory Alignment</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._labels%29" class="toptoclink" data-pltdoc="x">4<span class="hspace">&nbsp;</span>Labels</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.General%29" class="toclink" data-pltdoc="x">4.1<span class="hspace">&nbsp;</span>General</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Loading_.Label_.Locations%29" class="toclink" data-pltdoc="x">4.2<span class="hspace">&nbsp;</span>Loading Label Locations</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._racket._integration%29" class="toptoclink" data-pltdoc="x">5<span class="hspace">&nbsp;</span>Racket Integration</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Pseudo-.Ops%29" class="toptoclink" data-pltdoc="x">6<span class="hspace">&nbsp;</span>Pseudo-Ops</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Data%29" class="toptoclink" data-pltdoc="x">7<span class="hspace">&nbsp;</span>Data</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Code_.Diagnostics%29" class="toptoclink" data-pltdoc="x">8<span class="hspace">&nbsp;</span>Code Diagnostics</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Metaprogramming_.Helpers%29" class="toptoclink" data-pltdoc="x">9<span class="hspace">&nbsp;</span>Metaprogramming Helpers</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._emulator._configuration%29" class="toptoclink" data-pltdoc="x">10<span class="hspace">&nbsp;</span>Emulator Configuration</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.Interesting_.Examples%29" class="toptoclink" data-pltdoc="x">11<span class="hspace">&nbsp;</span>Interesting Examples</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.C64_.Helpers%29" class="toptoclink" data-pltdoc="x">12<span class="hspace">&nbsp;</span>C64 Helpers</a></p></td></tr></table><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;overview&quot;">1<tt>&nbsp;</tt><a name="(part._overview)"></a>Asi64 Overview</h3><p>The overall philosophy of this project is to take an old idea (a 6502 macro assembler) and supercharge it with Racket&rsquo;s macro system.  The end result is a powerful combination of part assembler, part meta-programming language that lets you combine all the power of Racket with a raw but feature-rich assembler.</p><p>Since Racket embraces this manner of design, it is quite easy to change, extend, or even build new languages over the top of it.</p><p>The assembler is primarily aimed at programming the Commodore 64, and includes support for the emulator <a href="http://vice-emu.sourceforge.net/">VICE</a>. It is able to launch the emulator post-compilation, passing along both your breakpoints and labels, resulting in a fast development cycle.  The full instruction set is supported, including the illegal opcodes.</p><p>An assembler is a powerful low-level tool. An overall choice was made to expose all (or almost all) of the internals of the assembler to the programmer.  The special assembler syntax provided is, afterall, simply a wrapper around the underlying library, consisting of some macros, functions and read-table modifications.  The programmer is able to inspect and modify the assembler internals as they please. This can make it easier to write complex macros that directly program the internals without having to jump through hoops using the provided layers of syntax.</p><p>The code can be found at the <a href="https://github.com/pezipink/asi64">git repository found here</a>.</p><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Getting_Started&quot;">2<tt>&nbsp;</tt><a name="(part._.Getting_.Started)"></a><a name="(mod-path._asi64)"></a>Getting Started</h3><p><div class="SIntrapara">You can find asi64 on Racket&rsquo;s package manager. <span class="stt">raco pkg install asi64</span> should get you setup and ready to go. Create a Racket file somewhere for your program, and have <a href="http://vice-emu.sourceforge.net/">VICE</a> installed and ready to go.
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="#%28mod-path._asi64%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">asi64</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/asi64" title="Install this package using `raco pkg install asi64`"><span class="stt">asi64</span></a></span></td></tr></table></div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">setup emulator</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">set-emulator-program!</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktVal">"c64.prg"</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">set-emulator-execute?!</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eq%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">eq?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=runtime.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._system-type%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">system-type</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">os</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">windows</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-emulator-path!</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktVal">"C:\\Program Files\\WinVICE-3.0-x64\\x64.exe"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-emulator-path!</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktVal">"/snap/bin/vice-jz.x64"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">main program</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">C64</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">*=</span><span class="hspace">&nbsp;</span><span class="RktSym">$1000</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">start at $1000</span></td></tr><tr><td><span class="RktSym">:loop</span><span class="hspace">&nbsp;</span><span class="RktSym">inc</span><span class="hspace">&nbsp;</span><span class="RktSym">$d021</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">flash border</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">jmp</span><span class="hspace">&nbsp;</span><span class="RktSym">loop-</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">loop forever</span></td></tr><tr><td><span class="RktPn">}</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The first few lines tell the assembler where to create the output file, whether to start the emulator post-assembly, and the location of the emulator itself.  See <a href="#%28part._emulator._configuration%29" data-pltdoc="x">Emulator Configuration</a> for more information.</p><p>An asi64 program must contain a single core form <span class="stt">C64</span>.  Within this form is expected to be a single 6502 block, denoted by <span class="hspace">&nbsp;</span><span class="stt">{ }</span>.</p><p>If you compile this program, it should assemble the resulting file and start the emulator with it for you to enjoy (hopefully!)</p><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Core_Assembler_Syntax&quot;">3<tt>&nbsp;</tt><a name="(part._.Core_.Assembler_.Syntax)"></a>Core Assembler Syntax</h3><h4 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;General&quot;">3.1<tt>&nbsp;</tt><a name="(part._.General)"></a>General</h4><p>Asi64 tries to stay as close to traditional 6502 assembler as possible. However, a few changes had to be made to ensure all of Racket is available.</p><p>You can write 6502 assembler code anywhere between <span class="stt">{ }</span>.  These blocks can be mixed and nested arbitrarily with other Racket forms - see <a href="#%28part._racket._integration%29" data-pltdoc="x">Racket Integration</a> for more infromation.</p><p>Within the 6502 blocks, each opcode must appear on its own line.  Operands can be formed of literals or Racket expressions, and labels can appear in a variety of places, see the <a href="#%28part._labels%29" data-pltdoc="x">Labels</a> section for more information.</p><h4 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Number_Literals&quot;">3.2<tt>&nbsp;</tt><a name="(part._.Number_.Literals)"></a>Number Literals</h4><p>Asi64 provides hexadecimal <span class="stt">$</span> and binary <span class="stt">%</span> literals, which  can be used everywhere in an asi64 program, not just within 6502 blocks.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">@%1111_0000</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">binary </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">$d020</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">hex</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><p>Binary literals are able to have any amount of underscore characters within them, to help visually separate groups of bits.</p><h4 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Addressing_Modes&quot;">3.3<tt>&nbsp;</tt><a name="(part._.Addressing_.Modes)"></a>Addressing Modes</h4><p>Immediate addressing mode is traditionally <span class="stt">#</span>.  Since <span class="stt">#</span> is already used for things in Racket, asi64 instead uses @.  Therefore, <span class="stt">lda #42</span> becomes <span class="stt">lda </span>@<span class="stt">42</span></p><p>Indexed adrressing modes are almost the same, removing the comma.  <span class="stt">sta $2000,x</span>  becomes <span class="stt">sta $2000 x</span>.</p><p>Finally, indirect addressing modes are quite different, since the traditional parenthesis would have caused havoc.  Instread, prefix the operand with &#163;, and remove the comma where applicable.  <span class="stt">sta ($20),y</span> becomes <span class="stt">sta &#163; $20 y</span>  and <span class="stt">jmp ($4000)</span> becomes <span class="stt">jmp &#163; $4000</span>.</p><p>If the <span class="stt">&#163;</span> character is not on your keyboard, you can easily change it to something else by modifiying <span class="stt">"reader.rkt"</span>.</p><h4 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Constants_and_Variables&quot;">3.4<tt>&nbsp;</tt><a name="(part._.Constants_and_.Variables)"></a>Constants and Variables</h4><p>Although it is possible to use Racket&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span> and friends as normal in 6502 blocks, it can get quite verbose.  A shorthand for <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span> is provided in the format of <span class="hspace">&nbsp;</span><span class="stt">name = value </span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3d%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">$42</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3d%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">%0000_1111</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3d%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktSym">$2</span><span class="hspace">&nbsp;</span><span class="RktSym">%11</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><p>These can appear in any 6502 block.  It can be quite useful to have a large block near the top of the file that holds global constants and variables.</p><h4 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Memory_Alignment&quot;">3.5<tt>&nbsp;</tt><a name="(part._.Memory_.Alignment)"></a>Memory Alignment</h4><p>Asi64 provides two commands for controlling the current assembly location.  The first is an absolute address in the format *= $2000 .  The second aligns the assembler to the nearest address divisible by the operand /= $1000<span class="stt"> </span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">*=</span><span class="hspace">&nbsp;</span><span class="RktSym">$2000</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">start assembling at $2000</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">some code here ...</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">/=</span><span class="hspace">&nbsp;</span><span class="RktSym">$1000</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">align to the nearest $1000 boundary</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">some data table here ...</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><p>Asi64 will warn you if it assembles over the top of a memory location it has previously written to.</p><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;labels&quot;">4<tt>&nbsp;</tt><a name="(part._labels)"></a>Labels</h3><h4 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;General&quot;">4.1<tt>&nbsp;</tt><a name="(part._.General)"></a>General</h4><p>Labels in asi64 must always start with <span class="stt">:</span></p><p>When using a label as a target, drop the leading <span class="stt">:</span> and suffix with one of the following.</p><ul><li><p>: search for a uniquely named label in the program, warning if more than one is found</p></li><li><p>+ search for a label after this memory location</p></li><li><p>- search for a label before this memory location</p></li></ul><p>The latter two options allow you to have many labels with the same name.</p><p>The assembler will uniquely number any labels with the same name before passing them to the emulator, to ensure they always appear in the disassembly.</p><p>Labels can appear in most places, including before raw data and operands.</p><p>The following example shows various absolute labels including an operand label that enables simple self-modifying code</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="RktSym">:a</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">:b</span><span class="hspace">&nbsp;</span><span class="RktSym">@0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">$d021</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">inc</span><span class="hspace">&nbsp;</span><span class="RktSym">b:</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">jmp</span><span class="hspace">&nbsp;</span><span class="RktSym">a:</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><p>The following example shows multiple labels with the same name, and using relative labels with + and -</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">some zero-page address</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">state</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%7E3d%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">$42</span></td></tr><tr><td><span class="RktSym">:loop</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">wait for the raster to hit the bottom of the screen</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">$d012</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">cmp</span><span class="hspace">&nbsp;</span><span class="RktSym">@$ff</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">bne</span><span class="hspace">&nbsp;</span><span class="RktSym">loop-</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">ldx</span><span class="hspace">&nbsp;</span><span class="RktSym">state</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">bne</span><span class="hspace">&nbsp;</span><span class="RktSym">next+</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">not zero</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">code here for 0...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">jmp</span><span class="hspace">&nbsp;</span><span class="RktSym">loop-</span></td></tr><tr><td><span class="RktSym">:next</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">cpx</span><span class="hspace">&nbsp;</span><span class="RktSym">@1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">bne</span><span class="hspace">&nbsp;</span><span class="RktSym">next+</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">not 1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">code here for 1 ...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">jmp</span><span class="hspace">&nbsp;</span><span class="RktSym">loop-</span></td></tr><tr><td><span class="RktSym">:next</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">cpx</span><span class="hspace">&nbsp;</span><span class="RktSym">@2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">.. and so on</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><h4 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Loading_Label_Locations&quot;">4.2<tt>&nbsp;</tt><a name="(part._.Loading_.Label_.Locations)"></a>Loading Label Locations</h4><p>A common assembler feature is to load a label location as an immediate value, for setting interrupt routines, and self modifiyng code. You can extract the low and high bytes from a label using &lt; and &gt; as you can in most assemblers.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">@&lt;int:</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">low part of address of interrupt handler code</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">ldx</span><span class="hspace">&nbsp;</span><span class="RktSym">@&gt;int:</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">high part of address of interrupt handler code</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">$0314</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">store in interrupt vector</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">stx</span><span class="hspace">&nbsp;</span><span class="RktSym">$0315</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">:int</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">interrupt handler here</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><p>Finally, a macro <span class="stt">label-loc</span> will return the 16bit value of the label directly (following the suffix rules) so that you can use it as part of an expression.</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="RktSym">:a</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">@0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">$d021</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">inc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">label-loc</span><span class="hspace">&nbsp;</span><span class="RktSym">a-</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">self modifing code</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">jmp</span><span class="hspace">&nbsp;</span><span class="RktSym">a-</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote></div><div class="SIntrapara">This currently only works if the label was defined before the macro use in the source.</div></p><p>The above example is for illustration only, it could be written easier using an operand label like so, as per the example in the previous section.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="RktSym">:a</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">:b</span><span class="hspace">&nbsp;</span><span class="RktSym">@0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">$d021</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">inc</span><span class="hspace">&nbsp;</span><span class="RktSym">b:</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">jmp</span><span class="hspace">&nbsp;</span><span class="RktSym">a:</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;racket integration&quot;">5<tt>&nbsp;</tt><a name="(part._racket._integration)"></a>Racket Integration</h3><p>Even inside { } 6502 blocks, you still have all of Racket. As long as the program ends up outputting 6502 blocks, or lists of them, you can write whatever you like. Anything that is not a 6502 block will simply be ignored when assembling.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mov</span><span class="hspace">&nbsp;</span><span class="RktSym">src</span><span class="hspace">&nbsp;</span><span class="RktSym">dst</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">@src</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">dst</span></td></tr><tr><td><span class="RktPn">}</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">C64</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">*=$1000</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">$42</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">@</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">$d021</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mov</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._-%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x"><span class="nobreak">-</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">$d021</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">}</span><span class="RktPn">)</span></td></tr></table></blockquote><p>6502 blocks can also be nested inside of each other, enabling you to mix arbitary Racket and 6502 forms wherever you like in the manner you would expect.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">*=$1000</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">@$20</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">unroll some code to clear a bit of the video memory</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=sequences.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._in-range%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">in-range</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=let.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._let%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">address</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">$0400</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">{</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">address</span><span class="RktPn">}</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Pseudo-Ops&quot;">6<tt>&nbsp;</tt><a name="(part._.Pseudo-.Ops)"></a>Pseudo-Ops</h3><p>In the previous example, the function <span class="stt">mov</span> determines the immediate addressing mode itself, since ultimately it is part of the opcode rather than the operand. This greatly reduces the reusablity of the code since you&rsquo;d have to have another <span class="stt">mov</span> to move from a location in memory. The macro <span class="stt">(define-op ex)</span> will re-write your function so that the addressing mode is determined at the call site.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define-op</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mov</span><span class="hspace">&nbsp;</span><span class="RktSym">src</span><span class="hspace">&nbsp;</span><span class="RktSym">dst</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">src</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">dst</span></td></tr><tr><td><span class="RktPn">}</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">C64</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">*=$1000</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mov</span><span class="hspace">&nbsp;</span><span class="RktSym">@42</span><span class="hspace">&nbsp;</span><span class="RktSym">$20</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mov</span><span class="hspace">&nbsp;</span><span class="RktSym">$2000</span><span class="hspace">&nbsp;</span><span class="RktSym">$20</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">mov</span><span class="hspace">&nbsp;</span><span class="RktSym">$20</span><span class="hspace">&nbsp;</span><span class="RktSym">$2000</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">}</span><span class="RktPn">)</span></td></tr></table></blockquote><p><div class="SIntrapara">The macro also introduces a few values for the programmer to use that provide metadata about the parameters. Currently you can use
</div><div class="SIntrapara"><ul><li><p>param-name-16bit? True if the operand is a 16 bit immediate value or 16-bit memory address</p></li><li><p>param-name-immediate? True if the parameter is immediate.</p></li></ul></div></p><p><div class="SIntrapara">These let you write general operations that are intelligent about their operands.
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">adds to a 16 bit number, little-endian fashion.</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">detects 8 bit immediate numbers and optimises</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">as appropriate. for absolute, assumes 16bit to 16bit</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define-op</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add16</span><span class="hspace">&nbsp;</span><span class="RktSym">source</span><span class="hspace">&nbsp;</span><span class="RktSym">dest</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._if%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktSym">source-16bit?</span><span class="hspace">&nbsp;</span><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">clc</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">16 bit </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">dest</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">adc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lo-byte</span><span class="hspace">&nbsp;</span><span class="RktSym">source</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">dest</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">hi-byte</span><span class="hspace">&nbsp;</span><span class="RktSym">source</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">adc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dest</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dest</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">}</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">{</span><span class="RktSym">clc</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">dest</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">adc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lo-byte</span><span class="hspace">&nbsp;</span><span class="RktSym">source</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">dest</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">bcc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">here</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">inc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252B%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">+</a></span><span class="hspace">&nbsp;</span><span class="RktSym">dest</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">}</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote></div></p><p>This example could be better, it doesn&rsquo;t deal with 8 bit to 16 bit memory locations.</p><p>A few other handy functions are being used here - <span class="stt">(lo-byte)</span> <span class="stt">(high-byte)</span> and <span class="stt">(here)</span>. The latter will yield the current instruction location and is handy for infinte loops, skipping instructions and self-modifing code, without having to use labels.</p><p>Pseudo-ops can sometimes be nested in each other. (working on this!)</p><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Data&quot;">7<tt>&nbsp;</tt><a name="(part._.Data)"></a>Data</h3><p>Inserting blocks of arbitrary binary data is accomplished with the <span class="stt">(data ...)</span> macro.  It accepts any number of bytes and writes then directly.  If an argument is a Racket <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list</a></span>, it will be recusrively unwrapped and its ultimate contents written to memory.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">deg-&gt;rad</span><span class="hspace">&nbsp;</span><span class="RktSym">rad</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252A%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252F%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">/</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._pi%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">pi</a></span><span class="hspace">&nbsp;</span><span class="RktVal">180</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">rad</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktSym">:sine</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">data</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%252Flist%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=sequences.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._in-range%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">in-range</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktVal">365</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bitwise-and%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bitwise-and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fmath..rkt%2529._exact-round%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exact-round</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._%252A%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">*</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._sin%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">sin</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">deg-&gt;rad</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">255</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Code_Diagnostics&quot;">8<tt>&nbsp;</tt><a name="(part._.Code_.Diagnostics)"></a>Code Diagnostics</h3><p>Asi64 knows about the 6502 instruction set and is able to tell you useful information about your code, such as how many cycles each instruction takes, which processor flags they might affect, and how much space the block occupies.</p><p>Simply wrap any code you are interested in seeing metrics about between <span class="stt">?=</span> and <span class="stt">=?</span>. When you assemble you will also see the information about your code blocks in the output window.  This doesn&rsquo;t affect the program that is produced in any way.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="RktSym">?=</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">begin diagnostics</span></td></tr><tr><td><span class="RktSym">:sprite-y-char-top</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">$d001</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sec</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sbc</span><span class="hspace">&nbsp;</span><span class="RktSym">@$32</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lsr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lsr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lsr</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">tax</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">screen-rows-lo:</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">screen-lo</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">screen-rows-hi:</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">screen-hi</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">rts</span></td></tr><tr><td><span class="RktSym">=?</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">end</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><p>this produces :</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktSym">diagnostics</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">started</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">at</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">$30ec</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">opcode</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">a-mode</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">cycles</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">flags</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">lda</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._abs%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">abs</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">4</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">Z</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">sec</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">none</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">C</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">sbc</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">i</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">C</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Z</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">V</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">lsr</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">none</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">C</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Z</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">lsr</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">none</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">C</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Z</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">lsr</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">none</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">C</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">Z</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">tax</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">none</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">2</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">Z</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">lda</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">absx</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">4/5</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">Z</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">sta</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">zp</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">3</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">lda</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">absx</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">4/5</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">Z</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">sta</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">zp</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">3</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">rts</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">none</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktVal">6</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">diagnostics</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">finished</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">at</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">$3101</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">total</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">code</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">size</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">$15</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktVal">21</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta"></span><span class="RktSym">min/max</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">cycles</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktVal">36/38</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Note that since you can put numbers and data anywhere, asi64 can only show you information about code assembled directly with the assembler syntax. If you put a <span class="stt">(data ...)</span> block in the middle of the code, the diagnostics will simply ignore it, even if the bytes equate to valid opcode(s).</p><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Metaprogramming_Helpers&quot;">9<tt>&nbsp;</tt><a name="(part._.Metaprogramming_.Helpers)"></a>Metaprogramming Helpers</h3><p>When you want to write code that writes other code, asi64 has a macro that helps you load the correct value for the combination of opcode and addressing mode you require.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">{</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">lda</span><span class="hspace">&nbsp;</span><span class="RktSym">@</span><span class="RktPn">(</span><span class="RktSym">infer</span><span class="hspace">&nbsp;</span><span class="RktSym">sta</span><span class="hspace">&nbsp;</span><span class="RktSym">&#163;</span><span class="hspace">&nbsp;</span><span class="RktSym">$ff</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">}</span></td></tr></table></blockquote><p>This code will load the accumulator with the immediate value of <span class="stt">$91</span>, the byte that represents the <span class="stt">sta</span> opcode in its indirect, y-offset addressing mode.</p><p>Of course, the actual address <span class="stt">$ff</span> here makes no difference, it is simply used to infer the addressing mode. If you had wrote <span class="stt">$ffff</span> it would have produced an error since the sta indirect addressing modes do not work with 16 bit addresses.</p><p>Unlike the rest of the assembler, you cannot use labels, expressions and other features within the infer macro, since it would make no sense to do so.</p><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;emulator configuration&quot;">10<tt>&nbsp;</tt><a name="(part._emulator._configuration)"></a>Emulator Configuration</h3><p>Emulator conifguration is achieved by setting fields of a struct that is exposed directly to the programmer.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">emulator</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">path</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">location of the emu executable</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">program</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">assembled file target path</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">breakpoints?</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">pass along breakpoints</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">labels?</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">pass along labels</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">execute?</span><span class="RktPn">)</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">execute the emu post assembly</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mutable</span><span class="RktPn">)</span></td></tr></table></blockquote><p>An instance of this struct <span class="stt">emu</span> is exposed and the programmer can set the fields in the typical Racket style.</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">set-emulator-execute?!</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">stop the emulator executing </span></p></blockquote><p>It can be useful to prevent the emulator executing after every assemble when working on long pieces of code or using the diagnostics facility to cycle count.</p><p>Note that the <span class="stt">program</span> field is not strictly associated with the emulator.  It is included here since it seems unlikely you would want to use asi64 without an emulator.  In the future, if asi64 is expanded to support other emulators, machines and same-family chips (NES, Lynx, SNES, Apple][+  ... ) this minimal design will likely change to something slightly more abstract.</p><p>An additional convenience function is provided that sets all the fields in one call.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">configure-emu</span><span class="hspace">&nbsp;</span><span class="RktSym">emu-path</span><span class="hspace">&nbsp;</span><span class="RktSym">program-path</span><span class="hspace">&nbsp;</span><span class="RktSym">execute-emu?</span><span class="hspace">&nbsp;</span><span class="RktSym">enable-breakpoints?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-emulator-program!</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktSym">program-path</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-emulator-execute?!</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktSym">execute-emu?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-emulator-breakpoints?!</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktSym">enable-breakpoints?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-emulator-path!</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktSym">emu-path</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set-emulator-execute?</span><span class="hspace">&nbsp;</span><span class="RktSym">emu</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr></table></blockquote><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;Interesting_Examples&quot;">11<tt>&nbsp;</tt><a name="(part._.Interesting_.Examples)"></a>Interesting Examples</h3><p>Coming Soon!</p><h3 x-source-module="(lib &quot;asi64/scribblings/asi64.scrbl&quot;)" x-source-pkg="asi64" x-part-tag="&quot;C64_Helpers&quot;">12<tt>&nbsp;</tt><a name="(part._.C64_.Helpers)"></a>C64 Helpers</h3><p>Coming Soon!</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>