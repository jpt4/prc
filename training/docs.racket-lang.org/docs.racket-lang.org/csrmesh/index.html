<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>csrmesh</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">csrmesh</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Introduction%29" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Protocol_.Documentation%29" class="tocviewlink" data-pltdoc="x">Protocol Documentation</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.A.P.I%29" class="tocviewlink" data-pltdoc="x">API</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">csrmesh</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Introduction%29" class="tocsubseclink" data-pltdoc="x">Introduction</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Protocol_.Documentation%29" class="tocsubseclink" data-pltdoc="x">Protocol Documentation</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Network_.Key%29" class="tocsubseclink" data-pltdoc="x">Network Key</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Authenticated_.Packets%29" class="tocsubseclink" data-pltdoc="x">Authenticated Packets</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.A.P.I%29" class="tocsubseclink" data-pltdoc="x">API</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Types%29" class="tocsubseclink" data-pltdoc="x">Types</a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">Pin</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Net.Key%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">Net<span class="mywbr"> &nbsp;</span>Key</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Encrypted-.Payload%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">Encrypted-<wbr></wbr>Payload</span></a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Payload%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">Payload</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Packet%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">Packet</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Seq.No%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">Seq<span class="mywbr"> &nbsp;</span>No</span></a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.C.S.R.Mesh_.Packets%29" class="tocsubseclink" data-pltdoc="x">CSRMesh Packets</a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._string-~3e.Pin%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">string-<wbr></wbr>&gt;Pin</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._network-key%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">network-<wbr></wbr>key</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._build-packet-with-key%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">build-<wbr></wbr>packet-<wbr></wbr>with-<wbr></wbr>key</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._build-packet-with-pin%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">build-<wbr></wbr>packet-<wbr></wbr>with-<wbr></wbr>pin</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Example_.Sketch%29" class="tocsubseclink" data-pltdoc="x">Example Sketch</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.4</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;csrmesh/scribblings/csrmesh.scrbl&quot;)" x-source-pkg="csrmesh" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._csrmesh)"></a>csrmesh</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Raymond Racine &lt;<a href="mailto:ray.racine@gmail.com">ray.racine@gmail.com</a>&gt;</p></span></div><h3 x-source-module="(lib &quot;csrmesh/scribblings/csrmesh.scrbl&quot;)" x-source-pkg="csrmesh" x-part-tag="&quot;Introduction&quot;">1<tt>&nbsp;</tt><a name="(part._.Introduction)"></a>Introduction</h3><h3 x-source-module="(lib &quot;csrmesh/scribblings/csrmesh.scrbl&quot;)" x-source-pkg="csrmesh" x-part-tag="&quot;Protocol_Documentation&quot;">2<tt>&nbsp;</tt><a name="(part._.Protocol_.Documentation)"></a>Protocol Documentation</h3><p>The following is a quoted description of the protocol as described by Nash Kaminski.
See https://kaminski.io  Full credit to Mr. Kaminski for his work in explaining the details of creating a CSRMesh packet.</p><h4 x-source-module="(lib &quot;csrmesh/scribblings/csrmesh.scrbl&quot;)" x-source-pkg="csrmesh" x-part-tag="&quot;Network_Key&quot;">2.1<tt>&nbsp;</tt><a name="(part._.Network_.Key)"></a>Network Key</h4><p>"The 128 bit network key used in CSRMesh networks is derived by concatenating the ASCII representation of the PIN with a null byte and the string &rsquo;MCP&rsquo;, computing the SHA256 hash of the string, reversing the order of the bytes in the resulting hash, and taking the first 16 bytes as the key."</p><h4 x-source-module="(lib &quot;csrmesh/scribblings/csrmesh.scrbl&quot;)" x-source-pkg="csrmesh" x-part-tag="&quot;Authenticated_Packets&quot;">2.2<tt>&nbsp;</tt><a name="(part._.Authenticated_.Packets)"></a>Authenticated Packets</h4><p>"Packets sent to CSRMesh devices require authentication as well as encryption. All multibyte types are represented in little endian format. To form a valid packet, the sequence/nonce value, constant 0x0080, and 10 null bytes are concatenated together to form a 128 bit initialization vector (IV). This IV, as well as the network key derived earlier is then used to initialize AES-128 in OFB mode. The arbitrary length data payload is then encrypted using this AES-OFB instance to form the encrypted payload. Next, a message authentication code is computed using HMAC-SHA256, using the network key as the secret, of the following data: 8 null bytes, sequence number, constant 0x80 and encrypted payload. The order of the bytes in the resulting hash are then reversed and the hash truncated to 8 bytes. The final output packet can then be built by contatenating the sequence/nonce value, constant 0x80, encrypted payload, truncated HMAC, and the constant 0xff."</p><h3 x-source-module="(lib &quot;csrmesh/scribblings/csrmesh.scrbl&quot;)" x-source-pkg="csrmesh" x-part-tag="&quot;API&quot;">3<tt>&nbsp;</tt><a name="(part._.A.P.I)"></a><a name="(mod-path._csrmesh)"></a>API</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._csrmesh%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">csrmesh</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/csrmesh" title="Install this package using `raco pkg install csrmesh`"><span class="stt">csrmesh</span></a></span></td></tr></table></p><h4 x-source-module="(lib &quot;csrmesh/scribblings/csrmesh.scrbl&quot;)" x-source-pkg="csrmesh" x-part-tag="&quot;Types&quot;">3.1<tt>&nbsp;</tt><a name="(part._.Types)"></a>Types</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._csrmesh/main..rkt)._.Pin))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValDef RktValLink" data-pltdoc="x">Pin</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">pin</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktPn">(</span><span class="RktSym">define-new-subtype</span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValLink" data-pltdoc="x">Pin</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">pin</span></span></span><span class="stt"> </span><span class="RktSym">Bytes</span><span class="RktPn">)</span><span class="RktPn">)</span> that represents a 4-digit ascii pin.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._csrmesh/main..rkt)._.Net.Key))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Net.Key%29%29" class="RktValDef RktValLink" data-pltdoc="x">NetKey</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">netkey</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktPn">(</span><span class="RktSym">define-new-subtype</span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Net.Key%29%29" class="RktValLink" data-pltdoc="x">NetKey</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">netkey</span></span></span><span class="stt"> </span><span class="RktSym">Bytes</span><span class="RktPn">)</span><span class="RktPn">)</span> that represents a CSRMesh Netkey.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._csrmesh/main..rkt)._.Encrypted-.Payload))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><span class="RktSymDef RktSym">Encrypted-Payload</span></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">encrypted-payload</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktPn">(</span><span class="RktSym">define-new-subtype</span><span class="stt"> </span><span class="RktSym">Encrypted-Payload</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">encrypted-payload</span><span class="stt"> </span><span class="RktSym">Bytes</span><span class="RktPn">)</span><span class="RktPn">)</span> that represents an encrypted CSRMesh payload.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._csrmesh/main..rkt)._.Payload))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Payload%29%29" class="RktValDef RktValLink" data-pltdoc="x">Payload</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">payload</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktPn">(</span><span class="RktSym">define-new-subtype</span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Payload%29%29" class="RktValLink" data-pltdoc="x">Payload</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">payload</span></span></span><span class="stt"> </span><span class="RktSym">Bytes</span><span class="RktPn">)</span><span class="RktPn">)</span> that represents a payload of bytes TO BE rendered into the payload of a CSRMech packet.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._csrmesh/main..rkt)._.Packet))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Packet%29%29" class="RktValDef RktValLink" data-pltdoc="x">Packet</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">packet</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes?</a></span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktPn">(</span><span class="RktSym">define-new-subtype</span><span class="stt"> </span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Packet%29%29" class="RktValLink" data-pltdoc="x">Packet</a></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">packet</span></span></span><span class="stt"> </span><span class="RktSym">Bytes</span><span class="RktPn">)</span><span class="RktPn">)</span> that represents a ready to send CSRMesh packet of some payload/message.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._csrmesh/main..rkt)._.Seq.No))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><span class="RktSymDef RktSym">SeqNo</span></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">Word32</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">seqno</span><span class="hspace">&nbsp;</span><span class="RktSym">Word32</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A <span class="RktPn">(</span><span class="RktSym">define-new-subtype</span><span class="stt"> </span><span class="RktSym">Seqno</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">seqno</span><span class="stt"> </span><span class="RktSym">Word32</span><span class="RktPn">)</span><span class="RktPn">)</span> that represents a packet sequence number used in the creation of a CSRMesh packet.</div></p><p>The sequence number of a packet is not only essential to the packet encryption but is also used by the mesh network in packet transmission.  The mesh "remembers" recently transmitted packet sequence numbers and will drop packets with the same sequence number.  An application using this library should ensure non-duplication of packet sequence numbers by either a global incrementing counter, a random generation of the next sequence number or similar scheme.</p><h4 x-source-module="(lib &quot;csrmesh/scribblings/csrmesh.scrbl&quot;)" x-source-pkg="csrmesh" x-part-tag="&quot;CSRMesh_Packets&quot;">3.2<tt>&nbsp;</tt><a name="(part._.C.S.R.Mesh_.Packets)"></a>CSRMesh Packets</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._csrmesh/main..rkt)._string-~3e.Pin))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._string-~3e.Pin%29%29" class="RktValDef RktValLink" data-pltdoc="x">string-&gt;Pin</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">pin</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValLink" data-pltdoc="x">Pin</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pin</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">String</span></td></tr></table></blockquote></div><div class="SIntrapara">Constructs a <span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValLink" data-pltdoc="x">Pin</a></span> from an ascii string.  Typically this is a 4 digit ascii value, e.g. "1234".</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._csrmesh/main..rkt)._network-key))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._network-key%29%29" class="RktValDef RktValLink" data-pltdoc="x">network-key</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">pin</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">NetworkKey</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pin</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValLink" data-pltdoc="x">Pin</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Cryptographically calculates the CSRMesh NetworkKey from a given <span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValLink" data-pltdoc="x">Pin</a></span>.  This is deterministic as the same <span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValLink" data-pltdoc="x">Pin</a></span> always creates the same <span class="RktSym">NetworkKey</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._csrmesh/main..rkt)._build-packet-with-key))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._build-packet-with-key%29%29" class="RktValDef RktValLink" data-pltdoc="x">build-packet-with-key</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">key</span><span class="hspace">&nbsp;</span><span class="RktVar">sno</span><span class="hspace">&nbsp;</span><span class="RktVar">payload</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Packet%29%29" class="RktValLink" data-pltdoc="x">Packet</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">key</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Net.Key%29%29" class="RktValLink" data-pltdoc="x">NetKey</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">sno</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">SeqNo</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">payload</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Payload%29%29" class="RktValLink" data-pltdoc="x">Payload</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Creates a ready to transmit CSRMesh Packet for the give payload, network key and sequence number.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._csrmesh/main..rkt)._build-packet-with-pin))"></a><span title="Provided from: csrmesh | Package: csrmesh"><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._build-packet-with-pin%29%29" class="RktValDef RktValLink" data-pltdoc="x">build-packet-with-pin</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">pin</span><span class="hspace">&nbsp;</span><span class="RktVar">sno</span><span class="hspace">&nbsp;</span><span class="RktVar">payload</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Packet%29%29" class="RktValLink" data-pltdoc="x">Packet</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">pin</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValLink" data-pltdoc="x">Pin</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">sno</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">SeqNo</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">payload</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Payload%29%29" class="RktValLink" data-pltdoc="x">Payload</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Creates a ready to transmit CSRMesh Packet for the give payload, pin and sequence number.</div></p><p>Re-calculates the <span class="RktSym">NetworkKey</span> from the givein <span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValLink" data-pltdoc="x">Pin</a></span> and then calls <span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._build-packet-with-key%29%29" class="RktValLink" data-pltdoc="x">build-packet-with-key</a></span>.</p><p>As a <span class="RktSym">NetworkKey</span> is uniquely cryptographically generated from a Pin, an application may generate the Network Key once for a Pin via <span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._network-key%29%29" class="RktValLink" data-pltdoc="x">network-key</a></span> and then using <span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._build-packet-with-key%29%29" class="RktValLink" data-pltdoc="x">build-packet-with-key</a></span> directly.</p><h4 x-source-module="(lib &quot;csrmesh/scribblings/csrmesh.scrbl&quot;)" x-source-pkg="csrmesh" x-part-tag="&quot;Example_Sketch&quot;">3.3<tt>&nbsp;</tt><a name="(part._.Example_.Sketch)"></a>Example Sketch</h4><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">pin</span></span></span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Pin%29%29" class="RktValLink" data-pltdoc="x">Pin</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._string-~3e.Pin%29%29" class="RktValLink" data-pltdoc="x">string-&gt;Pin</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"1234"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">net-key</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">NetworkKey</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._network-key%29%29" class="RktValLink" data-pltdoc="x">network-key</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="badlink"><span class="RktValLink">pin</span></span></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">my-payload</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Payload%29%29" class="RktValLink" data-pltdoc="x">Payload</a></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">payload</span></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=bytestrings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._bytes%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">bytes</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">next-seq-no</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">SeqNo</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">seqno</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._random%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">random</a></span><span class="hspace">&nbsp;</span><span class="RktVal">1000000</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">csr-pkt</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._.Packet%29%29" class="RktValLink" data-pltdoc="x">Packet</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._csrmesh%2Fmain..rkt%29._build-packet-with-key%29%29" class="RktValLink" data-pltdoc="x">build-packet-with-key</a></span><span class="hspace">&nbsp;</span><span class="RktSym">net-key</span><span class="hspace">&nbsp;</span><span class="RktSym">next-seq-no</span><span class="hspace">&nbsp;</span><span class="RktSym">my-payload</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>