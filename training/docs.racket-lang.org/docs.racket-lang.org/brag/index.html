<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>brag: a better Racket AST generator</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">brag:<span class="mywbr"> &nbsp;</span> a better Racket AST generator</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Quick_start%29" class="tocviewlink" data-pltdoc="x">Quick start</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Introduction%29" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.The_language%29" class="tocviewlink" data-pltdoc="x">The language</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Support_.A.P.I%29" class="tocviewlink" data-pltdoc="x">Support API</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">brag:<span class="mywbr"> &nbsp;</span> a better Racket AST generator</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Quick_start%29" class="tocsubseclink" data-pltdoc="x">Quick start</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Introduction%29" class="tocsubseclink" data-pltdoc="x">Introduction</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Example__a_small_.D.S.L_for_.A.S.C.I.I_diagrams%29" class="tocsubseclink" data-pltdoc="x">Example:<span class="mywbr"> &nbsp;</span> a small DSL for ASCII diagrams</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Parsing_the_concrete_syntax%29" class="tocsubseclink" data-pltdoc="x">Parsing the concrete syntax</a></td></tr><tr><td><span class="tocsublinknumber">2.3<tt>&nbsp;</tt></span><a href="#%28part._.From_parsing_to_interpretation%29" class="tocsubseclink" data-pltdoc="x">From parsing to interpretation</a></td></tr><tr><td><span class="tocsublinknumber">2.4<tt>&nbsp;</tt></span><a href="#%28part._.From_interpretation_to_compilation%29" class="tocsubseclink" data-pltdoc="x">From interpretation to compilation</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.The_language%29" class="tocsubseclink" data-pltdoc="x">The language</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._brag-syntax%29" class="tocsubseclink" data-pltdoc="x">Syntax and terminology</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._cuts-and-splices%29" class="tocsubseclink" data-pltdoc="x">Cuts &amp; splices</a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Syntax_errors%29" class="tocsubseclink" data-pltdoc="x">Syntax errors</a></td></tr><tr><td><span class="tocsublinknumber">3.4<tt>&nbsp;</tt></span><a href="#%28part._.Semantics%29" class="tocsubseclink" data-pltdoc="x">Semantics</a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">parse</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse-to-datum%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">parse-<wbr></wbr>to-<wbr></wbr>datum</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fmain..rkt%29._make-rule-parser%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">make-<wbr></wbr>rule-<wbr></wbr>parser</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._all-token-types%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">all-<wbr></wbr>token-<wbr></wbr>types</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Support_.A.P.I%29" class="tocsubseclink" data-pltdoc="x">Support API</a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">token</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token-struct%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">token-<wbr></wbr>struct</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._exn~3afail~3aparsing%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">exn:<span class="mywbr"> &nbsp;</span>fail:<span class="mywbr"> &nbsp;</span>parsing</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._apply-port-proc%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">apply-<wbr></wbr>port-<wbr></wbr>proc</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._apply-lexer%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">apply-<wbr></wbr>lexer</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._apply-tokenizer-maker%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">apply-<wbr></wbr>tokenizer-<wbr></wbr>maker</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._trim-ends%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">trim-<wbr></wbr>ends</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a%2A%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>*</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a%2B%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>+</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>?</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~3d%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>=</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~3e~3d%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>&gt;=</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a%2A%2A%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>**</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3aor%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>or</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~3a%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>:</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3aseq%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>seq</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~26%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>&amp;</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a-%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>-</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~7e%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>~</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a%2F%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">:<span class="mywbr"> &nbsp;</span>/</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._from%2Fto%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">from/<span class="mywbr"> &nbsp;</span>to</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._from%2Fstop-before%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">from/<span class="mywbr"> &nbsp;</span>stop-<wbr></wbr>before</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Differences_with_ragg%29" class="tocsubseclink" data-pltdoc="x">Differences with <span class="stt">ragg</span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.4</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._brag__a_better_.Racket_.A.S.T_generator)"></a><a name="(mod-path._brag)"></a>brag: a better Racket AST generator</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Danny Yoo (95%)<br/>and Matthew Butterick (5%)</p></span></div><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">brag</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/brag-lib" title="Install this package using `raco pkg install brag-lib`"><span class="stt">brag-lib</span></a></span></td></tr></table></p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>This is a fork of the <a href="https://docs.racket-lang.org/ragg"><span class="RktSym">ragg</span></a> package. It has a variety of bugfixes&#160;and new features. Some of these features have required new notation that&rsquo;s not necessarily compatible with all existing <span class="RktSym">ragg</span> files.</p><p>Originally <span class="RktSym">brag</span> was built to support the <a href="https://docs.racket-lang.org/br">Beautiful Racket</a> project. But it has no dependencies on any Beautiful Racket libraries (and will remain thus). So it can be used independently.</p></blockquote></blockquote></blockquote><h3 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;Quick_start&quot;">1<tt>&nbsp;</tt><a name="(part._.Quick_start)"></a>Quick start</h3><p><div class="SIntrapara">Suppose we&rsquo;re given the
following string:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktVal">"(radiant (humble))"</span></p></blockquote></div></p><p>How would we turn this string into a structured value?  That is, how would we <span style="font-style: italic">parse</span> it? (Let&rsquo;s also suppose we&rsquo;ve never heard of <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Reading.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._read%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">read</a></span>.)</p><p>First, we need to consider the structure of the things we&rsquo;d like to parse. The
string above looks like a nested list of words. Good start.</p><p>Second, how might we describe this formally &#8212;&#160;meaning, in a way that a computer could understand? A common notation to describe the structure of these things is <a href="https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form">Backus-Naur Form</a> (BNF). So let&rsquo;s try to notate the structure of nested word lists in BNF.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">nested-word-list: WORD</span></p></td></tr><tr><td><p><span class="stt">| LEFT-PAREN nested-word-list* RIGHT-PAREN</span></p></td></tr></table></blockquote><p>What we intend by this notation is this: <span class="RktSym">nested-word-list</span> is either a <span class="RktSym">WORD</span>, or a parenthesized list of <span class="RktSym">nested-word-list</span>s. We use the character <span class="RktInBG"><span class="hspace"></span><span class="RktIn">*</span><span class="hspace"></span></span> to represent zero or more repetitions of the previous thing. We treat the uppercased <span class="RktSym">LEFT-PAREN</span>, <span class="RktSym">RIGHT-PAREN</span>, and <span class="RktSym">WORD</span> as placeholders for <span style="font-style: italic">tokens</span> (a <a href="#%28tech._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">token</span></a> being the smallest meaningful item in the parsed string):</p><p><div class="SIntrapara">Here are a few examples of tokens:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">brag/support</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">LEFT-PAREN</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(token-struct 'LEFT-PAREN #f #f #f #f #f #f)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">WORD</span><span class="hspace">&nbsp;</span><span class="RktVal">"crunchy"</span><span class="hspace">&nbsp;</span><span class="RktPn">#:span</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(token-struct 'WORD "crunchy" #f #f #f 7 #f)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">RIGHT-PAREN</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">(token-struct 'RIGHT-PAREN #f #f #f #f #f #f)</span></p></td></tr></table></blockquote></div></p><p>This BNF description is also known as a <a name="(tech._grammar)"></a><span style="font-style: italic">grammar</span>. Just as it does in a natural language like English or French, a grammar describes something in terms of what elements can fit where.</p><p>Have we made progress?  We have a valid grammar. But we&rsquo;re still missing a <span style="font-style: italic">parser</span>: a function that can use that description to make structures out of a sequence of tokens.</p><p>Meanwhile, it&rsquo;s clear that we don&rsquo;t yet have a valid program because there&rsquo;s no <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang</span><span class="hspace"></span></span> line. Let&rsquo;s add one: put <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang brag</span><span class="hspace"></span></span> at the top of the grammar, and save it as a file called <span class="stt">"nested-word-list.rkt"</span>.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"nested-word-list.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">nested-word-list: WORD</span></p></td></tr><tr><td><p><span class="stt">| LEFT-PAREN nested-word-list* RIGHT-PAREN</span></p></td></tr></table></blockquote></blockquote><p>Now it&rsquo;s a proper program. But what does it do?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"nested-word-list.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span></td></tr><tr><td><p><span class="RktRes">#&lt;procedure:parse&gt;</span></p></td></tr></table></blockquote><p>It gives us a <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> function. Let&rsquo;s investigate what <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span>
does. What happens if we pass it a sequence of tokens?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-parsed-value</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">LEFT-PAREN</span><span class="hspace">&nbsp;</span><span class="RktVal">"("</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">WORD</span><span class="hspace">&nbsp;</span><span class="RktVal">"some"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">LEFT-PAREN</span><span class="hspace">&nbsp;</span><span class="RktVal">"["</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">WORD</span><span class="hspace">&nbsp;</span><span class="RktVal">"pig"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">RIGHT-PAREN</span><span class="hspace">&nbsp;</span><span class="RktVal">"]"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">RIGHT-PAREN</span><span class="hspace">&nbsp;</span><span class="RktVal">")"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">a-parsed-value</span></td></tr><tr><td><p><span class="RktRes">#&lt;syntax:unknown::-1 (nested-word-list "(" (nested-word-list "some") (nested-word-list "[" (nested-word-list "pig") "]") ")")&gt;</span></p></td></tr></table></blockquote><p>Those who have messed around with macros will recognize this as a <a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=guide&amp;rel=stx-obj.html&amp;version=7.4" class="Sq" data-pltdoc="x">syntax object</a>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-parsed-value</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'(nested-word-list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">"("</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(nested-word-list "some")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(nested-word-list "[" (nested-word-list "pig") "]")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">")")</span></p></td></tr></table></td></tr></table></blockquote><p>That&rsquo;s <span class="RktPn">(</span><span class="RktSym">some</span><span class="stt"> </span><span class="RktPn">[</span><span class="RktSym">pig</span><span class="RktPn">]</span><span class="RktPn">)</span>, essentially.</p><p>What happens if we pass our <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> function a bigger source of tokens?</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">tokenize: string -&gt; (sequenceof token-struct?)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Generate tokens from a string:</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">tokenize</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%252Flist%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for/list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">str</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=regexp.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._regexp-match%252A%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">regexp-match*</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#px"\\(|\\)|\\w+"</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._match%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">match</a></span><span class="hspace">&nbsp;</span><span class="RktSym">str</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">"("</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">LEFT-PAREN</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">")"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">RIGHT-PAREN</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">WORD</span><span class="hspace">&nbsp;</span><span class="RktSym">str</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">For example:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">token-source</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">tokenize</span><span class="hspace">&nbsp;</span><span class="RktVal">"(welcome (to (((brag)) ())))"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">token-source</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'(nested-word-list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">"("</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(nested-word-list "welcome")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(nested-word-list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">"("</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(nested-word-list "to")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(nested-word-list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">"("</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(nested-word-list</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">"("</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(nested-word-list "(" (nested-word-list "brag") ")")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">")")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(nested-word-list "(" ")")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">")")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;</span><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">")")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">")")</span></p></td></tr></table></td></tr></table></blockquote><p>Welcome to <span class="stt">brag</span>.</p><h3 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;Introduction&quot;">2<tt>&nbsp;</tt><a name="(part._.Introduction)"></a>Introduction</h3><p><span class="stt">brag</span> is a parser generator designed to be easy
to use:</p><ul><li><p>It provides a <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang</span><span class="hspace"></span></span> for writing BNF grammars.
A module written in <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang brag</span><span class="hspace"></span></span> automatically generates a
parser. The grammar controls the structure of the syntax objects it generates.</p></li><li><p>The language uses a few conventions to simplify the expression of
grammars. The first rule in the grammar is assumed to be the
starting production. Identifiers in <span class="stt">UPPERCASE</span> are treated as
terminal tokens. All other identifiers are treated as nonterminals.</p></li><li><p>Tokenizers can be developed independently of parsers.
<span class="stt">brag</span> takes a liberal view on tokens: they can be strings,
symbols, or instances constructed with <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span>. Tokens can optionally provide source location, in which case a syntax object generated by the parser will too.</p></li><li><p>The parser can usually handle ambiguous grammars.</p></li><li><p>It integrates with the rest of the Racket
<a href="https://docs.racket-lang.org/guide/languages.html">language toolchain</a>.</p></li></ul><h4 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;Example__a_small_DSL_for_ASCII_diagrams&quot;">2.1<tt>&nbsp;</tt><a name="(part._.Example__a_small_.D.S.L_for_.A.S.C.I.I_diagrams)"></a>Example: a small DSL for ASCII diagrams</h4><p>Suppose we&rsquo;d like to define a language for
drawing simple ASCII diagrams. So if we write something like this:</p><blockquote><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">3 9 X;</span></p></td></tr><tr><td><p><span class="stt">6 3 b 3 X 3 b;</span></p></td></tr><tr><td><p><span class="stt">3 9 X;</span></p></td></tr></table></blockquote><p>It should generate the following picture:</p><blockquote><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="stt">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="stt">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">XXX</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">XXX</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">XXX</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">XXX</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">XXX</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">XXX</span></p></td></tr><tr><td><p><span class="stt">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="stt">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="stt">XXXXXXXXX</span></p></td></tr></table></blockquote><p>This makes sense in a casual way. But let&rsquo;s be more precise about how the language works.</p><p>Each line of the program has a semicolon at the end, and describes the output of several <span style="font-style: italic">rows</span> of the line drawing. Let&rsquo;s look at two of the lines in the example:</p><ul><li><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">3 9 X;</span><span class="hspace"></span></span>: &ldquo;Repeat the following 3 times: print <span class="RktVal">"X"</span> nine times, followed by
a newline.&rdquo;</p></li><li><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">6 3 b 3 X 3 b;</span><span class="hspace"></span></span>: &ldquo;Repeat the following 6 times: print <span class="RktVal">" "</span> three times,
followed by <span class="RktVal">"X"</span> three times, followed by <span class="RktVal">" "</span> three times, followed by a newline.&rdquo;</p></li></ul><p>Then each line consists of a <span style="font-style: italic">repeat</span> number, followed by pairs of
(number, character) <span style="font-style: italic">chunks</span>. We&rsquo;ll assume here that the intent of the lowercased character <span class="RktInBG"><span class="hspace"></span><span class="RktIn">b</span><span class="hspace"></span></span> is to represent the printing of a 1-character whitespace <span class="RktVal">" "</span>, and for other uppercase letters to represent the printing of themselves.</p><p>By understanding the pieces of each line, we can more easily capture that meaning in a grammar. Once we have each instruction of our ASCII DSL in a structured format, we should be able to parse it.</p><p>Here&rsquo;s a first pass at expressing the structure of these line-drawing programs.</p><h4 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;Parsing_the_concrete_syntax&quot;">2.2<tt>&nbsp;</tt><a name="(part._.Parsing_the_concrete_syntax)"></a>Parsing the concrete syntax</h4><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"simple-line-drawing.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">drawing: rows*</span></p></td></tr><tr><td><p><span class="stt">rows: repeat chunk+ ";"</span></p></td></tr><tr><td><p><span class="stt">repeat: INTEGER</span></p></td></tr><tr><td><p><span class="stt">chunk: INTEGER STRING</span></p></td></tr></table></blockquote></blockquote><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p><a href="#%28part._brag-syntax%29" data-pltdoc="x">Syntax and terminology</a> describes <span class="stt">brag</span>&rsquo;s syntax in more detail.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">We write a <span class="stt">brag</span> program as an BNF grammar, where patterns can be:
</div><div class="SIntrapara"><ul><li><p>the names of other rules (e.g. <span class="RktSym">chunk</span>)</p></li><li><p>literal and symbolic token names (e.g. <span class="RktVal">";"</span>, <span class="RktSym">INTEGER</span>)</p></li><li><p>quantified patterns (e.g. <span class="RktInBG"><span class="hspace"></span><span class="RktIn">+</span><span class="hspace"></span></span> to represent one or more repetitions)</p></li></ul></div><div class="SIntrapara">The result of a <span class="stt">brag</span> program is a module with a <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> function
that can parse tokens and produce a syntax object as a result.</div></p><p>Let&rsquo;s try this function:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">brag/support</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"simple-line-drawing.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">INTEGER</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">INTEGER</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">STRING</span><span class="hspace">&nbsp;</span><span class="RktVal">" "</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">INTEGER</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">STRING</span><span class="hspace">&nbsp;</span><span class="RktVal">"X"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">";"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(drawing (rows (repeat 6) (chunk 2 " ") (chunk 3 "X") ";"))</span></p></td></tr></table></blockquote><p>A <span style="font-style: italic">token</span> is the smallest meaningful element of a source program. Tokens can be  strings, symbols, or instances of the <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span> data structure. (Plus a few other special cases, which we&rsquo;ll discuss later.) Usually, a token holds a single character from the source program. But sometimes it makes sense to package a sequence of characters into a single token, if the sequence has an indivisible meaning.</p><p>If possible, we also want to attach source location information to each token. Why? Because this information will be incorporated into the syntax objects produced by <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span>.</p><p>A parser often works in conjunction with a helper function called a <span style="font-style: italic">lexer</span> that converts the raw code of the source program into tokens. The <a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">br-parser-tools/lex</span></a> library can help us write a position-sensitive
tokenizer:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">br-parser-tools/lex</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">tokenize</span><span class="hspace">&nbsp;</span><span class="RktSym">ip</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=linecol.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._port-count-lines%2521%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">port-count-lines!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">ip</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">my-lexer</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._lexer-src-pos%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">lexer-src-pos</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">repetition</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">+inf.0</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._numeric%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">numeric</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">INTEGER</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=generic-numbers.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string-%7E3enumber%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string-&gt;number</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._lexeme%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">lexeme</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._upper-case%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">upper-case</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">STRING</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._lexeme%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">lexeme</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">"b"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">STRING</span><span class="hspace">&nbsp;</span><span class="RktVal">" "</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktVal">";"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">";"</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._lexeme%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">lexeme</a></span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._whitespace%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">whitespace</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">WHITESPACE</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528form._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._lexeme%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">lexeme</a></span><span class="hspace">&nbsp;</span><span class="RktPn">#:skip?</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._eof%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">eof</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">void</a></span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">next-token</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">my-lexer</span><span class="hspace">&nbsp;</span><span class="RktSym">ip</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">next-token</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a-sample-input-port</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stringport.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._open-input-string%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">open-input-string</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"6 2 b 3 X;"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">token-thunk</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">tokenize</span><span class="hspace">&nbsp;</span><span class="RktSym">a-sample-input-port</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Now we can pass token-thunk to the parser:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">another-stx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">token-thunk</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktSym">another-stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(drawing (rows (repeat 6) (chunk 2 " ") (chunk 3 "X") ";"))</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">The syntax object has location information:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-line%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-line</a></span><span class="hspace">&nbsp;</span><span class="RktSym">another-stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">1</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-column%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-column</a></span><span class="hspace">&nbsp;</span><span class="RktSym">another-stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">0</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-span%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-span</a></span><span class="hspace">&nbsp;</span><span class="RktSym">another-stx</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">10</span></p></td></tr></table></blockquote><p>Note also from this lexer example:</p><ul><li><p><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> accepts as input either a sequence of tokens, or a
function that produces tokens (which <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> will call repeatedly to get the next token).</p></li><li><p>As an alternative to the basic <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span> structure, a token can also be an instance of the <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._position-token%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">position-token</a></span> structure (also found in <a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">br-parser-tools/lex</span></a>). In that case, the token will try to derive its position from that of the position-token.</p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> will stop if it gets <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">void</a></span> (or <span class="RktVal">'</span><span class="RktVal">eof</span>) as a token.</p></li><li><p><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> will skip any token that has
<span class="RktPn">#:skip?</span> attribute set to <span class="RktVal">#t</span>. For instance, tokens representing comments often use <span class="RktPn">#:skip?</span>.</p></li></ul><h4 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;From_parsing_to_interpretation&quot;">2.3<tt>&nbsp;</tt><a name="(part._.From_parsing_to_interpretation)"></a>From parsing to interpretation</h4><p>We now have a parser for programs written in this simple-line-drawing language.
Our parser will return syntax objects:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">parsed-program</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">tokenize</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stringport.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._open-input-string%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">open-input-string</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"3 9 X; 6 3 b 3 X 3 b; 3 9 X;"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktSym">parsed-program</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktRes">'(drawing</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(rows (repeat 3) (chunk 9 "X") ";")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(rows (repeat 6) (chunk 3 " ") (chunk 3 "X") (chunk 3 " ") ";")</span></p></td></tr><tr><td><p><span class="RktRes"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktRes">(rows (repeat 3) (chunk 9 "X") ";"))</span></p></td></tr></table></td></tr></table></blockquote><p>Better still, these syntax objects will have a predictable
structure that follows the grammar:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">drawing</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rows</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">repeat</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;number&gt;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">chunk</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;number&gt;</span><span class="hspace">&nbsp;</span><span class="RktSym">&lt;string&gt;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktVal">";"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr></table></blockquote><p>where <span class="RktSym">drawing</span>, <span class="RktSym">rows</span>, <span class="RktSym">repeat</span>, and <span class="RktSym">chunk</span>
should be treated literally, and everything else will be numbers or strings.</p><p>Still, these syntax-object values are just inert structures. How do we
interpret them, and make them <span style="font-style: italic">print</span>?  We claimed at the beginning of
this section that these syntax objects should be easy to interpret. So let&rsquo;s do it.</p><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>This is a very quick-and-dirty treatment of <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span>.
See the <a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse.html&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syntax/parse</span></a> documentation for a gentler guide to its
features.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">  Racket provides a special form called <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span> in the
<a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse.html&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syntax/parse</span></a> library. <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span> lets us do a
structural case-analysis on syntax objects: we provide it a set of patterns to
parse and actions to perform when those patterns match.</div></p><p>As a simple example, we can write a function that looks at a syntax object and
says <span class="RktVal">#t</span> if it&rsquo;s the literal <span class="RktSym">yes</span>, and <span class="RktVal">#f</span> otherwise:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">syntax/parse</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">yes-syntax-object?: syntax-object -&gt; boolean</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Returns true if the syntax-object is yes.</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">yes-syntax-object?</span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="hspace">&nbsp;</span><span class="RktSym">yes</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=if.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fletstx-scheme..rkt%2529._else%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">else</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">yes-syntax-object?</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">yes</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">yes-syntax-object?</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">nooooooooooo</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote><p><div class="SIntrapara">Here, we use <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span> to let <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span> know that
<span class="RktSym">yes</span> should show up literally in the syntax object. The patterns can
also have some structure to them, such as:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drawing</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktSym">rows-stxs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></p></blockquote></div><div class="SIntrapara">which matches on syntax objects that begin, literally, with <span class="RktSym">drawing</span>,
followed by any number of rows (which are syntax objects too).</div></p><p><div class="SIntrapara">Now that we know a little bit more about <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span>,
we can use it to do a case analysis on the syntax
objects that our <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> function gives us.
We start by defining a function on syntax objects of the form <span class="RktPn">(</span><span class="RktSym">drawing</span><span class="stt"> </span><span class="RktSym">rows-stx</span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span>.
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interpret-drawing</span><span class="hspace">&nbsp;</span><span class="RktSym">drawing-stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drawing-stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drawing</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktSym">rows-stxs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">rows-stx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3elist%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">rows-stxs</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interpret-rows</span><span class="hspace">&nbsp;</span><span class="RktSym">rows-stx</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>When we encounter a syntax object with <span class="RktPn">(</span><span class="RktSym">drawing</span><span class="stt"> </span><span class="RktSym">rows-stx</span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span>, then <span class="RktSym">interpret-rows</span> each <span class="RktSym">rows-stx</span>.</p><p><div class="SIntrapara">Let&rsquo;s define <span class="RktSym">interpret-rows</span> now:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interpret-rows</span><span class="hspace">&nbsp;</span><span class="RktSym">rows-stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rows-stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rows</span><span class="RktPn">}</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="hspace">&nbsp;</span><span class="RktSym">repeat</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktSym">repeat-number</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">chunks</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="hspace">&nbsp;</span><span class="RktVal">";"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-e%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-e</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">repeat-number</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">chunk-stx</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3elist%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;list</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">chunks</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interpret-chunk</span><span class="hspace">&nbsp;</span><span class="RktSym">chunk-stx</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Byte_and_String_Output.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._newline%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">newline</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>For a <span class="RktSym">rows</span>, we extract out the <span class="RktSym">repeat-number</span> out of the
syntax object and use it as the range of the <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span> loop. The inner loop
walks across each <span class="RktSym">chunk-stx</span> and calls <span class="RktSym">interpret-chunk</span> on it.</p><p>Finally, we need to write a definition for <span class="RktSym">interpret-chunk</span>. We want
it to extract out the <span class="RktSym">chunk-size</span> and <span class="RktSym">chunk-string</span> portions,
and print to standard output:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">interpret-chunk</span><span class="hspace">&nbsp;</span><span class="RktSym">chunk-stx</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">chunk-stx</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="hspace">&nbsp;</span><span class="RktSym">chunk</span><span class="RktPn">}</span><span class="hspace">&nbsp;</span><span class="RktSym">chunk-size</span><span class="hspace">&nbsp;</span><span class="RktSym">chunk-string</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">k</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-e%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-e</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">chunk-size</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._display%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">display</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-e%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-e</a></span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktSym">chunk-string</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Here are the definitions in a single file:
<a href="examples/simple-line-drawing/interpret.rkt">interpret.rkt</a>.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">With these definitions in hand, now we can pass it syntax objects
that we construct directly by hand:</div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interpret-chunk</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">chunk</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">"X"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktOut">XXX</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interpret-drawing</span><span class="hspace">&nbsp;</span><span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">drawing</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">rows</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">repeat</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">chunk</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">"X"</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">";"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">XXX</span></p></td></tr><tr><td><p><span class="RktOut">XXX</span></p></td></tr><tr><td><p><span class="RktOut">XXX</span></p></td></tr><tr><td><p><span class="RktOut">XXX</span></p></td></tr><tr><td><p><span class="RktOut">XXX</span></p></td></tr></table></td></tr></table></blockquote><p><div class="SIntrapara">or we can pass it the result generated by our parser:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">parsed-program</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">tokenize</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stringport.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._open-input-string%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">open-input-string</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"3 9 X; 6 3 b 3 X 3 b; 3 9 X;"</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">interpret-drawing</span><span class="hspace">&nbsp;</span><span class="RktSym">parsed-program</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0"><tr><td><p><span class="RktOut">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="RktOut">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="RktOut">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">XXX </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">XXX </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">XXX </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">XXX </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">XXX </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span></p></td></tr><tr><td><p><span class="RktOut"></span><span class="hspace">&nbsp;</span><span class="RktOut"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut">XXX </span><span class="hspace">&nbsp;&nbsp;</span><span class="RktOut"></span></p></td></tr><tr><td><p><span class="RktOut">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="RktOut">XXXXXXXXX</span></p></td></tr><tr><td><p><span class="RktOut">XXXXXXXXX</span></p></td></tr></table></td></tr></table></blockquote></div></p><p>And now we&rsquo;ve got an interpreter!</p><h4 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;From_interpretation_to_compilation&quot;">2.4<tt>&nbsp;</tt><a name="(part._.From_interpretation_to_compilation)"></a>From interpretation to compilation</h4><p><div class="SIntrapara"><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>For a gentler tutorial on writing <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang</span><span class="hspace"></span></span>-based languages, see
<a href="http://beautifulracket.com">Beautiful Racket</a>.</p></blockquote></blockquote></blockquote></div><div class="SIntrapara">  (Just as a
warning: the following material is slightly more advanced, but shows how
writing a compiler for the line-drawing language reuses the ideas for the
interpreter.)</div></p><p>Wouldn&rsquo;t it be nice to be able to write something like:</p><blockquote><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">3 9 X;</span></p></td></tr><tr><td><p><span class="stt">6 3 b 3 X 3 b;</span></p></td></tr><tr><td><p><span class="stt">3 9 X;</span></p></td></tr></table></blockquote><p><div class="SIntrapara">and have Racket automatically compile this down to something like this?
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">k</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"X"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Byte_and_String_Output.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._newline%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">newline</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">k</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktVal">" "</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">k</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"X"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">k</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktVal">" "</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Byte_and_String_Output.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._newline%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">newline</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">k</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fmisc..rkt%2529._displayln%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">displayln</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"X"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Byte_and_String_Output.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._newline%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">newline</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>Well, of course it won&rsquo;t work: we don&rsquo;t have a <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang</span><span class="hspace"></span></span> line.</p><p>Let&rsquo;s add one.</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"letter-i.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag/examples/simple-line-drawing</span></p></td></tr><tr><td><p><span class="stt">3 9 X;</span></p></td></tr><tr><td><p><span class="stt">6 3 b 3 X 3 b;</span></p></td></tr><tr><td><p><span class="stt">3 9 X;</span></p></td></tr></table></blockquote></blockquote><p>Now <span class="stt">"letter-i.rkt"</span> is a program.</p><p>How does this work?  From the previous sections, we&rsquo;ve seen how to take the
contents of a file and interpret it. What we want to do now is teach Racket
how to compile programs labeled with this <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang</span><span class="hspace"></span></span> line. We&rsquo;ll do two
things:</p><ul><li><p>Tell Racket to use the <span class="stt">brag</span>-generated parser and lexer we defined
earlier whenever it sees a program written with
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang brag/examples/simple-line-drawing</span><span class="hspace"></span></span>.</p></li><li><p>Define transformation rules for <span class="RktSym">drawing</span>, <span class="RktSym">rows</span>, and
<span class="RktSym">chunk</span> to rewrite these into standard Racket forms.</p></li></ul><p>The second part, the writing of the transformation rules, will look very
similar to the definitions we wrote for the interpreter, but the transformation
will happen at compile-time. (We <span style="font-style: italic">could</span> just resort to simply calling
into the interpreter we just wrote up, but this section is meant to show that
compilation is also viable.)</p><p>We do the first part by defining a <span style="font-style: italic">module reader</span>: a
<a href="https://docs.racket-lang.org/guide/syntax_module-reader.html">module
reader</a> tells Racket how to parse and compile a file. Whenever Racket sees a
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang &lt;name&gt;</span><span class="hspace"></span></span>, it looks for a corresponding module reader in
<span class="stt">"&lt;name&gt;/lang/reader"</span>.</p><p>Here&rsquo;s the definition for
<span class="stt">"brag/examples/simple-line-drawing/lang/reader.rkt"</span>:</p><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"brag/examples/simple-line-drawing/lang/reader.rkt"</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=reader.html%23%2528mod-path._s-exp%2529&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">s-exp</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">syntax/module-reader</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">brag/examples/simple-line-drawing/semantics</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">#:read</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-read</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">#:read-syntax</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">my-read-syntax</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">#:whole-body-readers?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#t</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">brag/examples/simple-line-drawing/lexer</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">brag/examples/simple-line-drawing/grammar</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">my-read</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">in</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">my-read-syntax</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#f</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">in</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">my-read-syntax</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">src</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ip</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">src</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">tokenize</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">ip</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote></blockquote></blockquote><p>We use a helper module <a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=reader-helpers.html%23%2528mod-path._syntax%252Fmodule-reader%2529&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">syntax/module-reader</span></a>, which provides
utilities for creating a module reader. It uses the lexer and
<span class="stt">brag</span>-generated parser we defined earlier, and also tells Racket that it should compile the forms in the syntax
object using a module called <span class="stt">"semantics.rkt"</span>.</p><p><div class="SIntrapara">Let&rsquo;s look into <span class="stt">"semantics.rkt"</span> and see what&rsquo;s involved in
compilation:
</div><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"brag/examples/simple-line-drawing/semantics.rkt"</span></span></p><blockquote class="Rfilecontent"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=index.html&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">racket/base</span></a><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for-syntax%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for-syntax</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">racket/base</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">syntax/parse</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._provide%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">provide</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=module.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._%7E23%7E25module-begin%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">#%module-begin</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">We</span><span class="hspace">&nbsp;</span><span class="RktCmt">reuse</span><span class="hspace">&nbsp;</span><span class="RktCmt">Racket's</span><span class="hspace">&nbsp;</span><span class="RktCmt">treatment</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">raw</span><span class="hspace">&nbsp;</span><span class="RktCmt">datums,</span><span class="hspace">&nbsp;</span><span class="RktCmt">specifically</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">for</span><span class="hspace">&nbsp;</span><span class="RktCmt">strings</span><span class="hspace">&nbsp;</span><span class="RktCmt">and</span><span class="hspace">&nbsp;</span><span class="RktCmt">numbers:</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=quote.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._%7E23%7E25datum%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">#%datum</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">And</span><span class="hspace">&nbsp;</span><span class="RktCmt">otherwise,</span><span class="hspace">&nbsp;</span><span class="RktCmt">we</span><span class="hspace">&nbsp;</span><span class="RktCmt">provide</span><span class="hspace">&nbsp;</span><span class="RktCmt">definitions</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">these</span><span class="hspace">&nbsp;</span><span class="RktCmt">three</span><span class="hspace">&nbsp;</span><span class="RktCmt">forms.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">During</span><span class="hspace">&nbsp;</span><span class="RktCmt">compiliation,</span><span class="hspace">&nbsp;</span><span class="RktCmt">Racket</span><span class="hspace">&nbsp;</span><span class="RktCmt">uses</span><span class="hspace">&nbsp;</span><span class="RktCmt">these</span><span class="hspace">&nbsp;</span><span class="RktCmt">definitions</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">rewrite</span><span class="hspace">&nbsp;</span><span class="RktCmt">into</span><span class="hspace">&nbsp;</span><span class="RktCmt">for</span><span class="hspace">&nbsp;</span><span class="RktCmt">loops,</span><span class="hspace">&nbsp;</span><span class="RktCmt">displays,</span><span class="hspace">&nbsp;</span><span class="RktCmt">and</span><span class="hspace">&nbsp;</span><span class="RktCmt">newlines.</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">drawing</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">rows</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Define</span><span class="hspace">&nbsp;</span><span class="RktCmt">a</span><span class="hspace">&nbsp;</span><span class="RktCmt">few</span><span class="hspace">&nbsp;</span><span class="RktCmt">compile-time</span><span class="hspace">&nbsp;</span><span class="RktCmt">functions</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">do</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">syntax</span><span class="hspace">&nbsp;</span><span class="RktCmt">rewriting:</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=begin.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._begin-for-syntax%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">begin-for-syntax</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-drawing</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">drawing-stx</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">drawing-stx</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">drawing</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">rows-stxs</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax%252Floc%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax/loc</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">drawing-stx</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=begin.html%23%2528form._%2528%2528quote._%7E23%7E25kernel%2529._begin%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">begin</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">rows-stxs</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-rows</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">rows-stx</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">rows-stx</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">rows</span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">repeat</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">repeat-number</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">chunks</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktVal">";"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax%252Floc%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax/loc</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">rows-stx</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">i</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">repeat-number</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktSym">chunks</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Byte_and_String_Output.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._newline%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">newline</a></span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">compile-chunk</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk-stx</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=Parsing_Syntax.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._syntax-parse%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax-parse</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk-stx</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">{</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=syntax&amp;rel=stxparse-patterns.html%23%2528form._%2528%2528lib._syntax%252Fparse..rkt%2529._%7E7eliteral%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">~literal</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk</span><span class="RktPn">}</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk-size</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk-string</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._syntax%252Floc%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">syntax/loc</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk-stx</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=for.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._for%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">for</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">k</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk-size</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=Writing.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._display%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">display</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk-string</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">Wire</span><span class="hspace">&nbsp;</span><span class="RktCmt">up</span><span class="hspace">&nbsp;</span><span class="RktCmt">the</span><span class="hspace">&nbsp;</span><span class="RktCmt">use</span><span class="hspace">&nbsp;</span><span class="RktCmt">of</span><span class="hspace">&nbsp;</span><span class="RktCmt">"drawing",</span><span class="hspace">&nbsp;</span><span class="RktCmt">"rows",</span><span class="hspace">&nbsp;</span><span class="RktCmt">and</span><span class="hspace">&nbsp;</span><span class="RktCmt">"chunk"</span><span class="hspace">&nbsp;</span><span class="RktCmt">to</span><span class="hspace">&nbsp;</span><span class="RktCmt">these</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">transformers:</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">drawing</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">compile-drawing</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">rows</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">compile-rows</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">chunk</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">compile-chunk</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote></blockquote></blockquote></div></p><p>The semantics hold definitions for <span class="RktSym">compile-drawing</span>,
<span class="RktSym">compile-rows</span>, and <span class="RktSym">compile-chunk</span>, similar to what we had for
interpretation with <span class="RktSym">interpret-drawing</span>, <span class="RktSym">interpret-rows</span>, and
<span class="RktSym">interpret-chunk</span>. However, compilation is not the same as
interpretation: each definition does not immediately execute the act of
drawing, but rather returns a syntax object whose evaluation will do the actual
work.</p><p>There are a few things to note:</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>By the way, we can just as easily rewrite the semantics so that
<span class="RktSym">compile-rows</span> does explicitly call <span class="RktSym">compile-chunk</span>. Often,
though, it&rsquo;s easier to write the transformation functions in this piecemeal way
and depend on the Racket macro expansion system to do the rewriting as it
encounters each of the forms.</p></blockquote></blockquote></blockquote><ul><li><p><span class="stt">brag</span>&rsquo;s native data structure is the syntax object because the
majority of Racket&rsquo;s language-processing infrastructure knows how to read and
write this structured value.</p></li><li><p>Unlike in interpretation, <span class="RktSym">compile-rows</span> doesn&rsquo;t
compile each chunk by directly calling <span class="RktSym">compile-chunk</span>. Rather, it
depends on the Racket macro expander to call each <span class="RktSym">compile-XXX</span> function
as it encounters a <span class="RktSym">drawing</span>, <span class="RktSym">rows</span>, or <span class="RktSym">chunk</span> in the
parsed value. The three statements at the bottom of <span class="stt">"semantics.rkt"</span> inform
the macro expansion system to do this:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktSym">drawing</span><span class="hspace">&nbsp;</span><span class="RktSym">compile-drawing</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktSym">rows</span><span class="hspace">&nbsp;</span><span class="RktSym">compile-rows</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define-syntax%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define-syntax</a></span><span class="hspace">&nbsp;</span><span class="RktSym">chunk</span><span class="hspace">&nbsp;</span><span class="RktSym">compile-chunk</span><span class="RktPn">)</span></td></tr></table></blockquote></li></ul><p>Altogether, <span class="stt">brag</span>&rsquo;s intent is to be a parser generator for Racket
that&rsquo;s easy and fun to use. It&rsquo;s meant to fit naturally with the other tools
in the Racket language toolchain. Hopefully, it will reduce the friction in
making new languages with alternative concrete syntaxes.</p><p>The rest of this document describes the <span class="stt">brag</span> language and the parsers it
generates.</p><h3 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;The_language&quot;">3<tt>&nbsp;</tt><a name="(part._.The_language)"></a>The language</h3><h4 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;brag-syntax&quot;">3.1<tt>&nbsp;</tt><a name="(part._brag-syntax)"></a>Syntax and terminology</h4><p>A program in the <span class="stt">brag</span> language consists of the language line
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang brag</span><span class="hspace"></span></span>, followed by a collection of <a href="#%28tech._rule%29" class="techoutside" data-pltdoc="x"><span class="techinside">rule</span></a>s and
possibly <a href="#%28tech._line._comment%29" class="techoutside" data-pltdoc="x"><span class="techinside">line comment</span></a>s or <a href="#%28tech._multiline._comment%29" class="techoutside" data-pltdoc="x"><span class="techinside">multiline comment</span></a>s.</p><p>A <a name="(tech._rule)"></a><span style="font-style: italic">rule</span> is a sequence consisting of: a <a href="#%28tech._rule._identifier%29" class="techoutside" data-pltdoc="x"><span class="techinside">rule identifier</span></a>, a separator (either <span class="RktInBG"><span class="hspace"></span><span class="RktIn">":"</span><span class="hspace"></span></span> or <span class="RktInBG"><span class="hspace"></span><span class="RktIn">"::="</span><span class="hspace"></span></span>), and a <a href="#%28tech._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">pattern</span></a>.</p><p>A <a name="(tech._rule._identifier)"></a><span style="font-style: italic">rule identifier</span> is an <a href="#%28tech._identifier%29" class="techoutside" data-pltdoc="x"><span class="techinside">identifier</span></a> that is not in upper case.</p><p>A <a name="(tech._symbolic._token._identifier)"></a><span style="font-style: italic">symbolic token identifier</span> is an <a href="#%28tech._identifier%29" class="techoutside" data-pltdoc="x"><span class="techinside">identifier</span></a> that is in upper case.</p><p>A <a name="(tech._line._comment)"></a><span style="font-style: italic">line comment</span> begins with either <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#</span><span class="hspace"></span></span> or <span class="RktInBG"><span class="hspace"></span><span class="RktIn">;</span><span class="hspace"></span></span> and
continues till the end of the line.</p><p>A <a name="(tech._multiline._comment)"></a><span style="font-style: italic">multiline comment</span> begins with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">(*</span><span class="hspace"></span></span> and ends with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">*)</span><span class="hspace"></span></span>.</p><p>An <a name="(tech._identifier)"></a><span style="font-style: italic">identifier</span> is a sequence of letters, numbers, or
characters in the set <span class="RktVal">"-.!$%&amp;/&lt;=&gt;?^_~@"</span>. It must not contain
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">*</span><span class="hspace"></span></span>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">+</span><span class="hspace"></span></span>, or <span class="RktInBG"><span class="hspace"></span><span class="RktIn">{</span><span class="hspace"></span></span> and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">}</span><span class="hspace"></span></span>, as those characters are used to denote quantification.</p><p><div class="SIntrapara">A <a name="(tech._pattern)"></a><span style="font-style: italic">pattern</span> is one of the following:
</div><div class="SIntrapara"><ul><li><p>an implicit sequence of <a href="#%28tech._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">pattern</span></a>s separated by whitespace or commas.</p></li><li><p>a <a name="(tech._terminal)"></a><span style="font-style: italic">terminal</span>: either a literal string or a <a href="#%28tech._symbolic._token._identifier%29" class="techoutside" data-pltdoc="x"><span class="techinside">symbolic token identifier</span></a>.</p><p>When used in a pattern, both kinds of terminals will match the same set of inputs.</p><p>A literal string can match the string itself, or a <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span> structure whose type field contains that string (or its symbol form). So <span class="RktVal">"FOO"</span> in a rule pattern would match the tokens <span class="RktVal">"FOO"</span>, <span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="stt"> </span><span class="RktVal">"FOO"</span><span class="stt"> </span><span class="RktVal">"bar"</span><span class="RktPn">)</span>, or <span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">FOO</span><span class="stt"> </span><span class="RktVal">"bar"</span><span class="RktPn">)</span>.</p><p>A symbolic token identifier can also match the string version of the identifier, or a <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span> whose type field is the symbol or string form of the identifier. So <span class="RktSym">FOO</span> in a rule pattern would <span style="font-style: italic">also</span> match the tokens <span class="RktVal">"FOO"</span>, <span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">FOO</span><span class="stt"> </span><span class="RktVal">"bar"</span><span class="RktPn">)</span>, or <span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="stt"> </span><span class="RktVal">"FOO"</span><span class="stt"> </span><span class="RktVal">"bar"</span><span class="RktPn">)</span>. (In every case, the value of a token, like <span class="RktVal">"bar"</span>, can be anything, and may or may not be the same as the symbolic token identifier.)</p><p>Because their underlying meanings are the same, the symbolic token identifier ends up being a notational convenience for readability inside a rule pattern. Typically, the literal string <span class="RktVal">"FOO"</span> is used to connote &ldquo;match the string <span class="RktVal">"FOO"</span> exactly&rdquo; and the symbolic token identifier <span class="RktSym">FOO</span> specially connotes &ldquo;match a token of type <span class="RktVal">'</span><span class="RktVal">FOO</span>&rdquo;.</p><p>You <span style="font-weight: bold">cannot</span> use the literal string <span class="RktVal">"error"</span> as a terminal in a grammar, because it&rsquo;s reserved for <span class="stt">brag</span>. You can, however, adjust your lexer to package it inside a token structure &#8212;&#160;say, <span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">ERROR</span><span class="stt"> </span><span class="RktVal">"error"</span><span class="RktPn">)</span> &#8212; and then use the symbolic token identifier <span class="RktSym">ERROR</span> in the grammar to match this token structure.</p></li><li><p>a <a href="#%28tech._rule._identifier%29" class="techoutside" data-pltdoc="x"><span class="techinside">rule identifier</span></a>.</p></li><li><p>a <a name="(tech._choice._pattern)"></a><span style="font-style: italic">choice pattern</span>: a sequence of <a href="#%28tech._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">pattern</span></a>s delimited with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">|</span><span class="hspace"></span></span> characters.</p></li><li><p>a <a name="(tech._quantified._pattern)"></a><span style="font-style: italic">quantified pattern</span>: a <a href="#%28tech._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">pattern</span></a> followed by either <span class="RktInBG"><span class="hspace"></span><span class="RktIn">*</span><span class="hspace"></span></span> (&ldquo;zero or more&rdquo;), <span class="RktInBG"><span class="hspace"></span><span class="RktIn">?</span><span class="hspace"></span></span> (&ldquo;zero or one&rdquo;), or <span class="RktInBG"><span class="hspace"></span><span class="RktIn">+</span><span class="hspace"></span></span> (&ldquo;one or more&rdquo;). Quantification can also be denoted by integers within curly brackets. So <span class="RktInBG"><span class="hspace"></span><span class="RktIn">{2}</span><span class="hspace"></span></span> means &ldquo;exactly 2&rdquo;; <span class="RktInBG"><span class="hspace"></span><span class="RktIn">{2,5}</span><span class="hspace"></span></span> means &ldquo;between 2 and 5, inclusive&rdquo;; <span class="RktInBG"><span class="hspace"></span><span class="RktIn">{2,}</span><span class="hspace"></span></span> means &ldquo;2 or more&rdquo;; and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">{,5}</span><span class="hspace"></span></span> means &ldquo;up to 5&rdquo;.</p></li><li><p>an <a name="(tech._optional._pattern)"></a><span style="font-style: italic">optional pattern</span>: a <a href="#%28tech._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">pattern</span></a> surrounded by <span class="RktInBG"><span class="hspace"></span><span class="RktIn">[</span><span class="hspace"></span></span> and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">]</span><span class="hspace"></span></span>. (The <span class="RktInBG"><span class="hspace"></span><span class="RktIn">?</span><span class="hspace"></span></span> zero-or-one quantifier means the same thing.)</p></li><li><p>an explicit <a name="(tech._sequence)"></a><span style="font-style: italic">sequence</span>: a <a href="#%28tech._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">pattern</span></a> surrounded by <span class="RktInBG"><span class="hspace"></span><span class="RktIn">(</span><span class="hspace"></span></span> and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">)</span><span class="hspace"></span></span>.</p></li><li><p>the <a name="(tech._empty._set)"></a><span style="font-style: italic">empty set</span>: a special <a href="#%28tech._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">pattern</span></a> that matches a list of zero tokens. When it appears on the right side of a rule, the empty set will match empty input (which obviously contains zero tokens), but also the &ldquo;gap&rdquo; between two existing tokens (which less obviously also contains zero tokens). The empty set can be denoted by <span class="RktInBG"><span class="hspace"></span><span class="RktIn">()</span><span class="hspace"></span></span> (empty parentheses), <span class="RktInBG"><span class="hspace"></span><span class="RktIn">&#8709;</span><span class="hspace"></span></span> (the Unicode empty-set character), or <span class="RktInBG"><span class="hspace"></span><span class="RktIn">&#216;</span><span class="hspace"></span></span> (the slashed O).</p></li></ul></div></p><p><div class="SIntrapara">For example, in the following program:
</div><div class="SIntrapara"><blockquote><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">;; A parser for a silly language</span></p></td></tr><tr><td><p><span class="stt">sentence: verb optional-adjective object</span></p></td></tr><tr><td><p><span class="stt">verb: greeting</span></p></td></tr><tr><td><p><span class="stt">optional-adjective: ["happy" | "frumpy"]</span></p></td></tr><tr><td><p><span class="stt">greeting: "hello" | "hola" | "aloha"</span></p></td></tr><tr><td><p><span class="stt">object: "world" | WORLD</span></p></td></tr></table></blockquote></div></p><p>the elements <span class="stt">sentence</span>, <span class="stt">verb</span>, <span class="stt">greeting</span>, and <span class="stt">object</span> are rule
identifiers. The first rule, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">sentence: verb optional-adjective object</span><span class="hspace"></span></span>, is a rule whose right side is an implicit pattern sequence of three
sub-patterns. The uppercased <span class="stt">WORLD</span> is a symbolic token identifier. The fourth rule in the program associates <span class="stt">greeting</span> with a <a href="#%28tech._choice._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">choice pattern</span></a>.</p><p><div class="SIntrapara">More examples:
</div><div class="SIntrapara"><ul><li><p><div class="SIntrapara">A
BNF for binary
strings that contain an equal number of zeros and ones.
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">equal: [zero one | one zero]</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="stt">;; equal number of "0"s and "1"s.</span></p></td></tr><tr><td><p><span class="stt">zero: "0" equal | equal "0"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">;; has an extra "0" in it.</span></p></td></tr><tr><td><p><span class="stt">one: "1" equal | equal "1"</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">;; has an extra "1" in it.</span></p></td></tr></table></div></p></li><li><p><div class="SIntrapara">A BNF for
<a href="https://www.json.org/">JSON</a>-like structures.
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">json: number | string</span></p></td></tr><tr><td><p><span class="stt">| array</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">| object</span></p></td></tr><tr><td><p><span class="stt">number: NUMBER</span></p></td></tr><tr><td><p><span class="stt">string: STRING</span></p></td></tr><tr><td><p><span class="stt">array: "[" [json ("," json)*] "]"</span></p></td></tr><tr><td><p><span class="stt">object: "{" [kvpair ("," kvpair)*] "}"</span></p></td></tr><tr><td><p><span class="stt">kvpair: ID ":" json</span></p></td></tr></table></div></p></li></ul></div></p><h4 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;cuts-and-splices&quot;">3.2<tt>&nbsp;</tt><a name="(part._cuts-and-splices)"></a>Cuts &amp; splices</h4><p>By default, every matched token shows up in the parse tree. But sometimes that means that the parse tree ends up holding a bunch of tokens that were only needed to complete the parsing. Once they&rsquo;ve served their purpose, it&rsquo;s sometimes useful to filter them out (for instance, to simplify the implementation of a language expander). To help with this kind of housekeeping, <span class="RktSym">brag</span> supports <span style="font-style: italic">cuts</span> and <span style="font-style: italic">splices</span>.</p><p>A <a name="(tech._cut)"></a><span style="font-style: italic">cut</span> in a grammar will delete an item from the parse tree. A cut is notated by prefixing either the left-hand rule name or a right-hand pattern element with a slash&#160;<span class="RktInBG"><span class="hspace"></span><span class="RktIn">/</span><span class="hspace"></span></span>.</p><p>If the cut is applied to a left-hand rule name, the rule name is omitted from the parse tree, but its node and its matched elements remain.</p><p>If the cut is applied to a right-hand pattern element, then that element is omitted from every node matching that rule.</p><p>For instance, consider this simple grammar for arithmetic expressions:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">expr : term ('+' term)*</span></p></td></tr><tr><td><p><span class="stt">term : factor ('*' factor)*</span></p></td></tr><tr><td><p><span class="stt">factor : ("0" | "1" | "2" | "3"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">|</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"4" | "5" | "6" | "7"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| "8"</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">| "9")+</span></p></td></tr></table></p><p>If we use it to parse this string:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">1+2*3</span></p></td></tr></table></p><p>We get this parse tree:</p><blockquote class="SCodeFlow"><p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">expr</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">term</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"1"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"+"</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">term</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"2"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"*"</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"3"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></p></blockquote><p>Suppose we felt the <span class="RktInBG"><span class="hspace"></span><span class="RktIn">+</span><span class="hspace"></span></span> and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">*</span><span class="hspace"></span></span> characters were superfluous. We can add cuts to the grammar by prefixing these pattern elements with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">/</span><span class="hspace"></span></span>:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">expr : term (/'+' term)*</span></p></td></tr><tr><td><p><span class="stt">term : factor (/'*' factor)*</span></p></td></tr><tr><td><p><span class="stt">factor : ("0" | "1" | "2" | "3"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">|</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"4" | "5" | "6" | "7"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| "8"</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">| "9")+</span></p></td></tr></table></p><p>Our parse tree changes accordingly:</p><blockquote class="SCodeFlow"><p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">expr</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">term</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"1"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">term</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"2"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"3"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></p></blockquote><p>Now suppose we apply a cut on the rule name, <span class="RktSym">factor</span>:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">expr : term (/'+' term)*</span></p></td></tr><tr><td><p><span class="stt">term : factor (/'*' factor)*</span></p></td></tr><tr><td><p><span class="stt">/factor : ("0" | "1" | "2" | "3"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">|</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"4" | "5" | "6" | "7"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| "8"</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">| "9")+</span></p></td></tr></table></p><p>This time, the rule name disappears from the parse tree, but its nodes and elements remain:</p><blockquote class="SCodeFlow"><p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">expr</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">term</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"1"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">term</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"2"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">"3"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></p></blockquote><p>A <a name="(tech._splice)"></a><span style="font-style: italic">splice</span> in a grammar will merge the elements of a node into the surrounding node. A splice is notated by prefixing either the left-hand rule name or a right-hand pattern element with an at sign&#160;<span class="RktInBG"><span class="hspace"></span><span class="RktIn">@</span><span class="hspace"></span></span>.</p><p>If the splice is applied to a left-hand rule name, then the splice is applied every time the rule is used in the parse tree.</p><p>If the splice is applied to a right-hand pattern element, that element is spliced only when it appears as part of the production for that rule.</p><p>Suppose we remove the cut from the <span class="RktSym">factor</span> rule name and instead splice the second appearance of <span class="RktSym">factor</span> in the pattern for the <span class="RktSym">term</span> rule:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">expr : term (/'+' term)*</span></p></td></tr><tr><td><p><span class="stt">term : factor (/'*' @factor)*</span></p></td></tr><tr><td><p><span class="stt">factor : ("0" | "1" | "2" | "3"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">|</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"4" | "5" | "6" | "7"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| "8"</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">| "9")+</span></p></td></tr></table></p><p>The <span class="RktSym">factor</span> elements matching the first position of the <span class="RktSym">term</span> pattern remain as they were, but the <span class="RktSym">factor</span> element matching the second position is spliced into the surrounding node:</p><blockquote class="SCodeFlow"><p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">expr</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">term</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"1"</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">term</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"2"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"3"</span><span class="RktVal">)</span><span class="RktVal">)</span></p></blockquote><p>Finally, suppose we add a splice to the <span class="RktSym">term</span> rule name:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">expr : term (/'+' term)*</span></p></td></tr><tr><td><p><span class="stt">@term : factor (/'*' @factor)*</span></p></td></tr><tr><td><p><span class="stt">factor : ("0" | "1" | "2" | "3"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">|</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">"4" | "5" | "6" | "7"</span></p></td></tr><tr><td><p><span class="stt"></span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="stt">| "8"</span><span class="hspace">&nbsp;&nbsp;</span><span class="stt">| "9")+</span></p></td></tr></table></p><p>This time, all the appearances of <span class="RktSym">term</span> nodes in the parse tree will have their elements spliced into the surrounding nodes:</p><blockquote class="SCodeFlow"><p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">expr</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"1"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">factor</span><span class="hspace">&nbsp;</span><span class="RktVal">"2"</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"3"</span><span class="RktVal">)</span></p></blockquote><p>As a convenience, when a grammar element is spliced, or a rule name is cut, <span class="RktSym">brag</span> preserves the rule name by adding it as a syntax property to the residual elements, using the rule name as a key, and the original syntax object representing the rule name as the value.</p><p>Caveat for the top-level rule: though the rule name can have a cut, it cannot have a splice &#8212; once you&rsquo;re at the top level, there&rsquo;s nothing above to splice into.</p><h4 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;Syntax_errors&quot;">3.3<tt>&nbsp;</tt><a name="(part._.Syntax_errors)"></a>Syntax errors</h4><p>Besides the basic syntax errors that can occur with a malformed grammar, there
are a few other classes of situations that <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang brag</span><span class="hspace"></span></span> will consider
as syntax errors.</p><p><div class="SIntrapara"><span class="stt">brag</span> will raise a syntax error if the grammar:
</div><div class="SIntrapara"><ul><li><p>doesn&rsquo;t have any rules.</p></li><li><p>has a rule with the same left hand side as any other rule.</p></li><li><p><div class="SIntrapara">refers to rules that have not been defined. e.g. the
following program:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">foo: [bar]</span></p></td></tr></table></blockquote></div><div class="SIntrapara">should raise an error because <span class="stt">bar</span> has not been defined, even though
<span class="stt">foo</span> refers to it in an <a href="#%28tech._optional._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">optional pattern</span></a>.</div></p></li><li><p>uses the token name <span class="RktSym">EOF</span>; the end-of-file token type is reserved
for internal use by <span class="stt">brag</span>.</p></li><li><p><div class="SIntrapara">contains a rule that has no finite derivation. e.g. the following
program:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">infinite-a: "a" infinite-a</span></p></td></tr></table></blockquote></div><div class="SIntrapara">should raise an error because no finite sequence of tokens will satisfy
<span class="stt">infinite-a</span>.</div></p></li></ul></div></p><p>Otherwise, <span class="stt">brag</span> should be fairly tolerant and permit even ambiguous
grammars.</p><h4 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;Semantics&quot;">3.4<tt>&nbsp;</tt><a name="(part._.Semantics)"></a>Semantics</h4><p>A program written in <span class="RktInBG"><span class="hspace"></span><span class="RktIn">#lang brag</span><span class="hspace"></span></span> produces a module that provides a few
bindings. The most important of these is <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span>:</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._brag/main..rkt)._parse))"></a><span title="Provided from: brag | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValDef RktValLink" data-pltdoc="x">parse</a></span></span><span class="hspace">&nbsp;</span>[<span class="RktVar">source-path</span>]<span class="hspace">&nbsp;</span><span class="RktVar">token-source</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">source-path</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;&nbsp;</span></td><td valign="top"><span class="RktVar">token-source</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">:</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sequenceof</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Parses a series of <a href="#%28tech._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">tokens</span></a> according to the rules in the grammar, using the
 first rule of the grammar for the initial production. The parse must completely consume
 <span class="RktVar">token-source</span>. The optional <span class="RktVar">source-path</span> argument is used to enrich the
 syntax-location fields.</div></p><p>The <a name="(tech._token._source)"></a><span style="font-style: italic">token source</span> can either be a sequence, or a 0-arity function that
 produces <a href="#%28tech._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">tokens</span></a>.</p><p><div class="SIntrapara">A <a name="(tech._token)"></a><span style="font-style: italic">token</span> in <span class="stt">brag</span> can be any of the following values:
 </div><div class="SIntrapara"><ul><li><p>a string</p></li><li><p>a symbol</p></li><li><p>an instance produced by <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span></p></li><li><p>an instance produced by the token constructors of <a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">br-parser-tools/lex</span></a></p></li><li><p>an instance of <a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">br-parser-tools/lex</span></a>&rsquo;s <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._position-token%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">position-token</a></span> whose
<span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html%23%2528def._%2528%2528lib._br-parser-tools%252Flex..rkt%2529._position-token-token%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">position-token-token</a></span> is a <a href="#%28tech._token%29" class="techoutside" data-pltdoc="x"><span class="techinside">token</span></a>.</p></li></ul></div></p><p>A token whose type is either <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=void.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._void%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">void</a></span> or <span class="RktVal">'</span><span class="RktVal">EOF</span> terminates the
 source.</p><p>If <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> succeeds, it will return a structured syntax object. The
 structure of the syntax object follows the overall structure of the rules in
 the BNF grammar. For each rule <span class="RktSym">r</span> and its associated pattern <span class="RktSym">p</span>,
 <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> generates a syntax object <span class="RktRdr">#'</span><span class="RktPn">(</span><span class="RktSym">r</span><span class="stt"> </span><span class="RktSym">p-value</span><span class="RktPn">)</span> where
 <span class="RktSym">p-value</span>&rsquo;s structure follows a case analysis on <span class="RktSym">p</span>:</p><ul><li><p>For implicit and explicit sequences of <a href="#%28tech._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">pattern</span></a>s <span class="RktSym">p1</span>,
<span class="RktSym">p2</span>, ..., the corresponding values, spliced into the
structure.</p></li><li><p>For terminals, the value of the token.</p></li><li><p>For <a href="#%28tech._rule._identifier%29" class="techoutside" data-pltdoc="x"><span class="techinside">rule identifier</span></a>s: the associated parse value for the rule.</p></li><li><p>For <a href="#%28tech._choice._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">choice pattern</span></a>s: the associated parse value for one of the matching subpatterns.</p></li><li><p>For <a href="#%28tech._quantified._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">quantified pattern</span></a>s and <a href="#%28tech._optional._pattern%29" class="techoutside" data-pltdoc="x"><span class="techinside">optional pattern</span></a>s: the corresponding values, spliced into the structure.</p></li></ul><p>Thus, it&rsquo;s only the presence of <a href="#%28tech._rule._identifier%29" class="techoutside" data-pltdoc="x"><span class="techinside">rule identifier</span></a>s in a rule&rsquo;s
 pattern that tells the parser to introduce nested structure into the syntax
 object.</p><p>If the grammar is ambiguous, <span class="stt">brag</span> will choose one of the possible parse results, though it doesn&rsquo;t guarantee which.</p><p>If the parse cannot be performed successfully, or if a token in the
 <span class="RktVar">token-source</span> uses a type that isn&rsquo;t mentioned in the grammar, then
 <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span> raises an instance of <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._exn~3afail~3aparsing%29%29" class="RktValLink" data-pltdoc="x">exn:fail:parsing</a></span>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._brag/main..rkt)._parse-to-datum))"></a><span title="Provided from: brag | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse-to-datum%29%29" class="RktValDef RktValLink" data-pltdoc="x">parse-to-datum</a></span></span><span class="hspace">&nbsp;</span>[<span class="RktVar">source</span>]<span class="hspace">&nbsp;</span><span class="RktVar">token-source</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">source</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td valign="top"><span class="hspace">&nbsp;&nbsp;</span></td><td valign="top"><span class="RktVar">token-source</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">:</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sequenceof</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Same as <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span>, but the result is converted into a plain datum. Useful for testing or debugging a parser.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/main..rkt)._make-rule-parser))"></a><span title="Provided from: brag | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fmain..rkt%29._make-rule-parser%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">make-rule-parser</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">name</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Constructs a parser for the <span class="RktVar">name</span> of one of the non-terminals
in the grammar.</div></p><p><div class="SIntrapara">For example, given the <span class="stt">brag</span> program
<span class="stt">"simple-arithmetic-grammar.rkt"</span>:
</div><div class="SIntrapara"><blockquote class="Rfilebox"><p class="Rfiletitle"><span class="Rfilename"><span class="stt">"simple-arithmetic-grammar.rkt"</span></span></p><blockquote class="Rfilecontent"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#lang brag</span></p></td></tr><tr><td><p><span class="stt">expr : term ('+' term)*</span></p></td></tr><tr><td><p><span class="stt">term : factor ('*' factor)*</span></p></td></tr><tr><td><p><span class="stt">factor : INT</span></p></td></tr></table></blockquote></blockquote></div><div class="SIntrapara">the following interaction shows how to extract a parser for <span class="RktSym">term</span>s.
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"simple-arithmetic-grammar.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">term-parse</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fmain..rkt%29._make-rule-parser%29%29" class="RktStxLink" data-pltdoc="x">make-rule-parser</a></span><span class="hspace">&nbsp;</span><span class="RktSym">term</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">tokens</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">INT</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"*"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">INT</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">tokens</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(expr (term (factor 3) "*" (factor 4)))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">term-parse</span><span class="hspace">&nbsp;</span><span class="RktSym">tokens</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(term (factor 3) "*" (factor 4))</span></p></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">another-token-sequence</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">INT</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"+"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">INT</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">"*"</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">INT</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stxops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._syntax-%7E3edatum%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">syntax-&gt;datum</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse%29%29" class="RktValLink" data-pltdoc="x">parse</a></span><span class="hspace">&nbsp;</span><span class="RktSym">another-token-sequence</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(expr (term (factor 1)) "+" (term (factor 2) "*" (factor 3)))</span></p></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Note that term-parse will break on another-token-sequence</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">as it does not know what to do with the "+"</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">term-parse</span><span class="hspace">&nbsp;</span><span class="RktSym">another-token-sequence</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">Encountered parsing error near "+" (token '+) while parsing</span></p></td></tr><tr><td><p><span class="RktErr">'unknown [line=#f, column=#f, offset=#f]</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>value</p></div></div><p class="RForeground"><a name="(def._((lib._brag/main..rkt)._all-token-types))"></a><span title="Provided from: brag | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._all-token-types%29%29" class="RktValDef RktValLink" data-pltdoc="x">all-token-types</a></span></span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">setof</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=symbols.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._symbol%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">symbol?</a></span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A set of all the token types used in a grammar.</div></p><p><div class="SIntrapara">For example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"simple-arithmetic-grammar.rkt"</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._all-token-types%29%29" class="RktValLink" data-pltdoc="x">all-token-types</a></span></td></tr><tr><td><p><span class="RktRes">(set '* '+ 'INT)</span></p></td></tr></table></blockquote></div></p><h3 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;Support_API&quot;">4<tt>&nbsp;</tt><a name="(part._.Support_.A.P.I)"></a><a name="(mod-path._brag/support)"></a>Support API</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._brag%2Fsupport%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">brag/support</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/brag-lib" title="Install this package using `raco pkg install brag-lib`"><span class="stt">brag-lib</span></a></span></td></tr></table></p><p>The <a href="#%28mod-path._brag%2Fsupport%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">brag/support</span></a> module provides functions to interact with
<span class="stt">brag</span> programs. The most useful is the <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span> function, which
produces tokens to be parsed.</p><p>In addition to the exports shown below, the <a href="#%28mod-path._brag%2Fsupport%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">brag/support</span></a> module also provides everything from <a href="#%28mod-path._brag%2Fsupport%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">brag/support</span></a>, and everything from <a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=br-parser-tools&amp;rel=Lexers.html&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktSym">br-parser-tools/lex</span></a>.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._brag/support..rkt)._token))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValDef RktValLink" data-pltdoc="x">token</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">type</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktVar">val</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:line</span><span class="hspace">&nbsp;</span><span class="RktVar">line</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:column</span><span class="hspace">&nbsp;</span><span class="RktVar">column</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:position</span><span class="hspace">&nbsp;</span><span class="RktVar">position</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:span</span><span class="hspace">&nbsp;</span><span class="RktVar">span</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktPn">#:skip?</span><span class="hspace">&nbsp;</span><span class="RktVar">skip?</span>]<span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token-struct~3f%29%29" class="RktValLink" data-pltdoc="x">token-struct?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=symbols.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._symbol%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">symbol?</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">any/c</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">line</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-positive-integer%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exact-positive-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">column</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">position</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-positive-integer%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exact-positive-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">span</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">skip?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">Creates instances of <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token-struct%29%29" class="RktValLink" data-pltdoc="x">token-struct</a></span>s.</div></p><p>The syntax objects produced by a parse will inject the value <span class="RktVar">val</span> in
place of the token name in the grammar.</p><p>If <span class="RktPn">#:skip?</span> is true, then the parser will skip over it during a
parse.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><table cellspacing="0" cellpadding="0" class="RForeground"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span></td><td><span class="hspace">&nbsp;</span></td><td><a name="(def._((lib._brag/support..rkt)._token-struct-skip~3f))"></a><a name="(def._((lib._brag/support..rkt)._token-struct-span))"></a><a name="(def._((lib._brag/support..rkt)._token-struct-column))"></a><a name="(def._((lib._brag/support..rkt)._token-struct-line))"></a><a name="(def._((lib._brag/support..rkt)._token-struct-position))"></a><a name="(def._((lib._brag/support..rkt)._token-struct-val))"></a><a name="(def._((lib._brag/support..rkt)._token-struct-type))"></a><a name="(def._((lib._brag/support..rkt)._make-token-struct))"></a><a name="(def._((lib._brag/support..rkt)._token-struct~3f))"></a><a name="(def._((lib._brag/support..rkt)._struct~3atoken-struct))"></a><a name="(def._((lib._brag/support..rkt)._token-struct))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token-struct%29%29" class="RktValDef RktValLink" data-pltdoc="x">token-struct</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">type</span><span class="stt"> </span><span class="RktSym">val</span><span class="stt"> </span><span class="RktSym">position</span><span class="stt"> </span><span class="RktSym">line</span><span class="stt"> </span><span class="RktSym">column</span><span class="stt"> </span><span class="RktSym">span</span><span class="stt"> </span><span class="RktSym">skip?</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:extra-constructor-name</span><span class="hspace">&nbsp;</span><span class="RktSym">make-token-struct</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">type</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=symbols.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._symbol%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">symbol?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">val</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fprivate%252Fmisc..rkt%2529._any%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">any/c</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">position</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-positive-integer%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exact-positive-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">line</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">column</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-positive-integer%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exact-positive-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">span</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=number-types.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._exact-nonnegative-integer%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exact-nonnegative-integer?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">skip?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=booleans.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._boolean%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">boolean?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">The token structure type.</div></p><p>Rather than directly using the <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token-struct%29%29" class="RktValLink" data-pltdoc="x">token-struct</a></span> constructor, please use
the helper function <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._token%29%29" class="RktValLink" data-pltdoc="x">token</a></span> to construct instances.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>struct</p></div></div><table cellspacing="0" cellpadding="0" class="RForeground"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span></td><td><span class="hspace">&nbsp;</span></td><td><span class="nobreak"><a name="(def._((lib._brag/support..rkt)._exn~3afail~3aparsing-srclocs))"></a><a name="(def._((lib._brag/support..rkt)._exn~3afail~3aparsing-continuation-marks))"></a><a name="(def._((lib._brag/support..rkt)._exn~3afail~3aparsing-message))"></a><a name="(def._((lib._brag/support..rkt)._make-exn~3afail~3aparsing))"></a><a name="(def._((lib._brag/support..rkt)._exn~3afail~3aparsing~3f))"></a><a name="(def._((lib._brag/support..rkt)._struct~3aexn~3afail~3aparsing))"></a><a name="(def._((lib._brag/support..rkt)._exn~3afail~3aparsing))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._exn~3afail~3aparsing%29%29" class="RktValDef RktValLink" data-pltdoc="x">exn:fail:parsing</a></span></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._exn%7E3afail%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exn:fail</a></span></span></td><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span></td><td><span class="nobreak"><span class="RktSym">message</span></span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">continuation-marks</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">srclocs</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">#:extra-constructor-name</span><span class="hspace">&nbsp;</span><span class="RktSym">make-exn:fail:parsing</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">message</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">continuation-marks</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=contmarks.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._continuation-mark-set%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">continuation-mark-set?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">srclocs</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._listof%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">listof</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._srcloc%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">srcloc?</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">The exception raised when parsing fails.</div></p><p><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._exn~3afail~3aparsing%29%29" class="RktValLink" data-pltdoc="x">exn:fail:parsing</a></span> implements Racket&rsquo;s <span class="RktSym">prop:exn:srcloc</span>
property, so if this exception reaches DrRacket&rsquo;s default error handler,
DrRacket should highlight the offending locations in the source.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._brag/support..rkt)._apply-port-proc))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._apply-port-proc%29%29" class="RktValDef RktValLink" data-pltdoc="x">apply-port-proc</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>[<span class="RktVar">port</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">proc</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">port</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._input-port%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">input-port?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-input-port%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">current-input-port</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Repeatedly apply <span class="RktVar">proc</span> to <span class="RktVar">port</span>, gathering the results into a list. <span class="RktVar">port</span> can be an input port or a string (which is converted to a string port). Useful for testing or debugging a lexer or tokenizer.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._brag/support..rkt)._apply-lexer))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._apply-lexer%29%29" class="RktValDef RktValLink" data-pltdoc="x">apply-lexer</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">lexer</span><span class="hspace">&nbsp;</span>[<span class="RktVar">port</span>]<span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">lexer</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">port</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._input-port%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">input-port?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-input-port%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">current-input-port</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Alias for <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._apply-port-proc%29%29" class="RktValLink" data-pltdoc="x">apply-port-proc</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._brag/support..rkt)._apply-tokenizer-maker))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._apply-tokenizer-maker%29%29" class="RktValDef RktValLink" data-pltdoc="x">apply-tokenizer-maker</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">tokenizer-maker</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span>[</td><td valign="top"><span class="RktVar">port</span>]<span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pairs.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._list%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">list?</a></span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">tokenizer-maker</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=procedures.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._procedure%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">procedure?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">port</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=data-structure-contracts.html%23%2528def._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._or%252Fc%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">or/c</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string?</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._input-port%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">input-port?</a></span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=port-ops.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._current-input-port%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">current-input-port</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Repeatedly apply <span class="RktVar">tokenizer-maker</span> to <span class="RktVar">port</span>, gathering the resulting tokens into a list. <span class="RktVar">port</span> can be an input port or a string (which is converted to a string port).</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._brag/support..rkt)._trim-ends))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._trim-ends%29%29" class="RktValDef RktValLink" data-pltdoc="x">trim-ends</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">left-str</span><span class="hspace">&nbsp;</span><span class="RktVar">str</span><span class="hspace">&nbsp;</span><span class="RktVar">right-str</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string?</a></span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">left-str</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">str</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string?</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">right-str</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528quote._%7E23%7E25kernel%2529._string%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">string?</a></span></td></tr></table></blockquote></div><div class="SIntrapara">Remove <span class="RktVar">left-str</span> from the left side of <span class="RktVar">str</span>, and <span class="RktVar">right-str</span> from its right side. Intended as a helper function for <span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._from%2Fto%29%29" class="RktStxLink" data-pltdoc="x">from/to</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a*))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a%2A%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:*</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">0 or more occurrences of any <span class="RktVar">re</span> pattern.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a+))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a%2B%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:+</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">1 or more occurrences of any <span class="RktVar">re</span> pattern.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a~3f))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~3f%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:?</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">0 or 1 occurrence of any <span class="RktVar">re</span> pattern.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a~3d))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~3d%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:=</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Exactly <span class="RktVar">n</span> occurrences of any <span class="RktVar">re</span> pattern, where
<span class="RktVar">n</span> must be a literal exact, non-negative number.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a~3e~3d))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~3e~3d%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:&gt;=</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">At least <span class="RktVar">n</span> occurrences of any <span class="RktVar">re</span> pattern, where
<span class="RktVar">n</span> must be a literal exact, non-negative number.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a**))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a%2A%2A%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:**</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">n</span><span class="hspace">&nbsp;</span><span class="RktVar">m</span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Between <span class="RktVar">n</span> and <span class="RktVar">m</span> (inclusive) occurrences of
any <span class="RktVar">re</span> pattern, where <span class="RktVar">n</span> must be a literal exact,
non-negative number, and <span class="RktVar">m</span> must be literally either
<span class="RktVal">#f</span>, <span class="RktVal">+inf.0</span>, or an exact, non-negative number; a
<span class="RktVal">#f</span> value for <span class="RktVar">m</span> is the same as <span class="RktVal">+inf.0</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3aor))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3aor%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:or</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Same as <span class="RktPn">(</span><span class="RktSym">:union</span><span class="stt"> </span><span class="RktVar">re</span><span class="stt"> </span><span class="RktMeta"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a~3a))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~3a%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">::</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="together"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3aseq))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3aseq%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:seq</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">Both forms concatenate the <span class="RktVar">re</span>s into a single, indivisible pattern.
In other words, this matches <span style="font-style: italic">all</span> the <span class="RktVar">re</span>s in order, whereas <span class="RktPn">(</span><span class="RktSym">:union</span><span class="stt"> </span><span class="RktVar">re</span><span class="stt"> </span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529._......%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">...</a></span><span class="RktPn">)</span> matches <span style="font-style: italic">any</span> of the <span class="RktVar">re</span>s.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a~26))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~26%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:&amp;</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Intersects the <span class="RktVar">re</span>s.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a-))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a-%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:-</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">The set difference of the <span class="RktVar">re</span>s.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a~7e))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a~7e%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:~</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">re</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Character-set complement, which each <span class="RktVar">re</span> must match exactly
one character.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._~3a/))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._~3a%2F%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">:/</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">char-or-string</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Character ranges, matching characters between successive pairs of
characters.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._from/to))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._from%2Fto%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">from/to</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">open</span><span class="hspace">&nbsp;</span><span class="RktVar">close</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">A string that is bounded by <span class="RktVar">open</span> and <span class="RktVar">close</span>. Matching is non-greedy (meaning, it stops at the first occurence of <span class="RktVar">close</span>). The resulting lexeme includes <span class="RktVar">open</span> and <span class="RktVar">close</span>. To remove them, see <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._trim-ends%29%29" class="RktValLink" data-pltdoc="x">trim-ends</a></span>.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._brag/support..rkt)._from/stop-before))"></a><span title="Provided from: brag/support | Package: brag-lib"><span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._from%2Fstop-before%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">from/stop-before</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">open</span><span class="hspace">&nbsp;</span><span class="RktVar">close</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Like <span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._from%2Fto%29%29" class="RktStxLink" data-pltdoc="x">from/to</a></span>, a string that is bounded by <span class="RktVar">open</span> and <span class="RktVar">close</span>, except that <span class="RktVar">close</span> is not included in the resulting lexeme. Matching is non-greedy (meaning, it stops at the first occurence of <span class="RktVar">close</span>).</div></p><h4 x-source-module="(lib &quot;brag/brag.scrbl&quot;)" x-source-pkg="brag" x-part-tag="&quot;Differences_with_ragg&quot;">4.1<tt>&nbsp;</tt><a name="(part._.Differences_with_ragg)"></a>Differences with <span class="stt">ragg</span></h4><p>This package is a fork of <a href="https://docs.racket-lang.org/ragg"><span class="RktSym">ragg</span></a>. The most salient additions:</p><ul><li><p><a href="#%28part._cuts-and-splices%29" data-pltdoc="x">Cuts &amp; splices</a>.</p></li><li><p>Improved <a href="#%28part._brag-syntax%29" data-pltdoc="x">syntax</a> for grammars, including comments and and quantified patterns.</p></li><li><p>Support for REPL interactions.</p></li><li><p>Some new conveniences, like <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fmain..rkt%29._parse-to-datum%29%29" class="RktValLink" data-pltdoc="x">parse-to-datum</a></span>, <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._apply-lexer%29%29" class="RktValLink" data-pltdoc="x">apply-lexer</a></span>, <span class="RktSym"><a href="#%28def._%28%28lib._brag%2Fsupport..rkt%29._trim-ends%29%29" class="RktValLink" data-pltdoc="x">trim-ends</a></span>, <span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._from%2Fto%29%29" class="RktStxLink" data-pltdoc="x">from/to</a></span>, and <span class="RktSym"><a href="#%28form._%28%28lib._brag%2Fsupport..rkt%29._from%2Fstop-before%29%29" class="RktStxLink" data-pltdoc="x">from/stop-before</a></span>.</p></li></ul><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>