<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>SQLSourcery</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">SQLSourcery</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Motivation%29" class="tocviewlink" data-pltdoc="x">Motivation</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Database_.Connection%29" class="tocviewlink" data-pltdoc="x">Database Connection</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.Sourcery_.Structures%29" class="tocviewlink" data-pltdoc="x">Sourcery Structures</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Testing%29" class="tocviewlink" data-pltdoc="x">Testing</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._.Programming_with_.S.Q.L.Sourcery%29" class="tocviewlink" data-pltdoc="x">Programming with SQLSourcery</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">SQLSourcery</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Motivation%29" class="tocsubseclink" data-pltdoc="x">Motivation</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Database_.Connection%29" class="tocsubseclink" data-pltdoc="x">Database Connection</a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-db%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">sourcery-<wbr></wbr>db</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Sourcery_.Structures%29" class="tocsubseclink" data-pltdoc="x">Sourcery Structures</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Structure_.Definition%29" class="tocsubseclink" data-pltdoc="x">Structure Definition</a></td></tr><tr><td><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-struct%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">sourcery-<wbr></wbr>struct</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._struct-name~3f%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">struct-<wbr></wbr>name?</span></a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._struct-name-create%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">struct-<wbr></wbr>name-<wbr></wbr>create</span></a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._struct-name-update%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">struct-<wbr></wbr>name-<wbr></wbr>update</span></a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._struct-name-field%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym">struct-<wbr></wbr>name-<wbr></wbr>field</span></a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.Loading_.Structures%29" class="tocsubseclink" data-pltdoc="x">Loading Structures</a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-load%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">sourcery-<wbr></wbr>load</span></span></a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Deleting_.Structures%29" class="tocsubseclink" data-pltdoc="x">Deleting Structures</a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-delete%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">sourcery-<wbr></wbr>delete</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-filter-delete%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">sourcery-<wbr></wbr>filter-<wbr></wbr>delete</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Testing%29" class="tocsubseclink" data-pltdoc="x">Testing</a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Testing_.Philosophy%29" class="tocsubseclink" data-pltdoc="x">Testing Philosophy</a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.T.E.S.T.I.N.G_.V.A.R.I.A.B.L.E.S%29" class="tocsubseclink" data-pltdoc="x">Testing Variables</a></td></tr><tr><td><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._declare-test-vars%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">declare-<wbr></wbr>test-<wbr></wbr>vars</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">set-<wbr></wbr>test-<wbr></wbr>var!</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._clear-test-vars%21%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">clear-<wbr></wbr>test-<wbr></wbr>vars!</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.3<tt>&nbsp;</tt></span><a href="#%28part._.T.E.S.T.I.N.G_.A.C.T.I.O.N.S%29" class="tocsubseclink" data-pltdoc="x">Testing Actions</a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._action%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">action</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-action%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>action</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._action-compose%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">action-<wbr></wbr>compose</span></span></a></td></tr><tr><td><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-composed-action%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define-<wbr></wbr>composed-<wbr></wbr>action</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.4<tt>&nbsp;</tt></span><a href="#%28part._.T.E.S.T.I.N.G_.C.L.E.A.N.U.P%29" class="tocsubseclink" data-pltdoc="x">Testing Cleanup</a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._clear-sourcery-structs%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">clear-<wbr></wbr>sourcery-<wbr></wbr>structs</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4.5<tt>&nbsp;</tt></span><a href="#%28part._.T.E.S.T.I.N.G_.S.U.I.T.E.S%29" class="tocsubseclink" data-pltdoc="x">Sourcery Test Suites</a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-test-suite%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">sourcery-<wbr></wbr>test-<wbr></wbr>suite</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._run-sourcery-tests%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">run-<wbr></wbr>sourcery-<wbr></wbr>tests</span></span></a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.Programming_with_.S.Q.L.Sourcery%29" class="tocsubseclink" data-pltdoc="x">Programming with SQLSourcery</a></td></tr><tr><td><span class="tocsublinknumber">5.1<tt>&nbsp;</tt></span><a href="#%28part._.S.Q.L.Sourcery__.Side_.Effects__and_.Mutation%29" class="tocsubseclink" data-pltdoc="x">SQLSourcery, Side Effects, and Mutation</a></td></tr><tr><td><span class="tocsublinknumber">5.2<tt>&nbsp;</tt></span><a href="#%28part._.Under_.The_.Hood%29" class="tocsubseclink" data-pltdoc="x">Under The Hood</a></td></tr><tr><td><span class="tocsublinknumber">5.3<tt>&nbsp;</tt></span><a href="#%28part._.D.E.A.D%29" class="tocsubseclink" data-pltdoc="x">Dead References</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.4</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._.S.Q.L.Sourcery)"></a><a name="(mod-path._sql-sourcery)"></a>SQLSourcery</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Adrian Kant and Taylor Murphy</p></span></div><p>Database backed structs for functional programmers.
A SQLSourcery programmer is a sourcerer.</p><p><a href="https://github.com/adjkant/sql-sourcery">Github Repo</a></p><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">sql-sourcery</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/sql-sourcery" title="Install this package using `raco pkg install sql-sourcery`"><span class="stt">sql-sourcery</span></a></span></td></tr></table></p><h3 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Motivation&quot;">1<tt>&nbsp;</tt><a name="(part._.Motivation)"></a>Motivation</h3><p>Racket programs require lots of boilerplate for any sort of basic I/O persistency, and getting this
I/O to fit into a functional style causes many additional problems. SQLSourcery attempts to allow a
sourcerer to easily spin up state persistency of their structures that can fit into their coding
paradigms with minimal adaptation.</p><h3 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Database_Connection&quot;">2<tt>&nbsp;</tt><a name="(part._.Database_.Connection)"></a>Database Connection</h3><p>SQLSourcery programs must first connect to a SQLite database. It is typical to set the database at the
top of a file or module. Test modules typically use a different database than programs. When a
database is changed, all loaded sourcery structures currently in existence are subject to error. Any
operations besides sourcery structure declarations will throw an error if a database is not set.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._sourcery-db))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-db%29%29" class="RktValDef RktValLink" data-pltdoc="x">sourcery-db</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">db-file-path</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">void</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">db-file-path</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">string?</span></td></tr></table></blockquote></div><div class="SIntrapara">Creates a connection to a SQLite database at the given path location to be used for all
SQLSourcery operations until the database is changed. Ensure tables exist for all previously defined
structures in the program.</div></p><p><div class="SIntrapara">Example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-db%29%29" class="RktValLink" data-pltdoc="x">sourcery-db</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"spells.db"</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote></div></p><h3 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Sourcery_Structures&quot;">3<tt>&nbsp;</tt><a name="(part._.Sourcery_.Structures)"></a>Sourcery Structures</h3><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Structure_Definition&quot;">3.1<tt>&nbsp;</tt><a name="(part._.Structure_.Definition)"></a>Structure Definition</h4><p>A sourcery-struct acts as a typical structure with added database persistence.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._sql-sourcery/main..rkt)._sourcery-struct))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-struct%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">sourcery-struct</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">struct-name</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktVar">field-name</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">field-name</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr><tr><td><span class="stt">&nbsp;</span></td></tr><tr><td><blockquote class="SubFlow"><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">struct-name</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">id?</span></td></tr></table><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">field-name</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">id?</span></td></tr></table><table cellspacing="0" cellpadding="0" class="argcontract"><tr><td><span class="hspace">&nbsp;&nbsp;</span></td><td><span class="RktVar">type</span></td><td><span class="hspace">&nbsp;</span></td><td>:</td><td><span class="hspace">&nbsp;</span></td><td><span class="RktSym">acceptable-struct-type?</span></td></tr></table></blockquote></td></tr></table></blockquote></div><div class="SIntrapara"><table cellspacing="0" cellpadding="0"><tr><td align="right" valign="baseline"><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">type</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">=</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">STRING</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">INTEGER</span></td></tr><tr><td align="right" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="center" valign="baseline">|</td><td align="left" valign="baseline"><span class="stt">&nbsp;</span></td><td align="left" valign="baseline"><span class="RktVar">BOOLEAN</span></td></tr></table></div></p><p><div class="SIntrapara">Example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-struct%29%29" class="RktStxLink" data-pltdoc="x">sourcery-struct</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">spell</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">STRING</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">power</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">INTEGER</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">deadly?</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">BOOLEAN</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote></div></p><p>This will create a new structure source or connect to an existing structure source with an identical
definition. If an existing sourcery-struct deinition with the same name already exists in the database
but the definition is not identical, an error will be raised.</p><p>No field name identifier can start with the characters "__", nor can they be one of the
following reserved fields:</p><ul><li><p>update</p></li><li><p>create</p></li><li><p>map</p></li><li><p>unmapped</p></li></ul><p>A sourcery-struct definition will create the following functions:</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._struct-name~3f))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><span class="RktSymDef RktSym">struct-name?</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">boolean?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">x</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">any?</span></td></tr></table></blockquote></div><div class="SIntrapara">A predicate for a structure. Will return true only when its argument is of the type struct-name.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._struct-name-create))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><span class="RktSymDef RktSym">struct-name-create</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">field</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">struct-name?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">field</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">any?</span></td></tr></table></blockquote></div><div class="SIntrapara">Creates a new instance of the structure in both the program and the database. The number of
arguments and the type of each argument must match the sourcery-struct definition.</div></p><p><div class="SIntrapara">Example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">spell-create</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"Summon</span><span class="hspace">&nbsp;</span><span class="RktVal">Bees"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">100</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">#true</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote></div><div class="SIntrapara">Result:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">spell</span><span class="hspace">&nbsp;</span><span class="RktVal">"Summon Bees"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></p></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._struct-name-update))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><span class="RktSymDef RktSym">struct-name-update</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">ref-struct</span><span class="hspace">&nbsp;</span><span class="RktVar">field</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">struct-name?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">ref-struct</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">struct-name?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">field</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">any?</span></td></tr></table></blockquote></div><div class="SIntrapara">Updates the given structure in the database to have the given field values and return the
newly created structure in the program. All references to the given structure will also be changed.</div></p><p><div class="SIntrapara">Example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">bees</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell-create</span><span class="hspace">&nbsp;</span><span class="RktVal">"Summon Bees"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">bees-new</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell-update</span><span class="hspace">&nbsp;</span><span class="RktSym">bees</span><span class="hspace">&nbsp;</span><span class="RktVal">"Summon Bees"</span><span class="hspace">&nbsp;</span><span class="RktVal">200</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">spell-power</span><span class="hspace">&nbsp;</span><span class="RktSym">bees-new</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">200</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">spell-power</span><span class="hspace">&nbsp;</span><span class="RktSym">bees</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">200</span></p></td></tr></table></blockquote><p>Here both bees and new-bees reference the same spell.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._struct-name-field))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><span class="RktSymDef RktSym">struct-name-field</span></span></span><span class="hspace">&nbsp;</span><span class="RktVar">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">any?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">s</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">struct-name?</span></td></tr></table></blockquote></div><div class="SIntrapara">Creates accessors for each field are generated as the racket
<a href="https://docs.racket-lang.org/reference/define-struct.html?q=struct#%28form._%28%28lib.
              _racket%2Fprivate%2Fbase..rkt%29._struct%29%29">struct</a>
construct does.</div></p><p><div class="SIntrapara">Examples:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">spell-name</span><span class="hspace">&nbsp;</span><span class="RktSym">bees</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">"Summon Bees"</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">spell-power</span><span class="hspace">&nbsp;</span><span class="RktSym">bees</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">200</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">spell-deadly?</span><span class="hspace">&nbsp;</span><span class="RktSym">bees</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Loading_Structures&quot;">3.2<tt>&nbsp;</tt><a name="(part._.Loading_.Structures)"></a>Loading Structures</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._sourcery-load))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-load%29%29" class="RktValDef RktValLink" data-pltdoc="x">sourcery-load</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">struct-name</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">listof</span><span class="hspace">&nbsp;</span><span class="RktVar">struct-name</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">struct-name</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">id?</span></td></tr></table></blockquote></div><div class="SIntrapara">Return a list of all of the structures currently in existence in the current database.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">spell-create</span><span class="hspace">&nbsp;</span><span class="RktVal">"Expecto"</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">spell-create</span><span class="hspace">&nbsp;</span><span class="RktVal">"Patronum"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-load%29%29" class="RktValLink" data-pltdoc="x">sourcery-load</a></span><span class="hspace">&nbsp;</span><span class="RktSym">spell</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Result:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell</span><span class="hspace">&nbsp;</span><span class="RktVal">"Expecto"</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell</span><span class="hspace">&nbsp;</span><span class="RktVal">"Patronum"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></div></p><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Deleting_Structures&quot;">3.3<tt>&nbsp;</tt><a name="(part._.Deleting_.Structures)"></a>Deleting Structures</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._sourcery-delete))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-delete%29%29" class="RktValDef RktValLink" data-pltdoc="x">sourcery-delete</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">sourcery-struct</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">void</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">sourcery-struct</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">sourcery-struct?</span></td></tr></table></blockquote></div><div class="SIntrapara">Delete the given sourcery-struct from the database. Any existing references to the sourcery-struct
will become <a href="#%28part._.D.E.A.D%29" data-pltdoc="x">dead references</a>.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">bees</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell-create</span><span class="hspace">&nbsp;</span><span class="RktVal">"Summon Bees"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-delete%29%29" class="RktValLink" data-pltdoc="x">sourcery-delete</a></span><span class="hspace">&nbsp;</span><span class="RktSym">bees</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>Attempting to operate on <span style="font-style: italic">bees</span> will result in an error.</p><p><div class="SIntrapara">Attempting to display <span style="font-style: italic">bees</span> will result in:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">spell</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">dead-reference</span><span class="RktPn">)</span></p></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._sourcery-filter-delete))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-filter-delete%29%29" class="RktValDef RktValLink" data-pltdoc="x">sourcery-filter-delete</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">predicate</span><span class="hspace">&nbsp;</span><span class="RktVar">refs</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-of</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-struct%29%29" class="RktStxLink" data-pltdoc="x">sourcery-struct</a></span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">predicate</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">sourcery-struct?</span><span class="hspace">&nbsp;</span><span class="RktSym">boolean?</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">refs</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list-of</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-struct%29%29" class="RktStxLink" data-pltdoc="x">sourcery-struct</a></span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara">Return all sourcery-struct&rsquo;s which match the predicate and sourcery-delete the structures that
fail the predicate.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">spell-create</span><span class="hspace">&nbsp;</span><span class="RktVal">"Expecto"</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">spell-create</span><span class="hspace">&nbsp;</span><span class="RktVal">"Patronum"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-filter-delete%29%29" class="RktValLink" data-pltdoc="x">sourcery-filter-delete</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell-deadly?</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-load%29%29" class="RktValLink" data-pltdoc="x">sourcery-load</a></span><span class="hspace">&nbsp;</span><span class="RktSym">spell</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Result:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell</span><span class="hspace">&nbsp;</span><span class="RktVal">"Patronum"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">#true</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></div></p><p>The example above deletes all spells that are not deadly.</p><h3 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Testing&quot;">4<tt>&nbsp;</tt><a name="(part._.Testing)"></a>Testing</h3><p>SQLSourcery programs must test mutation and be able to easily write setup and teardown. While possible
with racket, the library can be combersome to use. SQLSourcery comes with a testing library.</p><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Testing_Philosophy&quot;">4.1<tt>&nbsp;</tt><a name="(part._.Testing_.Philosophy)"></a>Testing Philosophy</h4><p><div class="SIntrapara">There are a few main concepts that come with SQLSourcery&rsquo;s testing library:
</div><div class="SIntrapara"><ul><li><p><a href="#%28part._.T.E.S.T.I.N.G_.V.A.R.I.A.B.L.E.S%29" data-pltdoc="x">Testing Variables</a></p></li><li><p><a href="#%28part._.T.E.S.T.I.N.G_.A.C.T.I.O.N.S%29" data-pltdoc="x">Testing Actions</a></p></li><li><p><a href="#%28part._.T.E.S.T.I.N.G_.S.U.I.T.E.S%29" data-pltdoc="x">Sourcery Test Suites</a></p></li></ul></div></p><p>Sourcery Test Suites uses the racket
<a href="https://docs.racket-lang.org/rackunit/api.html?q=test-suite#%28form._%28%28lib.
_rackunit%2Fmain..rkt%29._test-suite%29%29">test-suite</a>
and adds the tests to a module level global lists of tests that can be run with a single command. At
its core, these are most useful for their before and after clauses, which take in
<a href="#%28part._.T.E.S.T.I.N.G_.A.C.T.I.O.N.S%29" data-pltdoc="x">actions</a>.</p><p>In order to take advantage of before and after clauses in test suites, varaibles must be avaiable
in the before, during, and after stages, as well as being able to be modified. While this can be done
with set!, the testing library allows easy declaration, setting, and clearing of testing varaibles
through a simple API that clearly signifies their status for testing and will prevent accidental
mutation of variables not used in testing.</p><p>Before and after clauses in
<a href="https://docs.racket-lang.org/rackunit/api.html?q=test-suite#%28form._%28%28lib.
_rackunit%2Fmain..rkt%29._test-suite%29%29">test-suite</a>
are thunks that return void. To simplify writing these thunks, the testing library introduces the
concept of actions that can perform multiple operations at once and can be composed together in an
intuitive order for the context of testing.</p><p>Testing will use the currently set sourcery-db. It is customary to test by using a test module and
using a testing database via a call to sourcery-db at the start of the module</p><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;TESTING_VARIABLES&quot;">4.2<tt>&nbsp;</tt><a name="(part._.T.E.S.T.I.N.G_.V.A.R.I.A.B.L.E.S)"></a>Testing Variables</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._sql-sourcery/main..rkt)._declare-test-vars))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._declare-test-vars%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">declare-test-vars</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">var-id</span><span class="hspace">&nbsp;</span><span class="RktVar">id?</span><span class="RktPn">]</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Define the given ids to be test variables with the initial value of #f using the racket define.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._declare-test-vars%29%29" class="RktStxLink" data-pltdoc="x">declare-test-vars</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">a</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">b</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">c</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._set-test-var!))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">set-test-var!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">var-id</span><span class="hspace">&nbsp;</span><span class="RktVar">value</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">void</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">var-id</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">id?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">value</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">any?</span></td></tr></table></blockquote></div><div class="SIntrapara">Set the given test varaible to the given value. Will error if the given id is not a test varaible.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">d</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">a</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">b</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">c</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">d</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">a</span></td></tr><tr><td><p><span class="RktRes">1</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">d</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">set-test-var!: Invalid test variable: d</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._clear-test-vars!))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._clear-test-vars%21%29%29" class="RktValDef RktValLink" data-pltdoc="x">clear-test-vars!</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">var-id</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">void</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">var-id</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">id?</span></td></tr></table></blockquote></div><div class="SIntrapara">Set the given test variable ids to #false. Error if given an invalid test id. If error occurs, all
ids listed before the invalid id will be set.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">c</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">a</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">b</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">c</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._clear-test-vars%21%29%29" class="RktValLink" data-pltdoc="x">clear-test-vars!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">b</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">a</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">b</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">c</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;TESTING_ACTIONS&quot;">4.3<tt>&nbsp;</tt><a name="(part._.T.E.S.T.I.N.G_.A.C.T.I.O.N.S)"></a>Testing Actions</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._action))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._action%29%29" class="RktValDef RktValLink" data-pltdoc="x">action</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">thunk?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">...</span></td></tr></table></blockquote></div><div class="SIntrapara">Create an action (thunk) that runs all expressions inside a begin and then returns void.</div></p><p><div class="SIntrapara">Example using set!:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._action%29%29" class="RktValLink" data-pltdoc="x">action</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set!</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">x</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Example using test variables:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktSym">a</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._action%29%29" class="RktValLink" data-pltdoc="x">action</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">a</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._sql-sourcery/main..rkt)._define-action))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-action%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-action</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktVar">id?</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktVar">any?</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Define an action with the given name.</div></p><p><div class="SIntrapara">Shortcut for:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._action%29%29" class="RktValLink" data-pltdoc="x">action</a></span><span class="hspace">&nbsp;</span><span class="RktVar">expr</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></div></p><p><div class="SIntrapara">Example using set!:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-action%29%29" class="RktStxLink" data-pltdoc="x">define-action</a></span><span class="hspace">&nbsp;</span><span class="RktSym">action-1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">set!</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">action-1</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">x</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Example using test variables:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktSym">a</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-action%29%29" class="RktStxLink" data-pltdoc="x">define-action</a></span><span class="hspace">&nbsp;</span><span class="RktSym">action-2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">action-2</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">a</span></td></tr><tr><td><p><span class="RktRes">4</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._action-compose))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._action-compose%29%29" class="RktValDef RktValLink" data-pltdoc="x">action-compose</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">action</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">thunk?</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">action</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">thunk?</span></td></tr></table></blockquote></div><div class="SIntrapara">Create a single action that executes the given actions from left to right.</div></p><p><div class="SIntrapara">Example:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._declare-test-vars%29%29" class="RktStxLink" data-pltdoc="x">declare-test-vars</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v1</span><span class="hspace">&nbsp;</span><span class="RktSym">v2</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-action%29%29" class="RktStxLink" data-pltdoc="x">define-action</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v1</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-action%29%29" class="RktStxLink" data-pltdoc="x">define-action</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v2</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-action%29%29" class="RktStxLink" data-pltdoc="x">define-action</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-3</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._set-test-var%21%29%29" class="RktValLink" data-pltdoc="x">set-test-var!</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v1</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-4</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._action-compose%29%29" class="RktValLink" data-pltdoc="x">action-compose</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-1</span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-2</span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">v1</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">v2</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">v-action-4</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">v1</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">v2</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(form._((lib._sql-sourcery/main..rkt)._define-composed-action))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-composed-action%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define-composed-action</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktVar">name</span><span class="hspace">&nbsp;</span><span class="RktVar">id?</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">[</span><span class="RktVar">action</span><span class="hspace">&nbsp;</span><span class="RktVar">action?</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">]</span><span class="RktPn">)</span></p></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Define an action with the given name by composing the given actions.</div></p><p><div class="SIntrapara">:Example</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._sql-sourcery%2Fmain..rkt%29._define-composed-action%29%29" class="RktStxLink" data-pltdoc="x">define-composed-action</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-4-easier</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">v-action-1</span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-2</span><span class="hspace">&nbsp;</span><span class="RktSym">v-action-3</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">v1</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">v2</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">v-action-4-easier</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">v1</span></td></tr><tr><td><p><span class="RktRes">3</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktSym">v2</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr></table></blockquote></div></p><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;TESTING_CLEANUP&quot;">4.4<tt>&nbsp;</tt><a name="(part._.T.E.S.T.I.N.G_.C.L.E.A.N.U.P)"></a>Testing Cleanup</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._clear-sourcery-structs))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._clear-sourcery-structs%29%29" class="RktValDef RktValLink" data-pltdoc="x">clear-sourcery-structs</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">struct-name</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktSym">void</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">struct-name</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">struct-name?</span></td></tr></table></blockquote></div><div class="SIntrapara">sourcery-delete all existing sourcery-structs of the type of the given names. Will possibly
create <a href="#%28part._.D.E.A.D%29" data-pltdoc="x">dead references</a>.</div></p><p><div class="SIntrapara">:Example</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">alakazam</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell-create</span><span class="hspace">&nbsp;</span><span class="RktVal">"Alakazam"</span><span class="hspace">&nbsp;</span><span class="RktVal">100</span><span class="hspace">&nbsp;</span><span class="RktVal">#false</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._clear-sourcery-structs%29%29" class="RktValLink" data-pltdoc="x">clear-sourcery-structs</a></span><span class="hspace">&nbsp;</span><span class="RktSym">spell</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-load%29%29" class="RktValLink" data-pltdoc="x">sourcery-load</a></span><span class="hspace">&nbsp;</span><span class="RktSym">spell</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Accessesing <span style="font-style: italic">alakazam</span> will result in:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">spell</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">dead-reference</span><span class="RktPn">)</span></p></blockquote></div></p><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;TESTING_SUITES&quot;">4.5<tt>&nbsp;</tt><a name="(part._.T.E.S.T.I.N.G_.S.U.I.T.E.S)"></a>Sourcery Test Suites</h4><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._sourcery-test-suite))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-test-suite%29%29" class="RktValDef RktValLink" data-pltdoc="x">sourcery-test-suite</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">name-expr</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">maybe-before</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">maybe-after</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">test</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym">void</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">name-expr</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">string?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">maybe-before</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">before-action</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">maybe-after</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">after-action</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">test</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">test?</span></td></tr></table></blockquote></div><div class="SIntrapara">Acts the same as
<a href="https://docs.racket-lang.org/rackunit/api.html?q=test-suite#%28form._%28%28lib.
_rackunit%2Fmain..rkt%29._test-suite%29%29">test-suite</a>
except that it will add the suite to the global tests.</div></p><p><div class="SIntrapara">Example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._sourcery-test-suite%29%29" class="RktValLink" data-pltdoc="x">sourcery-test-suite</a></span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">"A sourcery-test-suite using fictional actions"</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">#:before</span><span class="hspace">&nbsp;</span><span class="RktSym">su-create-all</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">#:after</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">td-complete</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=rackunit&amp;rel=api.html%23%2528def._%2528%2528lib._rackunit%252Fmain..rkt%2529._check-equal%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">check-equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell-name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">first</span><span class="hspace">&nbsp;</span><span class="RktSym">sourcery-load-results</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Summon Bees"</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=rackunit&amp;rel=api.html%23%2528def._%2528%2528lib._rackunit%252Fmain..rkt%2529._check-equal%7E3f%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">check-equal?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">spell-name</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">second</span><span class="hspace">&nbsp;</span><span class="RktSym">sourcery-load-results</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"Create Pig Tail On A Dursley"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><table cellspacing="0" cellpadding="0" class="prototype RForeground"><tr><td valign="top"><span class="RktPn">(</span><a name="(def._((lib._sql-sourcery/main..rkt)._run-sourcery-tests))"></a><span title="Provided from: sql-sourcery | Package: sql-sourcery"><span class="RktSym"><a href="#%28def._%28%28lib._sql-sourcery%2Fmain..rkt%29._run-sourcery-tests%29%29" class="RktValDef RktValLink" data-pltdoc="x">run-sourcery-tests</a></span></span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">test-db-path</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td></tr><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktVar">end-db-path</span><span class="RktPn">)</span></td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><span class="RktSym">void</span></td></tr></table></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">test-db-path</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">string?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">end-db-path</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">string?</span></td></tr></table></blockquote></div><div class="SIntrapara">Set the database using sourcery-db to the given test-db-path and run all of the sourcery-test-suites
defined before the call using
<a href="https://docs.racket-lang.org/rackunit/api.html?q=test-suite#%28def._%28%28lib.
_rackunit%2Ftext-ui..rkt%29._run-tests%29%29">run-tests</a>
, setting the database using sourcery-db to the given end-db-path after completion.</div></p><h3 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Programming_with_SQLSourcery&quot;">5<tt>&nbsp;</tt><a name="(part._.Programming_with_.S.Q.L.Sourcery)"></a>Programming with SQLSourcery</h3><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;SQLSourcery__Side_Effects__and_Mutation&quot;">5.1<tt>&nbsp;</tt><a name="(part._.S.Q.L.Sourcery__.Side_.Effects__and_.Mutation)"></a>SQLSourcery, Side Effects, and Mutation</h4><p>By nature, SQLSourcery is at odds with one of the often noted rules and advantages of functional
programming - that mutation and side effects should be avoided when possible.</p><p>However, this does not mean that programmers should be forced to change the way they write their
functional code, only that a few additional considerations must be made in order to get the advantages
of database backing. This section is dedicated to explaining how programmers can think about these
issues while still writing idiomatic code.</p><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;Under_The_Hood&quot;">5.2<tt>&nbsp;</tt><a name="(part._.Under_.The_.Hood)"></a>Under The Hood</h4><p>At its core, SQLSourcery simply translates all operations with structures into SQL queries. It then
introduces unique numeric idenifiers that are tied to each structure. Instances of structures are in
fact simply references to these identifiers. Programming with sourcery structures is thus working
with references, not values. While SQLSourcery allows for multiple references to the same value, it
is designed so that there is no need use the feature, and one can write fully functional code, which
then tracks its state with the connected database.</p><h4 x-source-module="(lib &quot;sql-sourcery/scribblings/sql-sourcery.scrbl&quot;)" x-source-pkg="sql-sourcery" x-part-tag="&quot;DEAD&quot;">5.3<tt>&nbsp;</tt><a name="(part._.D.E.A.D)"></a>Dead References</h4><p>Since sourcery structures at their core are references, and the values that a reference points to can
be modified or deleted, it is then possible to have an invalid or "dead" reference. When
sourcery-delete is used, any remaining references then become dead references. If a sourcerer chooses
to use multiple references to the same value, it is the responsibility of the sourcerer to keep track
of the status of references.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>