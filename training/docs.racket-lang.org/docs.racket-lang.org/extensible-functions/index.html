<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Extensible Functions</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Extensible Functions</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._overview%29" class="tocviewlink" data-pltdoc="x">Overview</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._installation%29" class="tocviewlink" data-pltdoc="x">Installation</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._usage%29" class="tocviewlink" data-pltdoc="x">Usage</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._changelog%29" class="tocviewlink" data-pltdoc="x">Changelog</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">Extensible Functions</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._overview%29" class="tocsubseclink" data-pltdoc="x">Overview</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._installation%29" class="tocsubseclink" data-pltdoc="x">Installation</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._usage%29" class="tocsubseclink" data-pltdoc="x">Usage</a></td></tr><tr><td><a href="#%28form._%28%28lib._extensible-functions%2Fmain..rkt%29._define%2Fmatch%2Fextensible%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktStxLink">define/<span class="mywbr"> &nbsp;</span>match/<span class="mywbr"> &nbsp;</span>extensible</span></span></a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._changelog%29" class="tocsubseclink" data-pltdoc="x">Changelog</a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._changelog%2F0..0..1%29" class="tocsubseclink" data-pltdoc="x">0.0.1 Â· 2017-<wbr></wbr>02-<wbr></wbr>07</a></td></tr><tr><td><span class="tocsublinknumber">4.1.1<tt>&nbsp;</tt></span><a href="#%28part._changelog%2F0..0..1%2Fadded%29" class="tocsubseclink" data-pltdoc="x">Added</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.4</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;extensible-functions/extensible-functions.scrbl&quot;)" x-source-pkg="extensible-functions" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._.Extensible_.Functions)"></a><a name="(mod-path._extensible-functions)"></a>Extensible Functions</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Leandro Facchinetti &lt;<a href="mailto:me@leafac.com">me@leafac.com</a>&gt;</p></span></div><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left" colspan="2"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">extensible-functions</span></a><span class="RktPn">)</span></td></tr><tr><td align="left">&nbsp;</td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/extensible-functions" title="Install this package using `raco pkg install extensible-functions`"><span class="stt">extensible-functions</span></a></span></td></tr></table></p><p><span style="font-style: italic">A solution to the expression problem in Typed Racket.</span></p><p><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td style="border-bottom: 1px solid black;"><p><span style="font-weight: bold">Version</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><a href="#%28part._changelog%2F0..0..1%29" data-pltdoc="x">0.0.1</a></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-weight: bold">Documentation</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><a href="https://docs.racket-lang.org/extensible-functions/">Racket Documentation</a></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-weight: bold">License</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><a href="https://gnu.org/licenses/gpl-3.0.txt">GNU General Public License Version 3</a></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-weight: bold">Code of Conduct</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><a href="https://contributor-covenant.org/version/1/4/">Contributor Covenant v1.4.0</a></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-weight: bold">Distribution</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><a href="https://pkgs.racket-lang.org/package/extensible-functions">Racket Package</a></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-weight: bold">Source</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><a href="https://github.com/leafac/extensible-functions">GitHub</a></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-weight: bold">Bug Reports</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><a href="https://github.com/leafac/extensible-functions/issues">GitHub Issues</a></p></td></tr><tr><td style="border-bottom: 1px solid black;"><p><span style="font-weight: bold">Contributions</span></p></td><td style="border-bottom: 1px solid black;"><p><span class="hspace">&nbsp;</span></p></td><td style="border-bottom: 1px solid black;"><p><a href="https://github.com/leafac/extensible-functions/pulls">GitHub Pull Requests</a></p></td></tr></table></p><h3 x-source-module="(lib &quot;extensible-functions/extensible-functions.scrbl&quot;)" x-source-pkg="extensible-functions" x-part-tag="&quot;overview&quot;">1<tt>&nbsp;</tt><a name="(part._overview)"></a>Overview</h3><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>It is surprising how little people talk about the expression problem, given how frequently it manifests in everyday programming.</p></blockquote></blockquote></blockquote><p>The <a href="http://eli.thegreenplace.net/2016/the-expression-problem-and-its-solutions/">expression problem</a> is a fundamental issue in programming. It is related to the tension between abstracting over data types and abstracting over functions. Most Racket programs follow the functional-programming paradigm&#8212;though Racket has support for object-oriented programming, generally only GUI-related code takes advantage of it. So, in most Racket programs the main form of abstraction is the function. However, when working with extensible data types, functions are limited. Consider the following example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Expression-Integer</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">integer</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Integer</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Addition</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">operand/left</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">operand/right</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">-----------------------------------------------------------</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">pretty-print/non-extensible</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="hspace">&nbsp;</span><span class="RktSym">String</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._define%252Fmatch%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define/match</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pretty-print/non-extensible</span><span class="hspace">&nbsp;</span><span class="RktSym">expression</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">Expression-Integer</span><span class="hspace">&nbsp;</span><span class="RktSym">integer</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528lib._racket%252Fformat..rkt%2529._%7E7ea%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">~a</a></span><span class="hspace">&nbsp;</span><span class="RktSym">integer</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">Addition</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/left</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/right</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528lib._racket%252Fformat..rkt%2529._%7E7ea%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">~a</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"("</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pretty-print/non-extensible</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/left</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"+"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pretty-print/non-extensible</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/right</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">")"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">-----------------------------------------------------------</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Subtraction</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">operand/left</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">operand/right</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._define%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pretty-print/non-extensible</span><span class="hspace">&nbsp;</span><span class="RktSym">expression</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">"Cannot extend &#8220;pretty-print/non-extensible&#8221; to work on &#8220;Subtraction&#8221;"</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The code above starts by defining structures for arithmetic expressions. Next, it defines a <span style="font-style: italic">pretty printer</span>. Then, the existing data types are extended with a new type of expression, subtraction. At this point, there is no natural way to extend the pretty printer to work over subtractions.</p><p>Let us explore two non-solutions. The first is to define a new function:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">pretty-print/extended</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="hspace">&nbsp;</span><span class="RktSym">String</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._define%252Fmatch%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define/match</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pretty-print/extended</span><span class="hspace">&nbsp;</span><span class="RktSym">expression</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">Subtraction</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/left</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/right</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528lib._racket%252Fformat..rkt%2529._%7E7ea%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">~a</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"("</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pretty-print/extended</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/left</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"-"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pretty-print/extended</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/right</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">")"</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=stx-patterns.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fstxcase-scheme..rkt%2529.__%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">_</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">pretty-print/non-extensible</span><span class="hspace">&nbsp;</span><span class="RktSym">expression</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote><p>The new function <span class="RktSym">pretty-printer/extended</span> handles the case of the data type extension (subtraction) and delegates to the original <span class="RktSym">pretty-print/non-extensible</span> for the other cases. This does not work: note that the pretty printer for addition recursively calls itself, but it always calls <span class="RktSym">pretty-printer/non-extensible</span> and not <span class="RktSym">pretty-printer/extended</span>. So the pretty printer would fail for an expression in which subtraction occurs in one operand of addition&#8212;for example, <span class="RktPn">(</span><span class="RktSym">Addition</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">Subtraction</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">Expression-Value</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">Expression-Value</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">Expression-Value</span><span class="stt"> </span><span class="RktVal">4</span><span class="RktPn">)</span><span class="RktPn">)</span>.</p><p>The second non-solution is to copy and paste the body of <span class="RktSym">pretty-print/non-extensible</span> into <span class="RktSym">pretty-print/extended</span>, replacing all recursive calls accordingly. There are many problems with this approach. The most outstanding is the repeated code and the burden to maintain it. Also, this non-solution would require changing all call-sites of the original function to the newly extended version. Finally, the extensions are not composable. For example, one module extending expressions with multiplication would need to be aware of extensions already in place (subtraction). This is not manageable if extension writers are different people, working on different modules in different packages.</p><p>We introduce a solution to the expression problem: extensible functions. With extensible functions, the pretty printer is a function open for extensions. Consider the following rewrite:</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Note the importance of <a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=ts-guide&amp;rel=occurrence-typing.html&amp;version=7.4" class="Sq" data-pltdoc="x">occurrence typing</a> for extensible functions to work in the type system.</p></blockquote></blockquote></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Expression-Integer</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">integer</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Integer</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Addition</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">operand/left</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">operand/right</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">-----------------------------------------------------------</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="#%28form._%28%28lib._extensible-functions%2Fmain..rkt%29._define%2Fmatch%2Fextensible%29%29" class="RktStxLink" data-pltdoc="x">define/match/extensible</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pretty-print.html%23%2528def._%2528%2528lib._racket%252Fpretty..rkt%2529._pretty-print%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">pretty-print</a></span><span class="hspace">&nbsp;</span><span class="RktSym">expression</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=function-contracts.html%23%2528form._%2528%2528lib._racket%252Fcontract%252Fbase..rkt%2529._-%7E3e%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x"><span class="nobreak">-&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="hspace">&nbsp;</span><span class="RktSym">String</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">Expression-Integer</span><span class="hspace">&nbsp;</span><span class="RktSym">integer</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528lib._racket%252Fformat..rkt%2529._%7E7ea%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">~a</a></span><span class="hspace">&nbsp;</span><span class="RktSym">integer</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">Addition</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/left</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/right</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528lib._racket%252Fformat..rkt%2529._%7E7ea%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">~a</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"("</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pretty-print.html%23%2528def._%2528%2528lib._racket%252Fpretty..rkt%2529._pretty-print%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">pretty-print</a></span><span class="hspace">&nbsp;</span><span class="RktSym">operand/left</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"+"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pretty-print.html%23%2528def._%2528%2528lib._racket%252Fpretty..rkt%2529._pretty-print%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">pretty-print</a></span><span class="hspace">&nbsp;</span><span class="RktSym">operand/right</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">")"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">-----------------------------------------------------------</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=define-struct.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._struct%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">struct</a></span><span class="hspace">&nbsp;</span><span class="RktSym">Subtraction</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">operand/left</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">operand/right</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">Expression</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:transparent</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">-----------------------------------------------------------</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">define/match/extension/pretty-print</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">Subtraction</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/left</span><span class="hspace">&nbsp;</span><span class="RktSym">operand/right</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=strings.html%23%2528def._%2528%2528lib._racket%252Fformat..rkt%2529._%7E7ea%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">~a</a></span><span class="hspace">&nbsp;</span><span class="RktVal">"("</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pretty-print.html%23%2528def._%2528%2528lib._racket%252Fpretty..rkt%2529._pretty-print%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">pretty-print</a></span><span class="hspace">&nbsp;</span><span class="RktSym">operand/left</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">"-"</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pretty-print.html%23%2528def._%2528%2528lib._racket%252Fpretty..rkt%2529._pretty-print%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">pretty-print</a></span><span class="hspace">&nbsp;</span><span class="RktSym">operand/right</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">")"</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></blockquote><p>In the code above, <span class="RktSym"><a href="#%28form._%28%28lib._extensible-functions%2Fmain..rkt%29._define%2Fmatch%2Fextensible%29%29" class="RktStxLink" data-pltdoc="x">define/match/extensible</a></span> defines <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pretty-print.html%23%2528def._%2528%2528lib._racket%252Fpretty..rkt%2529._pretty-print%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">pretty-print</a></span> for the existing expressions, but leaves the function open for extension. Later, when subtraction is defined, the pretty printer is extended with <span class="RktSym">define/match/extension/pretty-print</span>. At this point, <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=pretty-print.html%23%2528def._%2528%2528lib._racket%252Fpretty..rkt%2529._pretty-print%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">pretty-print</a></span> supports subtraction, even if occurs inside an addition.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Shadowing existing functions with an extension that matches the same data type&#8212;or a supertype thereof&#8212;is considered bad form as it obscures the meaning of the program.</p></blockquote></blockquote></blockquote><p><span style="font-style: italic">Caveat</span>: extensible functions work by mutating the original function&#8212;in other words, extending a function is a stateful operation. This means the order of <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span>s becomes meaningful to the program. Also, if two extensions match the same data type&#8212;or a supertype thereof&#8212;the second definition shadows the first.</p><h3 x-source-module="(lib &quot;extensible-functions/extensible-functions.scrbl&quot;)" x-source-pkg="extensible-functions" x-part-tag="&quot;installation&quot;">2<tt>&nbsp;</tt><a name="(part._installation)"></a>Installation</h3><p>Extensible Functions are a <a href="https://pkgs.racket-lang.org/package/extensible-functions">Racket package</a>. Install it in DrRacket or with the following command line:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ raco pkg install extensible-functions</span></p></td></tr></table></blockquote><h3 x-source-module="(lib &quot;extensible-functions/extensible-functions.scrbl&quot;)" x-source-pkg="extensible-functions" x-part-tag="&quot;usage&quot;">3<tt>&nbsp;</tt><a name="(part._usage)"></a>Usage</h3><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>syntax</p></div></div><table cellspacing="0" cellpadding="0" class="RktBlk RForeground"><tr><td><span class="RktPn">(</span><a name="(form._((lib._extensible-functions/main..rkt)._define/match/extensible))"></a><span title="Provided from: extensible-functions | Package: extensible-functions"><span class="RktSym"><a href="#%28form._%28%28lib._extensible-functions%2Fmain..rkt%29._define%2Fmatch%2Fextensible%29%29" class="RktStxDef RktStxLink" data-pltdoc="x">define/match/extensible</a></span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVar">function</span><span class="hspace">&nbsp;</span><span class="RktVar">argument</span><span class="hspace">&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktVar">type</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">match*-clause</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktMeta">...</span><span class="RktPn">)</span></td></tr></table></blockquote></td></tr></table></blockquote></div><div class="SIntrapara">Similar to <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=match.html%23%2528form._%2528%2528lib._racket%252Fmatch..rkt%2529._define%252Fmatch%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">define/match</a></span>, except that the generated function is <span style="font-style: italic">extensible</span>. Besides the <span class="RktVar">function</span>, <span class="RktSym"><a href="#%28form._%28%28lib._extensible-functions%2Fmain..rkt%29._define%2Fmatch%2Fextensible%29%29" class="RktStxLink" data-pltdoc="x">define/match/extensible</a></span> also introduces <span class="RktSym">define/match/extension/&lt;function&gt;</span>, which is a form that receives further <span class="RktVar">match*-clause</span>s and extends the original function. If the generated function is called with an argument it does not recognize, then it raises an <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=exns.html%23%2528def._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._exn%7E3afail%7E3acontract%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">exn:fail:contract</a></span>.</div></p><h3 x-source-module="(lib &quot;extensible-functions/extensible-functions.scrbl&quot;)" x-source-pkg="extensible-functions" x-part-tag="&quot;changelog&quot;">4<tt>&nbsp;</tt><a name="(part._changelog)"></a>Changelog</h3><p>This section documents all notable changes to Extensible Functions. It follows recommendations from <a href="http://keepachangelog.com/">Keep a CHANGELOG</a> and uses <a href="http://semver.org/">Semantic Versioning</a>. Each released version is a Git tag.</p><h4 x-source-module="(lib &quot;extensible-functions/extensible-functions.scrbl&quot;)" x-source-pkg="extensible-functions" x-part-tag="&quot;changelog/0.0.1&quot;">4.1<tt>&nbsp;</tt><a name="(part._changelog/0..0..1)"></a>0.0.1 &#183; 2017-02-07</h4><h5 x-source-module="(lib &quot;extensible-functions/extensible-functions.scrbl&quot;)" x-source-pkg="extensible-functions" x-part-tag="&quot;changelog/0.0.1/added&quot;">4.1.1<tt>&nbsp;</tt><a name="(part._changelog/0..0..1/added)"></a>Added</h5><ul><li><p>Basic functionality.</p></li></ul><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>