<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>MIC-1</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">MIC-<wbr></wbr>1</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.M.I.C-1_.Description%29" class="tocviewlink" data-pltdoc="x">MIC-<wbr></wbr>1 Description</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._mic1_simulator%29" class="tocviewlink" data-pltdoc="x"><span class="RktSym">mic1</span><span class="RktMeta"></span> simulator</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._mcc_microcode_compiler%29" class="tocviewlink" data-pltdoc="x"><span class="RktSym">mcc</span><span class="RktMeta"></span> microcode compiler</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._masm_macroassembler%29" class="tocviewlink" data-pltdoc="x"><span class="RktSym">masm</span><span class="RktMeta"></span> macroassembler</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._.H.D.L_-_.General_.Purpose_.Hardware_.Description_.Language%29" class="tocviewlink" data-pltdoc="x">HDL -<wbr></wbr> General Purpose Hardware Description Language</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">MIC-<wbr></wbr>1</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.M.I.C-1_.Description%29" class="tocsubseclink" data-pltdoc="x">MIC-<wbr></wbr>1 Description</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._mic1_simulator%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">mic1</span><span class="RktMeta"></span> simulator</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._mc-image%29" class="tocsubseclink" data-pltdoc="x">Microcode Image</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._mem-image%29" class="tocsubseclink" data-pltdoc="x">Memory Image</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._mcc_microcode_compiler%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">mcc</span><span class="RktMeta"></span> microcode compiler</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._mal%29" class="tocsubseclink" data-pltdoc="x">MAL microcode language</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._masm_macroassembler%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">masm</span><span class="RktMeta"></span> macroassembler</a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._mac-1%29" class="tocsubseclink" data-pltdoc="x">MAC-<wbr></wbr>1 macro-<wbr></wbr>assembly</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.H.D.L_-_.General_.Purpose_.Hardware_.Description_.Language%29" class="tocsubseclink" data-pltdoc="x">HDL -<wbr></wbr> General Purpose Hardware Description Language</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.4</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._.M.I.C-1)"></a>MIC-1</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Jay McCarthy</p></span></div><p>The <span class="RktSym">mic1</span><span class="RktMeta"></span> package provides tools for working with the
<a href="https://en.wikipedia.org/wiki/MIC-1">MIC-1 processor
architecture</a> that appears in Andrew S. Tanenbaum&rsquo;s textbook
<span style="font-style: italic">Structured Computer Organization</span>.</p><table cellspacing="0" cellpadding="0"><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.M.I.C-1_.Description%29" class="toptoclink" data-pltdoc="x">1<span class="hspace">&nbsp;</span>MIC-1 Description</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._mic1_simulator%29" class="toptoclink" data-pltdoc="x">2<span class="hspace">&nbsp;</span><span class="RktSym">mic1</span><span class="RktMeta"></span> simulator</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._mc-image%29" class="toclink" data-pltdoc="x">2.1<span class="hspace">&nbsp;</span>Microcode Image</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._mem-image%29" class="toclink" data-pltdoc="x">2.2<span class="hspace">&nbsp;</span>Memory Image</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._mcc_microcode_compiler%29" class="toptoclink" data-pltdoc="x">3<span class="hspace">&nbsp;</span><span class="RktSym">mcc</span><span class="RktMeta"></span> microcode compiler</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._mal%29" class="toclink" data-pltdoc="x">3.1<span class="hspace">&nbsp;</span>MAL microcode language</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._masm_macroassembler%29" class="toptoclink" data-pltdoc="x">4<span class="hspace">&nbsp;</span><span class="RktSym">masm</span><span class="RktMeta"></span> macroassembler</a></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._mac-1%29" class="toclink" data-pltdoc="x">4.1<span class="hspace">&nbsp;</span>MAC-1 macro-assembly</a></p></td></tr><tr><td><p><span class="hspace"></span></p></td></tr><tr><td><p><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><a href="#%28part._.H.D.L_-_.General_.Purpose_.Hardware_.Description_.Language%29" class="toptoclink" data-pltdoc="x">5<span class="hspace">&nbsp;</span>HDL - General Purpose Hardware Description Language</a></p></td></tr></table><h3 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;MIC-1_Description&quot;">1<tt>&nbsp;</tt><a name="(part._.M.I.C-1_.Description)"></a>MIC-1 Description</h3><p>The MIC-1 is a CPU with 16 general purpose 16-bit registers. Registers
5, 6, 7, 8, and 9 have default values <span class="RktInBG"><span class="hspace"></span><span class="RktIn">0000000000000000</span><span class="hspace"></span></span>,
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">0000000000000001</span><span class="hspace"></span></span>, <span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111111111111111</span><span class="hspace"></span></span>,
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">0000111111111111</span><span class="hspace"></span></span>, and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">0000000011111111</span><span class="hspace"></span></span>
respectively.</p><p>It runs a single 256-instruction microprogram embedded in a control
store ROM. Its ALU supports addition, bitwise AND, and bitwise
negation. The ALU outputs flags for whether its result was negative or
zero. The ALU is connected to a 1-bit shifter that can shift left,
right, or not at all.</p><p>Its memory interface is two flags (one for reading, one for writing)
as well as two 16-bit registers for interfacing with memory (the
MAR&ndash;Memory Address Register&ndash;and MBR&ndash;Memory Buffer Register.) The
top 4 bits of the MAR is ignored, so the MIC-1 has a 12-bit address
space. Memory access is delayed by one cycle, during which the
appropriate flag must be asserted. If both flags are asserted, then
the external controller halts the machine.</p><p>The ALU&rsquo;s A side is either a register or the MBR. The shifter result
may be output to the MBR or any register. The MAR may be written from
the ALU&rsquo;s B side.</p><p>The top four words of memory (<span class="RktInBG"><span class="hspace"></span><span class="RktIn">4092</span><span class="hspace"></span></span>-<span class="RktInBG"><span class="hspace"></span><span class="RktIn">4095</span><span class="hspace"></span></span>) are wired
to a UART. The first two connect to the receiver and the second two
connect to the transmitter. The first of each holds an 8-bit character
to be outputed in the bottom 8 bits. The second of each holds a 4 bit
control flag in its lowest bits. The control bits are (from most to
least significant): On, Interrupt, Done, Busy. The control bits are
initialized to all zero. If the microprogram sets the On bit, then the
component is enabled and stabilizes. The receiver stabilizes to not
Done and Busy, while the transmitter stabilizes to Done and not
Busy. When the receiver receives a character, it switches to Done and
not Busy until the character is read by the CPU. When the program
writes a character to the transmit buffer while the transmitter is On,
then the transmitter switches to not Done and Busy, until the
transmission is finished. The Interrupt flag is currently ignored by
both components.</p><h3 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;mic1_simulator&quot;">2<tt>&nbsp;</tt><a name="(part._mic1_simulator)"></a><a name="(idx._(gentag._0._(lib._mic1/mic1..scrbl)))"></a><span class="RktSym">mic1</span><span class="RktMeta"></span> simulator</h3><p><span class="stt">raco mic1 </span><span class="sroman">&#8249;<span style="font-style: italic">option</span>&#8250;</span><span class="stt"> ... </span><span class="sroman">&#8249;<span style="font-style: italic">microcode-path</span>&#8250;</span><span class="stt">
</span><span class="sroman">&#8249;<span style="font-style: italic">memory-image-path</span>&#8250;</span> simulates the execution of the MIC-1.</p><p><span class="sroman">&#8249;<span style="font-style: italic">microcode-path</span>&#8250;</span> must be a path to a file. If the extension is
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">.prom</span><span class="hspace"></span></span>, then it must be in the <a href="#%28part._mc-image%29" data-pltdoc="x">Microcode Image</a> format. If
the extension is <span class="RktInBG"><span class="hspace"></span><span class="RktIn">.mc</span><span class="hspace"></span></span>, then it must be in the <a href="#%28part._mal%29" data-pltdoc="x">MAL microcode language</a>
format and it will be compiled before loading.</p><p><span class="sroman">&#8249;<span style="font-style: italic">memory-image-path</span>&#8250;</span> must be a path to a file. If the extension
is <span class="RktInBG"><span class="hspace"></span><span class="RktIn">.o</span><span class="hspace"></span></span>, then it must be in the <a href="#%28part._mem-image%29" data-pltdoc="x">Memory Image</a>
format. If the extension is <span class="RktInBG"><span class="hspace"></span><span class="RktIn">.s</span><span class="hspace"></span></span>, then it must be in the
<a href="#%28part._mac-1%29" data-pltdoc="x">MAC-1 macro-assembly</a> format and it will be compiled before loading.</p><p>It accepts the following <span class="sroman">&#8249;<span style="font-style: italic">option</span>&#8250;</span>s:</p><ul><li><p><span class="nobreak"><span class="stt">--ll</span></span> &#8212;<wbr></wbr> simulates at the NAND gate level via compilation to a
C program using <span class="stt">cc</span>.</p></li><li><p><span class="nobreak"><span class="stt">--lli</span></span> &#8212;<wbr></wbr> simulates at the NAND gate level via an
interpreter.</p></li><li><p><span class="nobreak"><span class="stt">--hl</span></span> &#8212;<wbr></wbr> simulates at a high-level (default)</p></li><li><p><span class="nobreak"><span class="stt">--pc</span></span> <span class="sroman">&#8249;<span style="font-style: italic">pc-str</span>&#8250;</span> &#8212;<wbr></wbr> specifies the initial value of
the register 0, the Program Counter (default: 0)</p></li><li><p><span class="nobreak"><span class="stt">--sp</span></span> <span class="sroman">&#8249;<span style="font-style: italic">sp-str</span>&#8250;</span> &#8212;<wbr></wbr> specifies the initial value of
the register 2, the Stack Pointer (default: 1024)</p></li></ul><h4 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;mc-image&quot;">2.1<tt>&nbsp;</tt><a name="(part._mc-image)"></a>Microcode Image</h4><p>A microcode image matches the grammar <span class="sroman">&#8249;<span style="font-style: italic">PROM</span>&#8250;</span>.</p><p><table cellspacing="0" cellpadding="0"><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">PROM</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Line</span>&#8250;</span><span class="hspace">&nbsp;</span> ...</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Line</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Entry</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">\n</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Entry</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">MIR</span>&#8250;</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">#</span><span class="hspace"></span></span> any sequence of character except <span class="RktInBG"><span class="hspace"></span><span class="RktIn">\n</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">MIR</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">AMUX</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">COND</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">ALU</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">SH</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">MBR</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">MAR</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">RD</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">WR</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">ENC</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">C</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">B</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">A</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">ADDR</span>&#8250;</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">AMUX</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span> &#8212;<wbr></wbr> ALU A side holds A register</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1</span><span class="hspace"></span></span> &#8212;<wbr></wbr> ALU A side holds MBR</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">COND</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">00</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Never jump</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">01</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Jump on negative ALU output</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">10</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Jump on zero ALU output</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">11</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Always jump</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">ALU</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">00</span><span class="hspace"></span></span> &#8212;<wbr></wbr> A + B</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">01</span><span class="hspace"></span></span> &#8212;<wbr></wbr> A &amp; B</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">10</span><span class="hspace"></span></span> &#8212;<wbr></wbr> A</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">11</span><span class="hspace"></span></span> &#8212;<wbr></wbr> ! A</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">SH</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">00</span><span class="hspace"></span></span> &#8212;<wbr></wbr> No shift</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">01</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Right shift</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">10</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Left shift</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">MBR</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Leave MBR unchanged</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Write shifter output to MBR</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">MAR</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Leave MAR unchanged</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Write ALU B side to MAR</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">RD</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Do not enable memory read</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Read from memory</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">WR</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Do not enable memory write</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Write to memory</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">ENC</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Do not save shifter output</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Write shifter output to <span class="sroman">&#8249;<span style="font-style: italic">C</span>&#8250;</span> register</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">C</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>4-bit register label</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">B</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>4-bit register label</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">A</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>4-bit register label</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">ADDR</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>8-bit microaddress</p></td></tr></table></p><p>In addition, a microcode image may only contain up to 256
<span class="sroman">&#8249;<span style="font-style: italic">mir</span>&#8250;</span> lines.</p><h4 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;mem-image&quot;">2.2<tt>&nbsp;</tt><a name="(part._mem-image)"></a>Memory Image</h4><p>A memory image matches the grammar <span class="sroman">&#8249;<span style="font-style: italic">Image</span>&#8250;</span>.</p><p><table cellspacing="0" cellpadding="0"><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Image</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Line</span>&#8250;</span><span class="hspace">&nbsp;</span> ...</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Line</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Entry</span>&#8250;</span><span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">\n</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Entry</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Value</span>&#8250;</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">#</span><span class="hspace"></span></span> any sequence of character except <span class="RktInBG"><span class="hspace"></span><span class="RktIn">\n</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Value</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p>16-bit value written using the characters <span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span> and <span class="RktInBG"><span class="hspace"></span><span class="RktIn">1</span><span class="hspace"></span></span></p></td></tr></table></p><p>In addition, a memory image may only contain up to 4096
<span class="sroman">&#8249;<span style="font-style: italic">value</span>&#8250;</span> lines.</p><h3 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;mcc_microcode_compiler&quot;">3<tt>&nbsp;</tt><a name="(part._mcc_microcode_compiler)"></a><a name="(idx._(gentag._1._(lib._mic1/mic1..scrbl)))"></a><span class="RktSym">mcc</span><span class="RktMeta"></span> microcode compiler</h3><p><span class="stt">raco mcc </span><span class="sroman">&#8249;<span style="font-style: italic">microcode-path</span>&#8250;</span> compiles <a href="#%28part._mal%29" data-pltdoc="x">MAL microcode language</a> into
the <a href="#%28part._mc-image%29" data-pltdoc="x">Microcode Image</a> format.</p><p><span class="sroman">&#8249;<span style="font-style: italic">microcode-path</span>&#8250;</span> must be a path to a file in the
<a href="#%28part._mal%29" data-pltdoc="x">MAL microcode language</a> format. <span class="stt">raco mcc</span> replaces the extension of this
path with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">.prom</span><span class="hspace"></span></span> and writes the corresponding
<a href="#%28part._mc-image%29" data-pltdoc="x">Microcode Image</a>.</p><h4 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;mal&quot;">3.1<tt>&nbsp;</tt><a name="(part._mal)"></a>MAL microcode language</h4><p>While it is possible to directly write in the <a href="#%28part._mc-image%29" data-pltdoc="x">Microcode Image</a>
format, it is extremely error-prone and tedious. MAL provides a
convenient way to write microprograms.</p><p>MAL supports block comments in between <span class="RktInBG"><span class="hspace"></span><span class="RktIn">{</span><span class="hspace"></span></span> and
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">}</span><span class="hspace"></span></span>. Labels are sequences of any characters except
<span class="RktInBG"><span class="hspace">&nbsp;&nbsp;</span><span class="RktIn">(,:;)</span><span class="hspace"></span></span>.</p><p>A MAL program matches the following grammar <span class="sroman">&#8249;<span style="font-style: italic">Program</span>&#8250;</span>:</p><p><table cellspacing="0" cellpadding="0"><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Program</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">\n</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">Program</span>&#8250;</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Instruction</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">\n</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">Program</span>&#8250;</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Instruction</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Component</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">;</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">Instruction</span>&#8250;</span></p></td></tr></table></p><p><span class="sroman">&#8249;<span style="font-style: italic">Instruction</span>&#8250;</span>s are composed of multiple
<span class="sroman">&#8249;<span style="font-style: italic">Component</span>&#8250;</span>s. Each <span class="sroman">&#8249;<span style="font-style: italic">Component</span>&#8250;</span> determines some fields
of the <a href="#%28part._mc-image%29" data-pltdoc="x">Microcode Image</a>. If two <span class="sroman">&#8249;<span style="font-style: italic">Component</span>&#8250;</span>s assign the
same field differently, then a compilation error is raised. The
following grammar specifies the various <span class="sroman">&#8249;<span style="font-style: italic">Component</span>&#8250;</span>s:</p><p><table cellspacing="0" cellpadding="0"><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Component</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">mar</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">:=</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">BExpr</span>&#8250;</span>&#8212;<wbr></wbr> Writes the ALU B side to MAR</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Register</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">:=</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">ShExpr</span>&#8250;</span>&#8212;<wbr></wbr> Writes the shifter output to given register</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">mbr</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">:=</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">ShExpr</span>&#8250;</span>&#8212;<wbr></wbr> Writes the shifter output to MBR</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">alu</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">:=</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">AluExpr</span>&#8250;</span>&#8212;<wbr></wbr> Sets the ALU output</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">if</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">Cond</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">then</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">goto</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">Label</span>&#8250;</span>&#8212;<wbr></wbr> Sets the COND flag and the ADDR value</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">goto</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">Label</span>&#8250;</span>&#8212;<wbr></wbr> Sets the COND flag to <span class="RktInBG"><span class="hspace"></span><span class="RktIn">11</span><span class="hspace"></span></span> and the ADDR value</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">rd</span><span class="hspace"></span></span>&#8212;<wbr></wbr> Sets the RD flag</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">wr</span><span class="hspace"></span></span>&#8212;<wbr></wbr> Sets the WR flag</p></td></tr></table></p><p>The remaining nonterminals are specified by the following grammar:</p><p><table cellspacing="0" cellpadding="0"><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Cond</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">n</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Jump on negative ALU output</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">z</span><span class="hspace"></span></span> &#8212;<wbr></wbr> Jump on zero ALU output</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">ShExpr</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">AluExpr</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span>&#8212;<wbr></wbr> Do not shift</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">lshift(</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">AluExpr</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">)</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span>&#8212;<wbr></wbr> Left shift</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">rshift(</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">AluExpr</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">)</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span>&#8212;<wbr></wbr> Right shift</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">AluExpr</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">AExpr</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">+</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">BExpr</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span>&#8212;<wbr></wbr> Addition</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">band(</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">AExpr</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">,</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">BExpr</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">)</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span>&#8212;<wbr></wbr> Bitwise And</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">AExpr</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span>&#8212;<wbr></wbr> Identity</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">inv(</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="sroman">&#8249;<span style="font-style: italic">AExpr</span>&#8250;</span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span><span class="RktInBG"><span class="hspace"></span><span class="RktIn">)</span><span class="hspace"></span></span><span class="hspace">&nbsp;</span> <span class="hspace">&nbsp;</span>&#8212;<wbr></wbr> Bitwise Negation</p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">AExpr</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Register</span>&#8250;</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">mbr</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">BExpr</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Register</span>&#8250;</span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p><span class="sroman">&#8249;<span style="font-style: italic">Register</span>&#8250;</span></p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span>::=<span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">pc</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">ac</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">sp</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">sp</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">ir</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">tir</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">(-1)</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">amask</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">smask</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">a</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">b</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">c</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">d</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">e</span><span class="hspace"></span></span></p></td></tr><tr><td valign="baseline"><p><span class="hspace">&nbsp;</span></p></td><td valign="baseline"><p> </p></td><td valign="baseline"><p><span class="stt"><span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span>|<span class="hspace">&nbsp;</span><span class="hspace">&nbsp;</span></span></p></td><td valign="baseline"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">f</span><span class="hspace"></span></span></p></td></tr></table></p><p>If a MAL program produces an image greater than 256 instructions, then
no error is raised during compilation.</p><p>For examples see the
<a href="https://github.com/jeapostrophe/mic1/tree/master/examples">Github
repository</a>, specifically: <span class="stt">fib.mc</span> implements Fibonacci and
<span class="stt">macro-v1.mc</span> implements an interpreter for compiled
<a href="#%28part._mac-1%29" data-pltdoc="x">MAC-1 macro-assembly</a>.</p><h3 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;masm_macroassembler&quot;">4<tt>&nbsp;</tt><a name="(part._masm_macroassembler)"></a><a name="(idx._(gentag._2._(lib._mic1/mic1..scrbl)))"></a><span class="RktSym">masm</span><span class="RktMeta"></span> macroassembler</h3><p><span class="stt">raco masm </span><span class="sroman">&#8249;<span style="font-style: italic">asm-path</span>&#8250;</span> compiles <a href="#%28part._mac-1%29" data-pltdoc="x">MAC-1 macro-assembly</a>
into the <a href="#%28part._mem-image%29" data-pltdoc="x">Memory Image</a> format.</p><p><span class="sroman">&#8249;<span style="font-style: italic">asm-path</span>&#8250;</span> must be a path to a file in the <a href="#%28part._mac-1%29" data-pltdoc="x">MAC-1 macro-assembly</a>
format. <span class="stt">raco masm</span> replaces the extension of this path with
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">.o</span><span class="hspace"></span></span> and writes the corresponding <a href="#%28part._mem-image%29" data-pltdoc="x">Memory Image</a>.</p><h4 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;mac-1&quot;">4.1<tt>&nbsp;</tt><a name="(part._mac-1)"></a>MAC-1 macro-assembly</h4><p>The MAC-1 is a low-level virtual machine implemented by a MIC-1
microprogram. It exposes a single register (AC) to programmers and has
an internal state defined by two other registers (PC and SP).</p><p>The assembly language supports line comments starting with the
<span class="RktInBG"><span class="hspace"></span><span class="RktIn">;</span><span class="hspace"></span></span> character. Whitespace is never significant. Literal
integers are supported in decimal format. Literal strings compile to
packed 16-bit words with early characters in least significant bits.</p><p>Labels are any alphanumeric character sequence starting with an
alphabetic character and ending in <span class="RktInBG"><span class="hspace"></span><span class="RktIn">:</span><span class="hspace"></span></span>. A label definition is
a label not in an argument position or immediately after a label
definition.</p><p>The character sequence <span class="RktInBG"><span class="hspace"></span><span class="RktIn">.LOC</span><span class="hspace"></span></span> followed by a literal
nonnegative integer skips the given amount of space in the resulting
image, filling it with <span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111111111111111</span><span class="hspace"></span></span>.</p><p>The following instructions are recognized:</p><p><table cellspacing="0" cellpadding="0" class="boxed" style="border-collapse: collapse;"><tr><td align="left" style="border-bottom: 1px solid black;"><p>Mnemonic</p></td><td align="center" style="border-bottom: 1px solid black;"><p>Encoding</p></td><td align="center" style="border-bottom: 1px solid black;"><p>Instruction</p></td><td align="right" style="border-bottom: 1px solid black;"><p>Semantics</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">LODD</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0000xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Load Direct</p></td><td align="right"><p>AC := Mem[X]</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">STOD</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0001xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Store Direct</p></td><td align="right"><p>Mem[X] := AC</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">ADDD</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0010xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Add Direct</p></td><td align="right"><p>AC := AC + Mem[X]</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">SUBD</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0011xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Subtract Direct</p></td><td align="right"><p>AC := AC - Mem[X]</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">JPOS</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0100xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Jump on non-negative</p></td><td align="right"><p>If AC &#8805; 0, PC := X</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">JZER</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0101xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Jump on zero</p></td><td align="right"><p>If AC = 0, PC := X</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">JUMP</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0110xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Jump</p></td><td align="right"><p>PC := X</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">LOCO</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">0111xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Load Constant</p></td><td align="right"><p>AC := X</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">LODL</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1000xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Load Local</p></td><td align="right"><p>AC := Mem[SP + X]</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">STOL</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1001xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Store Local</p></td><td align="right"><p>Mem[SP + X] := AC</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">ADDL</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1010xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Add Local</p></td><td align="right"><p>AC := AC + Mem[SP + X]</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">SUBL</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1011xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Subtract Local</p></td><td align="right"><p>AC := AC - Mem[SP + X]</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">JNEG</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1100xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Jump on negative</p></td><td align="right"><p>If AC &lt; 0, PC := X</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">JNZE</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1101xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Jump unless zero</p></td><td align="right"><p>If AC &#8800; 0, PC := X</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">CALL</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1110xxxxxxxxxxxx</span><span class="hspace"></span></span></p></td><td align="center"><p>Call</p></td><td align="right"><p>SP := SP - 1; Mem[SP] := PC; PC := X</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">PSHI</span><span class="hspace"></span></span> </p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111000000000000</span><span class="hspace"></span></span></p></td><td align="center"><p>Push Indirect</p></td><td align="right"><p>SP := SP - 1; Mem[SP] := Mem[AC]</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">POPI</span><span class="hspace"></span></span> </p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111001000000000</span><span class="hspace"></span></span></p></td><td align="center"><p>Pop Indirect</p></td><td align="right"><p>Mem[AC] := Mem[SP]; SP := SP + 1</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">PUSH</span><span class="hspace"></span></span> </p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111010000000000</span><span class="hspace"></span></span></p></td><td align="center"><p>Push</p></td><td align="right"><p>SP := SP - 1; Mem[SP] := AC</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">POP</span><span class="hspace"></span></span> </p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111011000000000</span><span class="hspace"></span></span></p></td><td align="center"><p>Pop</p></td><td align="right"><p>AC := Mem[SP]; SP := SP + 1</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">RETN</span><span class="hspace"></span></span> </p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111100000000000</span><span class="hspace"></span></span></p></td><td align="center"><p>Return</p></td><td align="right"><p>PC := Mem[SP]; SP := SP + 1</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">SWAP</span><span class="hspace"></span></span> </p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111101000000000</span><span class="hspace"></span></span></p></td><td align="center"><p>Swap AC &amp; SP</p></td><td align="right"><p>AC :=: SP</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">INSP</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">11111100yyyyyyyy</span><span class="hspace"></span></span></p></td><td align="center"><p>Increment SP</p></td><td align="right"><p>SP := SP + Y</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">DESP</span><span class="hspace"></span></span> <span class="sroman">&#8249;<span style="font-style: italic">Arg</span>&#8250;</span></p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">11111110yyyyyyyy</span><span class="hspace"></span></span></p></td><td align="center"><p>Decrement SP</p></td><td align="right"><p>SP := SP - Y</p></td></tr><tr><td align="left"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">HALT</span><span class="hspace"></span></span> </p></td><td align="center"><p><span class="RktInBG"><span class="hspace"></span><span class="RktIn">1111111100000000</span><span class="hspace"></span></span></p></td><td align="center"><p>Halt</p></td><td align="right"><p>Halt processor</p></td></tr></table></p><p>If a MAC-1 program produces an image greater than 4096 instructions,
then no error is raised during compilation.</p><p>For examples see the
<a href="https://github.com/jeapostrophe/mic1/tree/master/examples">Github
repository</a>, specifically: <span class="stt">fib.s</span> implements Fibonacci and
<span class="stt">IO_str_and_echo.s</span> implements an echo program.</p><h3 x-source-module="(lib &quot;mic1/mic1.scrbl&quot;)" x-source-pkg="mic1" x-part-tag="&quot;HDL_-_General_Purpose_Hardware_Description_Language&quot;">5<tt>&nbsp;</tt><a name="(part._.H.D.L_-_.General_.Purpose_.Hardware_.Description_.Language)"></a><a name="(mod-path._mic1/hdl)"></a>HDL - General Purpose Hardware Description Language</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="#%28mod-path._mic1%2Fhdl%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">mic1/hdl</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/mic1" title="Install this package using `raco pkg install mic1`"><span class="stt">mic1</span></a></span></td></tr></table></p><p>The implementation contains a general purpose hardware description
language that compiles circuits to networks of NAND gates. The network
can be simulated in Racket or via C compilation. In the future it may
be documented.</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>