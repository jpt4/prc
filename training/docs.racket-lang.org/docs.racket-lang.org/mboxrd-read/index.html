<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>mboxrd-read</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">mboxrd-<wbr></wbr>read</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._mboxcl2%29" class="tocviewlink" data-pltdoc="x">mboxcl2</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">mboxrd-<wbr></wbr>read</a></td></tr><tr><td><a href="#%28def._%28%28lib._mboxrd-read%2Fmain..rkt%29._mboxrd-parse%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mboxrd-<wbr></wbr>parse</span></span></a></td></tr><tr><td><a href="#%28def._%28%28lib._mboxrd-read%2Fmain..rkt%29._mboxrd-parse%2Fport%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mboxrd-<wbr></wbr>parse/<span class="mywbr"> &nbsp;</span>port</span></span></a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._mboxcl2%29" class="tocsubseclink" data-pltdoc="x">mboxcl2</a></td></tr><tr><td><a href="#%28def._%28%28lib._mboxrd-read%2Fmain..rkt%29._mboxcl2-parse%29%29" class="tocsubnonseclink" data-pltdoc="x"><span class="RktSym"><span class="RktValLink">mboxcl2-<wbr></wbr>parse</span></span></a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.4</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;mboxrd-read/mboxrd-read.scrbl&quot;)" x-source-pkg="mboxrd-read" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._mboxrd-read)"></a><a name="(mod-path._mboxrd-read)"></a>mboxrd-read</h2><p><div class="SIntrapara"><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=reference&amp;rel=require.html%23%2528form._%2528%2528lib._racket%252Fprivate%252Fbase..rkt%2529._require%2529%2529&amp;version=7.4" class="RktStxLink Sq" data-pltdoc="x">require</a></span><span class="stt"> </span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">mboxrd-read</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/mboxrd-read" title="Install this package using `raco pkg install mboxrd-read`"><span class="stt">mboxrd-read</span></a></span></td></tr></table></div><div class="SIntrapara">This package parses <a name="(tech._mboxrd)"></a><span style="font-style: italic">mboxrd</span> and <a name="(tech._mboxcl2)"></a><span style="font-style: italic">mboxcl2</span> files,
also known as "normal UNIX mbox files", into lazy lists of messages.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._mboxrd-read/main..rkt)._mboxrd-parse))"></a><span title="Provided from: mboxrd-read | Package: mboxrd-read"><span class="RktSym"><a href="#%28def._%28%28lib._mboxrd-read%2Fmain..rkt%29._mboxrd-parse%29%29" class="RktValDef RktValLink" data-pltdoc="x">mboxrd-parse</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">path</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">stream/c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list/c</span><span class="hspace">&nbsp;</span><span class="RktSym">bytes?</span><span class="hspace">&nbsp;</span><span class="RktSym">bytes?</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">path</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">path?</span></td></tr></table></blockquote></div><div class="SIntrapara">given a path to an mbox file, return a stream of the messages in the
file.  Each file is represented as a list containing a byte-string
representing the header and a byte-string representing
the body.  These byte-strings can be appended to obtain the original
message except that every \n in the original is replaced by \r\n to
match the RFC 2822 format.</div></p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._mboxrd-read/main..rkt)._mboxrd-parse/port))"></a><span title="Provided from: mboxrd-read | Package: mboxrd-read"><span class="RktSym"><a href="#%28def._%28%28lib._mboxrd-read%2Fmain..rkt%29._mboxrd-parse%2Fport%29%29" class="RktValDef RktValLink" data-pltdoc="x">mboxrd-parse/port</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">port</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span>&rarr;<span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">stream/c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list/c</span><span class="hspace">&nbsp;</span><span class="RktSym">bytes?</span><span class="hspace">&nbsp;</span><span class="RktSym">bytes?</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">port</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">input-port?</span></td></tr></table></blockquote></div><div class="SIntrapara">given an input port, return a lazy list of the messages in the port.</div></p><p>NB: this procedure assumes that it&rsquo;s the only one reading the port. Bad
stuff will happen if its not; it doesn&rsquo;t leave the <span class="RktVal">"From "</span> of the next
message on the stream.</p><p>EFFECT: reads from stream, closes it when peek-char returns <span class="RktSym">eof</span></p><h3 x-source-module="(lib &quot;mboxrd-read/mboxrd-read.scrbl&quot;)" x-source-pkg="mboxrd-read" x-part-tag="&quot;mboxcl2&quot;">1<tt>&nbsp;</tt><a name="(part._mboxcl2)"></a>mboxcl2</h3><p>Well, it turns out that dovecot actually uses mboxcl2. Ah well. In fact,
mboxcl2 looks like a bit of a win; since it uses Content-Length to locate the
next header, it should be possible to parse faster, since you can set the file
position rather than scanning those hideously long base64 body strings looking
for the next line starting with <span class="RktVal">"From "</span>. The down side is that since
the body strings aren&rsquo;t read eagerly, closing the file port is a separate operation
that you&rsquo;re responsible for.</p><p><div class="SIntrapara"><blockquote class="SVInsetFlow"><table cellspacing="0" cellpadding="0" class="boxed RBoxed"><tr><td><blockquote class="SubFlow"><div class="RBackgroundLabel SIEHidden"><div class="RBackgroundLabelInner"><p>procedure</p></div></div><p class="RForeground"><span class="RktPn">(</span><a name="(def._((lib._mboxrd-read/main..rkt)._mboxcl2-parse))"></a><span title="Provided from: mboxrd-read | Package: mboxrd-read"><span class="RktSym"><a href="#%28def._%28%28lib._mboxrd-read%2Fmain..rkt%29._mboxcl2-parse%29%29" class="RktValDef RktValLink" data-pltdoc="x">mboxcl2-parse</a></span></span><span class="hspace">&nbsp;</span><span class="RktVar">path</span><span class="hspace">&nbsp;</span>[<span class="RktPn">#:fallback</span><span class="hspace">&nbsp;</span><span class="RktVar">fallback?</span>]<span class="RktPn">)</span></p></blockquote></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="prototype"><tr><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top">&rarr;</td><td valign="top"><span class="hspace">&nbsp;</span></td><td valign="top"><table cellspacing="0" cellpadding="0"><tr><td><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">void?</span><span class="RktPn">)</span></td></tr><tr><td><span class="RktPn">(</span><span class="RktSym">stream/c</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list/c</span><span class="hspace">&nbsp;</span><span class="RktSym">bytes?</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">bytes?</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">path</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">path-string?</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVar">fallback?</span><span class="hspace">&nbsp;</span>:<span class="hspace">&nbsp;</span><span class="RktSym">boolean?</span><span class="hspace">&nbsp;</span>=<span class="hspace">&nbsp;</span><span class="RktVal">#f</span></td></tr></table></blockquote></div><div class="SIntrapara">given an input port, returns a <span class="RktSym">closer</span> function that closes the input port
associated with the file, and a list of lists containing a header byte-string and a
thunk that returns the body bytes.</div></p><p>When <span class="RktVar">fallback?</span> is true, a message whose header lacks a Content-Length
field will instead be processed by searching forward for a line beginning with
<span class="RktVal">"From "</span>.</p><p>Please note that the header gets rfc822-style newlines, but the body does not.</p><p>Note that after the <span class="RktSym">closer</span> function is called, it&rsquo;s not possible to
extend the lazy list or to extract bodies.</p><p>Additionally, you can use the utilities (e.g. <span class="RktSym"><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=net&amp;rel=head.html%23%2528def._%2528%2528lib._net%252Fhead..rkt%2529._extract-field%2529%2529&amp;version=7.4" class="RktValLink Sq" data-pltdoc="x">extract-field</a></span>) in
"net/head.ss" to process the header.</p><p>Let me know of any bugs.</p><p>John Clements</p><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>