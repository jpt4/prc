<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>Riposte—Scripting Language for JSON-based HTTP APIs</title><link rel="stylesheet" type="text/css" href="../scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="../racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../manual-racket.css" title="default"/><link rel="stylesheet" type="text/css" href="../doc-site.css" title="default"/><script type="text/javascript" src="../scribble-common.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../manual-racket.js"></script><script type="text/javascript" src="../doc-site.js"></script><script type="text/javascript" src="../local-redirect/local-redirect.js"></script><script type="text/javascript" src="../local-redirect/local-user-redirect.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="doc-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="" class="tocviewselflink" data-pltdoc="x">Riposte—Scripting Language for JSON-<wbr></wbr>based HTTP APIs</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="#%28part._.Brief_introduction%29" class="tocviewlink" data-pltdoc="x">Brief introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="#%28part._.Installation%29" class="tocviewlink" data-pltdoc="x">Installation</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="#%28part._.Where_.Riposte_came_from%29" class="tocviewlink" data-pltdoc="x">Where Riposte came from</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="#%28part._.Usage%29" class="tocviewlink" data-pltdoc="x">Usage</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="#%28part._.Language%29" class="tocviewlink" data-pltdoc="x">Language</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="#%28part._.Limitations%29" class="tocviewlink" data-pltdoc="x">Limitations</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="#%28part._.Miscellanea%29" class="tocviewlink" data-pltdoc="x">Miscellanea</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="#%28part._.Wishlist%29" class="tocviewlink" data-pltdoc="x">Wishlist</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._top%29" class="tocsubseclink" data-pltdoc="x">Riposte—Scripting Language for JSON-<wbr></wbr>based HTTP APIs</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Brief_introduction%29" class="tocsubseclink" data-pltdoc="x">Brief introduction</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Installation%29" class="tocsubseclink" data-pltdoc="x">Installation</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.Where_.Riposte_came_from%29" class="tocsubseclink" data-pltdoc="x">Where Riposte came from</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Usage%29" class="tocsubseclink" data-pltdoc="x">Usage</a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Using_the_interpreter%29" class="tocsubseclink" data-pltdoc="x">Using the interpreter</a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.Direct_execution%29" class="tocsubseclink" data-pltdoc="x">Direct execution</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.Language%29" class="tocsubseclink" data-pltdoc="x">Language</a></td></tr><tr><td><span class="tocsublinknumber">5.1<tt>&nbsp;</tt></span><a href="#%28part._.Imports%29" class="tocsubseclink" data-pltdoc="x">Imports</a></td></tr><tr><td><span class="tocsublinknumber">5.2<tt>&nbsp;</tt></span><a href="#%28part._.Assignments%29" class="tocsubseclink" data-pltdoc="x">Assignments</a></td></tr><tr><td><span class="tocsublinknumber">5.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Variable_assignments%29" class="tocsubseclink" data-pltdoc="x">Variable assignments</a></td></tr><tr><td><span class="tocsublinknumber">5.2.2<tt>&nbsp;</tt></span><a href="#%28part._.Header_assignments%29" class="tocsubseclink" data-pltdoc="x">Header assignments</a></td></tr><tr><td><span class="tocsublinknumber">5.2.2.1<tt>&nbsp;</tt></span><a href="#%28part._.Request_header_normalization%29" class="tocsubseclink" data-pltdoc="x">Request header normalization</a></td></tr><tr><td><span class="tocsublinknumber">5.2.2.2<tt>&nbsp;</tt></span><a href="#%28part._.Resetting_headers%29" class="tocsubseclink" data-pltdoc="x">Resetting headers</a></td></tr><tr><td><span class="tocsublinknumber">5.2.3<tt>&nbsp;</tt></span><a href="#%28part._.Parameters%29" class="tocsubseclink" data-pltdoc="x">Parameters</a></td></tr><tr><td><span class="tocsublinknumber">5.2.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Base_.U.R.I%29" class="tocsubseclink" data-pltdoc="x">Base URI</a></td></tr><tr><td><span class="tocsublinknumber">5.2.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Timeout%29" class="tocsubseclink" data-pltdoc="x">Timeout</a></td></tr><tr><td><span class="tocsublinknumber">5.3<tt>&nbsp;</tt></span><a href="#%28part._.Commands%29" class="tocsubseclink" data-pltdoc="x">Commands</a></td></tr><tr><td><span class="tocsublinknumber">5.3.1<tt>&nbsp;</tt></span><a href="#%28part._.H.T.T.P_methods%29" class="tocsubseclink" data-pltdoc="x">HTTP methods</a></td></tr><tr><td><span class="tocsublinknumber">5.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Payload%29" class="tocsubseclink" data-pltdoc="x">Payload</a></td></tr><tr><td><span class="tocsublinknumber">5.3.3<tt>&nbsp;</tt></span><a href="#%28part._.U.R.I-.T.E.M.P.L.A.T.E%29" class="tocsubseclink" data-pltdoc="x">URI-<wbr></wbr>TEMPLATE</a></td></tr><tr><td><span class="tocsublinknumber">5.3.4<tt>&nbsp;</tt></span><a href="#%28part._.H.E.A.D.E.R.S%29" class="tocsubseclink" data-pltdoc="x">HEADERS</a></td></tr><tr><td><span class="tocsublinknumber">5.3.5<tt>&nbsp;</tt></span><a href="#%28part._.H.T.T.P-.R.E.S.P.O.N.S.E-.C.O.D.E%29" class="tocsubseclink" data-pltdoc="x">HTTP-<wbr></wbr>RESPONSE-<wbr></wbr>CODE</a></td></tr><tr><td><span class="tocsublinknumber">5.3.6<tt>&nbsp;</tt></span><a href="#%28part._.S.C.H.E.M.A%29" class="tocsubseclink" data-pltdoc="x">SCHEMA</a></td></tr><tr><td><span class="tocsublinknumber">5.4<tt>&nbsp;</tt></span><a href="#%28part._.Assertions%29" class="tocsubseclink" data-pltdoc="x">Assertions</a></td></tr><tr><td><span class="tocsublinknumber">5.4.1<tt>&nbsp;</tt></span><a href="#%28part._.Equations_and_inequalities%29" class="tocsubseclink" data-pltdoc="x">Equations and inequalities</a></td></tr><tr><td><span class="tocsublinknumber">5.4.2<tt>&nbsp;</tt></span><a href="#%28part._.Type_checks%29" class="tocsubseclink" data-pltdoc="x">Type checks</a></td></tr><tr><td><span class="tocsublinknumber">5.4.3<tt>&nbsp;</tt></span><a href="#%28part._.Negation%29" class="tocsubseclink" data-pltdoc="x">Negation</a></td></tr><tr><td><span class="tocsublinknumber">5.4.4<tt>&nbsp;</tt></span><a href="#%28part._.Adjectives%29" class="tocsubseclink" data-pltdoc="x">Adjectives</a></td></tr><tr><td><span class="tocsublinknumber">5.4.4.1<tt>&nbsp;</tt></span><a href="#%28part._.Numeric_adjectives%29" class="tocsubseclink" data-pltdoc="x">Numeric adjectives</a></td></tr><tr><td><span class="tocsublinknumber">5.4.4.2<tt>&nbsp;</tt></span><a href="#%28part._.String_adjectives%29" class="tocsubseclink" data-pltdoc="x">String adjectives</a></td></tr><tr><td><span class="tocsublinknumber">5.4.4.3<tt>&nbsp;</tt></span><a href="#%28part._.Array_adjectives%29" class="tocsubseclink" data-pltdoc="x">Array adjectives</a></td></tr><tr><td><span class="tocsublinknumber">5.4.4.4<tt>&nbsp;</tt></span><a href="#%28part._.Object_adjectives%29" class="tocsubseclink" data-pltdoc="x">Object adjectives</a></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._.Limitations%29" class="tocsubseclink" data-pltdoc="x">Limitations</a></td></tr><tr><td><span class="tocsublinknumber">7<tt>&nbsp;</tt></span><a href="#%28part._.Miscellanea%29" class="tocsubseclink" data-pltdoc="x">Miscellanea</a></td></tr><tr><td><span class="tocsublinknumber">7.1<tt>&nbsp;</tt></span><a href="#%28part._.File_extension%29" class="tocsubseclink" data-pltdoc="x">File extension</a></td></tr><tr><td><span class="tocsublinknumber">7.2<tt>&nbsp;</tt></span><a href="#%28part._.J.S.O.N-only%29" class="tocsubseclink" data-pltdoc="x">JSON-<wbr></wbr>only</a></td></tr><tr><td><span class="tocsublinknumber">7.3<tt>&nbsp;</tt></span><a href="#%28part._.Draft_07_.Schema_only%29" class="tocsubseclink" data-pltdoc="x">Draft 07 Schema only</a></td></tr><tr><td><span class="tocsublinknumber">8<tt>&nbsp;</tt></span><a href="#%28part._.Wishlist%29" class="tocsubseclink" data-pltdoc="x">Wishlist</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.4</span></div><div class="navsettop"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h2 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;top&quot;"><a name="(part._top)"></a><a name="(part._.Riposte_.Scripting_.Language_for_.J.S.O.N-based_.H.T.T.P_.A.P.Is)"></a><a name="(mod-path._riposte)"></a>Riposte&#8212;Scripting Language for JSON-based HTTP APIs</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Jesse Alama &lt;<a href="mailto:jesse@lisp.sh">jesse@lisp.sh</a>&gt;</p></span></div><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><a href="https://download.racket-lang.org/releases/7.4/doc/local-redirect/index.html?doc=guide&amp;rel=Module_Syntax.html%23%2528part._hash-lang%2529&amp;version=7.4" class="RktModLink Sq" data-pltdoc="x"><span class="RktMod">#lang</span></a><span class="hspace">&nbsp;</span><a href="" class="RktModLink" data-pltdoc="x"><span class="RktSym">riposte</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <a href="https://pkgs.racket-lang.org/package/riposte" title="Install this package using `raco pkg install riposte`"><span class="stt">riposte</span></a></span></td></tr></table></p><p>Riposte is a scripting language for evaluating JSON-bearing HTTP responses. The intended use case is a JSON-based HTTP API. It comes with a commandline tool, <span class="stt">riposte</span>, which executes Riposte scripts. Using Riposte, one writes a sequence of commands&#8212;which amount to HTTP requests&#8212;and assertions, which require that the response meets certain conditions.</p><p>Riposte is intended to be a language for system (or integration) tests. As such, it is not intended to be a general purpose programming langauge. There is no notion of branching (&#8220;if-then-else&#8221;) in a single script. The idea is that a Riposte script consists of a series of assertions, all of which must succeed. If, during evaluation, a command or assertion fails, evaluation will be aborted. There&rsquo;s no fallback.</p><p>In other words, Riposte was made to help you get more serious about testing your APIs. It helped me up my testing game, and I hope it can do the same for you.</p><h3 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Brief_introduction&quot;">1<tt>&nbsp;</tt><a name="(part._.Brief_introduction)"></a>Brief introduction</h3><p>Let&rsquo;s take a look at some little Riposte scripts.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">set</span><span class="hspace">&nbsp;</span><span class="RktMeta">a</span><span class="hspace">&nbsp;</span><span class="RktMeta">header</span><span class="RktMeta">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">to</span><span class="hspace">&nbsp;</span><span class="RktMeta">be</span><span class="hspace">&nbsp;</span><span class="RktMeta">added</span><span class="hspace">&nbsp;</span><span class="RktMeta">to</span><span class="hspace">&nbsp;</span><span class="RktMeta">all</span><span class="hspace">&nbsp;</span><span class="RktMeta">requests</span><span class="hspace">&nbsp;</span><span class="RktMeta">going</span><span class="hspace">&nbsp;</span><span class="RktMeta">forward</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">the</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">character</span><span class="hspace">&nbsp;</span><span class="RktMeta">is</span><span class="hspace">&nbsp;</span><span class="RktMeta">the</span><span class="hspace">&nbsp;</span><span class="RktMeta">to-end-of-line</span><span class="hspace">&nbsp;</span><span class="RktMeta">comment</span><span class="RktSym"> character
&#160;
^Content-Type := "application/json"
# set a base URL; we will merge all URIs going forward
# with this
%base := https://api.example.com:8441/v1/
&#160;
</span><span class="RktMeta">$uuid</span><span class="hspace">&nbsp;</span><span class="RktMeta">:=</span><span class="hspace">&nbsp;</span><span class="RktMeta">@UUID</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">@</span><span class="hspace">&nbsp;</span><span class="RktMeta">is</span><span class="hspace">&nbsp;</span><span class="RktMeta">how</span><span class="hspace">&nbsp;</span><span class="RktMeta">you</span><span class="hspace">&nbsp;</span><span class="RktMeta">access</span><span class="hspace">&nbsp;</span><span class="RktMeta">environment</span><span class="hspace">&nbsp;</span><span class="RktMeta">variables</span></td></tr></table></blockquote><p>Normal variables (here, <span class="stt">$uuid</span>) have the <span class="stt">$</span> sigil in front of them. There are a handful of global variables which use <span class="stt">%</span> as their sigil (here, <span class="stt">%base</span>). Headers form their own kind of &#8220;namespace&#8220; for variables; their sigil is <span class="stt">^</span> (here, <span class="stt">^Content-Type</span>). In all cases, <span class="stt">:=</span> is the way you assign a value to a variable.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">-----------------------</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">Start</span><span class="hspace">&nbsp;</span><span class="RktMeta">sending</span><span class="hspace">&nbsp;</span><span class="RktMeta">requests!</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">-------------</span><span class="RktSym"><span class="nobreak">----------
</span>&#160;
GET cart/{uuid} resp</span><span class="RktMeta">onds</span><span class="hspace">&nbsp;</span><span class="RktMeta">with</span><span class="hspace">&nbsp;</span><span class="RktMeta">2XX</span></td></tr></table></blockquote><p>Riposte uses <a href="https://tools.ietf.org/html/rfc6570">URI Template</a> as its language for URIs. URI Template extends URIs with a kind of template syntax. Values get plugged in between open and close curly braces. Here, we plug in the value of the <span class="stt">uuid</span> variable, whose value came from the environment. The <span class="stt">2XX</span> means: we expect a 200-class response; the precise response code doesn&rsquo;t matter. It could be 200, 201, 204...</p><p>Riposte supports <span class="stt">GET</span>, <span class="stt">HEAD</span>, <span class="stt">POST</span>, <span class="stt">PATCH</span> and <span class="stt">DELETE</span> as HTTP request methods.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">----------------------------------------------------------------------</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">Now</span><span class="hspace">&nbsp;</span><span class="RktMeta">add</span><span class="hspace">&nbsp;</span><span class="RktMeta">something</span><span class="hspace">&nbsp;</span><span class="RktMeta">to</span><span class="hspace">&nbsp;</span><span class="RktMeta">the</span><span class="hspace">&nbsp;</span><span class="RktMeta">cart:</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">------------------------------------------------------------</span><span class="RktSym"><span class="nobreak">----------
</span>&#160;
$productId := 41966
$qty := 5
$campaignId := 1
&#160;
$payload := {
  "product_id": $productId,   # we extend the JSON syntax here
  "campaign_id": $campaignId, # in that you can use Riposte variables
  "qty": $qty                 # and you can add comments to JSON, too
}
&#160;
POST $payload to cart/{uuid}/items responds with 200
&#160;
$itemId := /item</span><span class="RktMeta">s/0/cart_item_id</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">extract</span><span class="hspace">&nbsp;</span><span class="RktMeta">the</span><span class="hspace">&nbsp;</span><span class="RktMeta">item</span><span class="hspace">&nbsp;</span><span class="RktMeta">ID</span></td></tr></table></blockquote><p>Here, we define some data and build a JSON object with three properties. We then submit that to (what works out to) <span class="stt">https://api.example.com/cart/28f896e6-98df-497b-b95f-c34d39c2a368/items</span>. (I just picked a random UUID.) Notice that we expect a concrete response code here. The response had better be 200. Anything else would be an error.</p><p>We also extract data from the response. Riposte builds on JSON Pointer, an IETF standard notation for referring to parts of JSON documents.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote><p>After making a request, you can make assertions about it. Here, with <span class="stt">exists</span>, we&rsquo;re asserting that (1) the response is a JSON object, and (2) it has a property, <span class="stt">"tax_total"</span>. We don&rsquo;t care what that value is. (Riposte comes with a ton of assertions; <span class="stt">exists</span> is just one.)</p><p>Here&rsquo;s another Riposte script that logs in to our iOS API:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">$log</span><span class="RktSym">inPayload := {
  "email": @EMAIL,
  "passwor</span><span class="RktMeta">d":</span><span class="RktSym"> @PASSWORD
}
&#160;
POST $loginPayload to auth/login re</span><span class="RktMeta">sponds</span><span class="hspace">&nbsp;</span><span class="RktMeta">with</span><span class="hspace">&nbsp;</span><span class="RktMeta">2XX</span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">extract</span><span class="hspace">&nbsp;</span><span class="RktMeta">a</span><span class="hspace">&nbsp;</span><span class="RktMeta">value</span><span class="hspace">&nbsp;</span><span class="RktMeta">from</span><span class="hspace">&nbsp;</span><span class="RktMeta">the</span><span class="hspace">&nbsp;</span><span class="RktMeta">response</span><span class="hspace">&nbsp;</span><span class="RktMeta">body</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">and</span><span class="hspace">&nbsp;</span><span class="RktMeta">use</span><span class="hspace">&nbsp;</span><span class="RktMeta">it</span><span class="hspace">&nbsp;</span><span class="RktMeta">as</span><span class="hspace">&nbsp;</span><span class="RktMeta">the</span><span class="hspace">&nbsp;</span><span class="RktMeta">value</span><span class="hspace">&nbsp;</span><span class="RktMeta">of</span><span class="hspace">&nbsp;</span><span class="RktMeta">an</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">HTTP</span><span class="hspace">&nbsp;</span><span class="RktMeta">header</span><span class="RktMeta">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">going forward:
</span><span class="RktMeta">^Apikey</span><span class="hspace">&nbsp;</span><span class="RktMeta">:=</span><span class="hspace">&nbsp;</span><span class="RktMeta">/key</span></td></tr></table></blockquote><p>Welcome to Riposte. En garde!</p><h3 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Installation&quot;">2<tt>&nbsp;</tt><a name="(part._.Installation)"></a>Installation</h3><p>Riposte is written in <a href="https://racket-lang.org">Racket</a> and depends on an <a href="https://download.racket-lang.org">installation</a> of it. (The previous link takes you to the official Racket download page. You may be able to install Racket using some package manager on your system, such as <a href="https://brew.sh">Homebrew</a> on macOS, <a href="https://wiki.debian.org/DebianPackageManagement">apt-get</a> on Debian-based Linuxes, <a href="https://www.openbsd.org/faq/faq15.html">pkg_add</a> on OpenBSD, and so on and so forth.)</p><p>Once you&rsquo;ve got Racket installed, use <span class="stt">raco</span> (the Racket commandline tool) as follows:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ raco pkg install --auto riposte</span></p></td></tr></table></p><p>(The <span class="stt"></span><span class="stt">&ndash;</span><span class="stt">auto</span> bit there automatically installs anything that Riposte depends upon, in case you don&rsquo;t have it. You can omit it if you like and be prompted whether you want to install each of the dependencies.)</p><p>Once Riposte (the Racket package) is installed, you ought to have a <span class="stt">riposte</span> executable in the place where your Racket executables are stored. On my machine (a Mac), <span class="stt">riposte</span> is residing at <span class="stt">/Users/jessealama/Library/Racket/7.0/bin</span>. I&rsquo;ve added this to my <span class="stt">$PATH</span> environment variable to make sure that I can just use <span class="stt">riposte</span> straight away.</p><h3 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Where_Riposte_came_from&quot;">3<tt>&nbsp;</tt><a name="(part._.Where_.Riposte_came_from)"></a>Where Riposte came from</h3><p>Riposte was born out of a need to do more serious testing of HTTP APIs.</p><p>I envied the little langauges that I found in developer tools such as <a href="https://github.com/pashky/restclient.el">restclient.el</a> for Emacs and the <a href="https://www.jetbrains.com/help/idea/rest-client-tool-window.html">REST Client</a> in the JetBrains IDEs. (There are surely many more such tools out there.) I wanted to use these kinds of things for automated testing, but couldn&rsquo;t find anything satisfactory. Formats like <a href="https://apiblueprint.org">API Blueprint</a> are a decent start, but I see these more like documentation than an automated test suite. Combining API Blueprint with a tool like <a href="https://dredd.readthedocs.io/en/latest/">Dredd</a> is good, but I found it didn&rsquo;t quite have the features that I was looking for.</p><p>So I built Riposte to fill a gap. The requirement was that it needed to have a straightforward language that is more or less instantly recognizable. Riposte is made with Racket, but it was important that the language look like those cool little languages that I alluded to earlier, and <span style="font-style: italic">not</span> like Lisp. Indeeed, Riposte was initially built to be used in an environment where Lisp of any sort was not the language of choice.</p><p>In the end, as with many tools in the tech world, I cannot claim that Riposte is totally unique. I was inspired by some good tools, but didn&rsquo;t quite fit the need I had. Perhaps I just needed to RTFM and figure out how to use these tools more intelligently, or perhaps strap some kind of DSL on top of them. Maybe there are tools out there just like Riposte.</p><p>But for now, I&rsquo;m sticking with it. Riposte has proved its usefulness to me and my teammates many times. I hope you find it useful, too.</p><h3 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Usage&quot;">4<tt>&nbsp;</tt><a name="(part._.Usage)"></a>Usage</h3><p>There are two ways of executing a Riposte script: using <span class="stt">riposte</span> or directly executing them.</p><h4 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Using_the_interpreter&quot;">4.1<tt>&nbsp;</tt><a name="(part._.Using_the_interpreter)"></a>Using the interpreter</h4><p>Do this:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ riposte path/to/script.rip</span></p></td></tr></table></p><h4 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Direct_execution&quot;">4.2<tt>&nbsp;</tt><a name="(part._.Direct_execution)"></a>Direct execution</h4><p>Use a shebang. Start your Riposte script, say <span class="stt">let-er.rip</span>, like this:</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">#!/usr/local/bin/riposte</span></p></td></tr><tr><td><p><span class="stt">#</span></p></td></tr><tr><td><p><span class="stt">GET whatever responds with 2XX</span></p></td></tr></table></p><p>Make sure your Riposte script is executable. Then&#8212;assuming that Riposte really is at <span class="stt">/usr/local/bin/riposte</span>, as indicated in the script&#8212;you ought to be able to just to do</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">$ ./let-er.rip</span></p></td></tr></table></p><p>to <span class="stt">GET</span> <span class="stt">whatever</span>.</p><h3 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Language&quot;">5<tt>&nbsp;</tt><a name="(part._.Language)"></a>Language</h3><p>The Riposte language consists of three basic elements:</p><ul><li><p><span style="font-style: italic">assignments</span>,</p></li><li><p><span style="font-style: italic">imports</span>,</p></li><li><p><span style="font-style: italic">commands</span>, and</p></li><li><p><span style="font-style: italic">assertions</span></p></li></ul><p>Here&rsquo;s a simple Riposte script contains all three ingredients:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">^Con</span><span class="RktSym">tent-Type := "app</span><span class="RktMeta">l</span><span class="RktSym">ication/json"
$payload := { "</span><span class="RktMeta">a</span><span class="RktSym">": 5, "b": [] }
POST $payload to https://whatever.test r</span><span class="RktMeta">e</span><span class="RktSym">sponds with 201
/foo is </span><span class="RktMeta">positive</span><span class="hspace">&nbsp;</span><span class="RktMeta">integer</span></td></tr></table></blockquote><p>Lines 1 and 2 are assignments; the first assigns a value to a header, and the second assigns a value to a variable. Line 3 is a command: here, we send a <span class="stt">POST</span> request, with a payload&#8212;a JSON object specified in line 2. We expect that the response we receive has an exit code of 201. Line 4 is an assertion. We&rsquo;re saying there that the response body had better be well-formed JSON, that that JSON had better be a JSON object, and that that object had better have the property <span class="stt">foo</span>, and the value of the <span class="stt">foo</span> property of that object is a positive integer.</p><p>The following sections give a more thorough discussion of the different kinds of top-level syntatic ingredients.</p><h4 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Imports&quot;">5.1<tt>&nbsp;</tt><a name="(part._.Imports)"></a>Imports</h4><p>Imports are a way of putting some Riposte code into one file and using it in another. It gives a way to pass variables from one script to another. They allow you to carry out some requests, gathering a bit of state, and then using that state in another file.</p><p>Here&rsquo;s an example of this. Let&rsquo;s call this file <span class="stt">headers.rip</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">^Con</span><span class="RktSym">tent-Type := "app</span><span class="RktMeta">l</span><span class="RktSym">ication/json"
^Cache-Contro</span><span class="RktMeta">l</span><span class="hspace">&nbsp;</span><span class="RktMeta">:=</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"no-cache"</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Consider setting up a base URI in a separate file, <span class="stt">parameters.rip</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">%base</span><span class="hspace">&nbsp;</span><span class="RktMeta">:=</span><span class="hspace">&nbsp;</span><span class="RktMeta">https://cool.</span><span class="RktSym">test/api/v2/
%</span><span class="RktMeta">timeout</span><span class="hspace">&nbsp;</span><span class="RktMeta">:=</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">30</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Then, in another Riposte script, <span class="stt">login.rip</span>, we can import these two to set up a kind of basis:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">import</span><span class="hspace">&nbsp;</span><span class="RktMeta">pa</span><span class="RktSym">rameters.rip
impor</span><span class="RktMeta">t</span><span class="hspace">&nbsp;</span><span class="RktMeta">h</span><span class="RktSym">eaders.rip
&#160;
$payload := {
  "username": @USERNAME,
  "passwor</span><span class="RktMeta">d":</span><span class="RktSym"> @PASSWORD
}
&#160;
POST $payload to login re</span><span class="RktMeta">spo</span><span class="RktSym">nds with 200
&#160;
</span><span class="RktMeta">$</span><span class="RktSym">key := /apikey
</span><span class="RktMeta">^APIKey</span><span class="hspace">&nbsp;</span><span class="RktMeta">:=</span><span class="hspace">&nbsp;</span><span class="RktMeta">$key</span></td></tr></table></blockquote><p>The <span class="stt">POST</span> command here gets executed here with the parameters and headers set up in the other files. Upon executing <span class="stt">login.rip</span>, a header, <span class="stt">APIKey</span>, gets set. <span class="stt">login.rip</span> also &ldquo;exports&rdquo; a variable, <span class="stt">$key</span>. If you were to keep going an import <span class="stt">login.rip</span>, you&rsquo;d have that variable, and the header assignment would also be in place:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">import</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"login.rip"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">You</span><span class="hspace">&nbsp;</span><span class="RktMeta">can</span><span class="hspace">&nbsp;</span><span class="RktMeta">ref</span><span class="RktSym">er to $key
&#160;
$load := {
  "key": $key, # comes from login.rip
  </span><span class="RktVal">"zoom"</span><span class="RktMeta">:</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"boom"</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">}</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktMeta">#</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta">APIKey</span><span class="hspace">&nbsp;</span><span class="RktMeta">request</span><span class="hspace">&nbsp;</span><span class="RktMeta">header</span><span class="hspace">&nbsp;</span><span class="RktMeta">will</span><span class="hspace">&nbsp;</span><span class="RktMeta">b</span><span class="RktSym">e present here:
PATCH $load to dump/truck r</span><span class="RktMeta">esponds</span><span class="hspace">&nbsp;</span><span class="RktMeta">with</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">204</span><span class="RktMeta"></span></td></tr></table></blockquote><h4 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Assignments&quot;">5.2<tt>&nbsp;</tt><a name="(part._.Assignments)"></a>Assignments</h4><p>With assignments, the idea is that we intend to modify a namespace. There are a few different namespaces in play with Riposte: the variable namespace, HTTP headers, and parameters.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Variable_assignments&quot;">5.2.1<tt>&nbsp;</tt><a name="(part._.Variable_assignments)"></a>Variable assignments</h5><p>A normal definition means that we give a value to a variable.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Header_assignments&quot;">5.2.2<tt>&nbsp;</tt><a name="(part._.Header_assignments)"></a>Header assignments</h5><p>Header assignment means that we assign a value to an HTTP header. Until unset, every request will have that header, and that header will have that value. Here&rsquo;s an example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">^Con</span><span class="RktSym">tent-Type := "app</span><span class="RktMeta">lication/json"</span></td></tr></table></blockquote><p>The effect of evaluating this assignment is to indicate that all commands (HTTP requests) executed after this assignment will have a <span class="stt">Content-Type</span> header, and the value of the header will be <span class="stt">application/json</span>.</p><p>Only strings are allowed as the values for an assignment. The empty string is fine.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Request_header_normalization&quot;">5.2.2.1<tt>&nbsp;</tt><a name="(part._.Request_header_normalization)"></a>Request header normalization</h5><p>Riposte&rsquo;s approach to HTTP headers is simple: a header can show up only once in a request. Thus, when assigning a value to a request header, any previously existing value for that header will be discarded.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Resetting_headers&quot;">5.2.2.2<tt>&nbsp;</tt><a name="(part._.Resetting_headers)"></a>Resetting headers</h5><p>To ensure that a header does not show up in HTTP requests, use <span class="stt">unset</span>. Example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">unset</span><span class="hspace">&nbsp;</span><span class="RktMeta">^Content-Type</span></td></tr></table></blockquote><p>Evaluating this means that the next request&#8212;and all following ones&#8212;will not have a <span class="stt">Content-Type</span> header.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Parameters&quot;">5.2.3<tt>&nbsp;</tt><a name="(part._.Parameters)"></a>Parameters</h5><p>There are two parameters (AKA global variables) that steer the way the evaluation of Riposte works.</p><ul><li><p>base URL</p></li><li><p>timeout</p></li></ul><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Base_URI&quot;">5.2.3.1<tt>&nbsp;</tt><a name="(part._.Base_.U.R.I)"></a>Base URI</h5><p>Sure, you can write out every URL you want, completely. Or you can save yourself some time, and make your scripts more readable to boot, by using a base URI.</p><p>Here&rsquo;s how you can set that:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">%base</span><span class="hspace">&nbsp;</span><span class="RktMeta">:=</span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"https://whatever.test/v2/"</span><span class="RktSym">
GET big/boy resp</span><span class="RktMeta">onds</span><span class="hspace">&nbsp;</span><span class="RktMeta">with</span><span class="hspace">&nbsp;</span><span class="RktMeta">2XX</span></td></tr></table></blockquote><p>When it comes time to build that <span class="stt">GET</span> request, we&rsquo;ll use <span class="stt">https://whatever.test/v2/big/boy</span> as the URI.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Timeout&quot;">5.2.3.2<tt>&nbsp;</tt><a name="(part._.Timeout)"></a>Timeout</h5><p>Usually we want to wait only a ceratin amount of time before we give up on the server that we&rsquo;re working with. To control that, use <span class="stt">%timeout</span>, like so:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote><p>The value should be a positive integer. (If it isn&rsquo;t, Riposte will die.) We will have</p><p>Riposte does not offer a way of disabling a timeout. Just use a big number if you want to give your requests a lot of time.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote><p>The default value for this parameter is 10 seconds.</p><h4 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Commands&quot;">5.3<tt>&nbsp;</tt><a name="(part._.Commands)"></a>Commands</h4><p>With <span style="font-style: italic">commands</span>, you send out your HTTP requests.</p><p>Optionally, you can check that</p><ul><li><p>the responses have a certain response code (200, 204, 404, etc.), and</p></li><li><p>that the whole response body satisfies a JSON Schema.</p></li></ul><p>Those two parts are optional; you can check the response code without specifying a schema, and you can specify a schema without saying anything about the response code. You can leave out both, or supply both.</p><p>(The Riposte langauge has a concept of an assertion, which is all about checking things. When a command includes a response code check, or a schema check, then commands has the effect of performing an assertion.)</p><p>Formally, a command has one of these these structures, depending on whether you want to check the response code and assert that the response satisfies a schema.</p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">HTTP-METHOD [ PAYLOAD "to" ] URI-TEMPLATE [ "with" "headers" HEADERS ]</span></p></td></tr></table></p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">HTTP-METHOD [ PAYLOAD "to" ] URI-TEMPLATE [ "with" "headers" HEADERS ] "responds" "with" HTTP-RESPONSE-CODE [ "and" "satisfies" "schema" SCHEMA ]</span></p></td></tr></table></p><p><table cellspacing="0" cellpadding="0" class="SVerbatim"><tr><td><p><span class="stt">HTTP-METHOD [ PAYLOAD "to" ] URI-TEMPLATE [ "with" "headers" HEADERS ] "satisfies" "schema" SCHEMA</span></p></td></tr></table></p><p>A command need not be on one line.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;HTTP_methods&quot;">5.3.1<tt>&nbsp;</tt><a name="(part._.H.T.T.P_methods)"></a>HTTP methods</h5><p>HTTP-METHOD consists of a non-empty sequence of uppercase letters. Typical examples:</p><ul><li><p><span class="stt">GET</span></p></li><li><p><span class="stt">POST</span></p></li><li><p><span class="stt">OPTIONS</span></p></li><li><p><span class="stt">PUT</span></p></li><li><p><span class="stt">PATCH</span></p></li><li><p><span class="stt">DELETE</span></p></li></ul><p>However, you can use whatever you like, e.g., <span class="stt">CANCEL</span>, <span class="stt">BREW</span>, and so on.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Payload&quot;">5.3.2<tt>&nbsp;</tt><a name="(part._.Payload)"></a>Payload</h5><p>PAYLOAD, if present, is supposed to be a variable reference or literal JSON (with variables allowed). Here&rsquo;s an example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote><p>When executing the command, the payload will become the request body.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;URI-TEMPLATE&quot;">5.3.3<tt>&nbsp;</tt><a name="(part._.U.R.I-.T.E.M.P.L.A.T.E)"></a>URI-TEMPLATE</h5><p>HTTP requests need to have a URI. (Of course.) The URI could be either fixed (that is, involve no variables)</p><p>The URI that will ultimately be built will be glommed onto whatever the base URI is. By default, there is no base URI, so your URI will be used as-is. If a base URI is specified (assign a string value to the global variable <span class="stt">%base</span> for that purpose), then it will be the prefix for your specified URI. If you wish to go around the base URI, specify an absolute URI, like <span class="stt">https://whatever.test/api/grub</span> or, before the command, unset <span class="stt">%base</span>.</p><p>If you&rsquo;re not so static, the URI you give here might be built up from URI Templates. Here&rsquo;s a typical example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote><p>A URI is, at the end of the day, a kind of string. In this example, notice that we&rsquo;ve used an integer and plugged it into the URI.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;HEADERS&quot;">5.3.4<tt>&nbsp;</tt><a name="(part._.H.E.A.D.E.R.S)"></a>HEADERS</h5><p>For a single request, one can specify headers that should be used, in just <span style="font-style: italic">this</span> request, in addition to the ones that are already set. Here&rsquo;s a typical example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote><p>Notice here that we use a JSON object to specify the headers. The headers that are ultimately generated are normalized. (If you have an application that is sensitive to normalization&#8212;if it behaves one way when headers are normalized and another if headers are not normalized, I&rsquo;m afraid Riposte cannot currently build such HTTP requests.)</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;HTTP-RESPONSE-CODE&quot;">5.3.5<tt>&nbsp;</tt><a name="(part._.H.T.T.P-.R.E.S.P.O.N.S.E-.C.O.D.E)"></a>HTTP-RESPONSE-CODE</h5><p>HTTP response codes are supposed to be three-digit integers. There aren&rsquo;t lots of possibilities.</p><p>If you don&rsquo;t care about the precise response code, you can use response code patterns. Example: <span class="stt">2XX</span> means: any 200-class is OK. It could be 200, 201, 204, you name it. You can also say things like <span class="stt">20X</span> to mean that 200, 201, &#8230; 209 would be OK, but 210 wouldn&rsquo;t be.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;SCHEMA&quot;">5.3.6<tt>&nbsp;</tt><a name="(part._.S.C.H.E.M.A)"></a>SCHEMA</h5><p>There are two forms that SCHEMA can take:</p><ul><li><p>a variable reference, or</p></li><li><p>an unquoted string.</p></li></ul><p>The two forms are for referring directly to a JSON Schema as a JSON value or in an external file. Here are examples of the two kinds of forms:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">$s</span><span class="RktSym">chema := {
  "</span><span class="RktMeta">type</span><span class="RktSym">": "object",
  "requiredProperties": [</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktVal">"age"</span><span class="RktMeta">,</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">"weight"</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">]</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">}</span><span class="RktSym">
POST $p</span><span class="RktMeta">a</span><span class="RktSym">yload to api/flub satisf</span><span class="RktMeta">ies</span><span class="hspace">&nbsp;</span><span class="RktMeta">schema</span><span class="hspace">&nbsp;</span><span class="RktMeta">$schema</span></td></tr></table></blockquote><p>Example of using a schema specified in a file:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">POST</span><span class="RktSym"> $payloa</span><span class="RktMeta">d</span><span class="RktSym"> to api/flub satisfies schema i</span><span class="RktMeta">n</span><span class="hspace">&nbsp;</span><span class="RktMeta">schema.json</span></td></tr></table></blockquote><h4 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Assertions&quot;">5.4<tt>&nbsp;</tt><a name="(part._.Assertions)"></a>Assertions</h4><p>Assertions are checks that succeed or fail. When executing an assertion, Riposte will see whether what&rsquo;s being asserted is true. If it&rsquo;s true, it moves on to the next thing (command, assertion, etc.). If the check fails, Riposte bails out.</p><p>There are a few different kinds of assertions:</p><ul><li><p>equations</p></li><li><p>disequations</p></li><li><p>inequalities</p></li><li><p>type checks</p></li></ul><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Equations_and_inequalities&quot;">5.4.1<tt>&nbsp;</tt><a name="(part._.Equations_and_inequalities)"></a>Equations and inequalities</h5><p>Write an equation by writing two expressions separated by <span class="stt">=</span>.</p><p>Write a disequation by writing <span class="stt">!=</span></p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Type_checks&quot;">5.4.2<tt>&nbsp;</tt><a name="(part._.Type_checks)"></a>Type checks</h5><p>You can use <span class="stt">is</span> and the JSON type keywords to assert that a value has a certain type. The types are:</p><ul><li></li><li><p>number</p></li><li><p>integer</p></li><li><p>boolean</p></li><li><p>string</p></li><li><p>array</p></li><li><p>object</p></li></ul><p>You can use these words as-is. Thus:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta">$foo</span><span class="hspace">&nbsp;</span><span class="RktMeta">is</span><span class="hspace">&nbsp;</span><span class="RktMeta">integer</span></td></tr></table></blockquote><p>is an assertion that succeeds provided that the value held by <span class="stt">$foo</span> is indeed an integer.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Negation&quot;">5.4.3<tt>&nbsp;</tt><a name="(part._.Negation)"></a>Negation</h5><p>You can assert that a value does not have a certain type by using <span class="stt">not</span>. Thus:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td></td></tr></table></blockquote><p>works provided that <span class="stt">$bar</span> is not an array.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Adjectives&quot;">5.4.4<tt>&nbsp;</tt><a name="(part._.Adjectives)"></a>Adjectives</h5><p>One can tweak checks with adjectives. The set of adjectives available depends on the type.</p><p>Use <span class="stt">non</span> to say that a value does not meet a certain adjective.</p><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Numeric_adjectives&quot;">5.4.4.1<tt>&nbsp;</tt><a name="(part._.Numeric_adjectives)"></a>Numeric adjectives</h5><ul><li><p><span class="stt">positive</span> / <span class="stt">non positive</span></p></li><li><p><span class="stt">negative</span> / <span class="stt">non negative</span></p></li></ul><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;String_adjectives&quot;">5.4.4.2<tt>&nbsp;</tt><a name="(part._.String_adjectives)"></a>String adjectives</h5><ul><li><p><span class="stt">empty</span> / <span class="stt">non empty</span></p></li></ul><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Array_adjectives&quot;">5.4.4.3<tt>&nbsp;</tt><a name="(part._.Array_adjectives)"></a>Array adjectives</h5><ul><li><p><span class="stt">empty</span> / <span class="stt">non empty</span></p></li></ul><h5 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Object_adjectives&quot;">5.4.4.4<tt>&nbsp;</tt><a name="(part._.Object_adjectives)"></a>Object adjectives</h5><ul><li><p><span class="stt">empty</span> / <span class="stt">non empty</span></p></li></ul><h3 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Limitations&quot;">6<tt>&nbsp;</tt><a name="(part._.Limitations)"></a>Limitations</h3><p>All sorts of HTTP scenarios cannot be modeled at all with Riposte. Riposte is essnetially a scriptable headless browser, but you can&rsquo;t do <span style="font-style: italic">everything</span> at all.</p><ul><li><p>As mentioned earlier, Riposte works with JSON-only (with one exception: responses that contain no body at all). A non-empty response that is malformed JSON will cause Riposte to bail out.</p></li><li><p>No support for redirections. The HTTP client built in to Riposte can, but deliberately does not, follow redirections. The intention is that a resquest is supposed to generate an &ldquo;immediate&rdquo; response. It wouldn&rsquo;t be </p></li><li><p>No support for the <span class="stt">CONNECT</span> HTTP method.</p></li></ul><h3 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Miscellanea&quot;">7<tt>&nbsp;</tt><a name="(part._.Miscellanea)"></a>Miscellanea</h3><p>Here&rsquo;s where you can find some information for which I couldn&rsquo;t find a better place.</p><h4 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;File_extension&quot;">7.1<tt>&nbsp;</tt><a name="(part._.File_extension)"></a>File extension</h4><p>I suggest using <span class="stt">.rip</span> for your Riposte scripts. But, in truth, it doesn&rsquo;t matter. Riposte scripts are supposed to be plain text, and there&rsquo;s no check that a script has any particular file extension.</p><h4 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;JSON-only&quot;">7.2<tt>&nbsp;</tt><a name="(part._.J.S.O.N-only)"></a>JSON-only</h4><p>Riposte works with JSON values and assumes that the responses it receives (more precisely, the response bodies) are JSON.</p><p>There&rsquo;s one exception to this. Some HTTP responses (again, their bodies) are empty. There&rsquo;s even an HTTP response code for this case (<span class="stt">204</span>). Riposte can handle such responses, even though the empty string is not valid JSON.</p><p>If, however, a non-empty response is returned, Riposte attempts to parse the body as JSON. If if can&rsquo;t, Riposte will die.</p><p>This means that Riposte, currently, can&rsquo;t work with HTML, arbitrary plain text, images, and so on. If you request a URI and get a response that contains, say, HTML, Riposte will bail out (unless, by chance, the response turns out to be well-formed JSON!).</p><h4 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Draft_07_Schema_only&quot;">7.3<tt>&nbsp;</tt><a name="(part._.Draft_07_.Schema_only)"></a>Draft 07 Schema only</h4><p>Currently, schema validation with Riposte is done according to JSON Schema draft 07. There is, at the moment, no support for any other draft version of JSON Schema. Sorry.</p><h3 x-source-module="(lib &quot;riposte/scribblings/riposte.scrbl&quot;)" x-source-pkg="riposte" x-part-tag="&quot;Wishlist&quot;">8<tt>&nbsp;</tt><a name="(part._.Wishlist)"></a>Wishlist</h3><p>A number of features could be added to Riposte but have so far not made the cut.</p><ul><li><p>JSON operators: substrings, concatenation, taking chunks of arrays &amp; objects</p></li><li><p>Support for versions of JSON Schema other than draft 07 (the currently implemented version).</p></li></ul><div class="navsetbottom"><span class="navleft"><form class="searchform"><input class="searchbox" style="color: #888;" type="text" value="...search manuals..." title="Enter a search string to search the manuals" onkeypress="return DoSearchKey(event, this, &quot;7.4&quot;, &quot;../&quot;);" onfocus="this.style.color=&quot;black&quot;; this.style.textAlign=&quot;left&quot;; if (this.value == &quot;...search manuals...&quot;) this.value=&quot;&quot;;" onblur="if (this.value.match(/^ *$/)) { this.style.color=&quot;#888&quot;; this.style.textAlign=&quot;center&quot;; this.value=&quot;...search manuals...&quot;; }"/></form>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">top</a></span><span class="navright">&nbsp;&nbsp;<span class="nonavigation">&larr; prev</span>&nbsp;&nbsp;<a href="../index.html" title="up to the documentation top" data-pltdoc="x" onclick="return GotoPLTRoot(&quot;7.4&quot;);">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>